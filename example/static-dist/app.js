/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

// Knockout JavaScript library v2.2.0
// (c) Steven Sanderson - http://knockoutjs.com/
// License: MIT (http://www.opensource.org/licenses/mit-license.php)

/*!
 * jQuery JavaScript Library v1.8.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: Tue Nov 13 2012 08:20:33 GMT-0500 (Eastern Standard Time)
 */

/*!
 * Sizzle CSS Selector Engine
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://sizzlejs.com/
 */

//     Underscore.js 1.4.3
//     http://underscorejs.org
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

/**
 * @license RequireJS text 2.0.5 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * @license
 * Lo-Dash 1.1.1 (Custom Build) <http://lodash.com/>
 * Build: `lodash -o ./dist/lodash.compat.js`
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.4.4 <http://underscorejs.org/>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
 * Available under MIT license <http://lodash.com/license>
 */

/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

(function(e){typeof define!="undefined"&&define.amd?define("qpf",["exports","knockout","$","_"],e):e(window.qpf={},ko,$,_)})(function(e,t,n,r){var i,s,o;(function(e){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(t,r){return function(){return n.apply(e,p.call(arguments,0).concat([t,r]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(n){if(d(f,n)){var r=f[n];delete f[n],c[n]=!0,t.apply(e,r)}if(!d(a,n)&&!d(c,n))throw new Error("No "+n);return a[n]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var t,n,r,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;r=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},t=function(t,n,i,s){var o,l,h,p,v,g=[],w;s=s||t;if(typeof i=="function"){n=!n.length&&i.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=r(n[v],s),l=p.f;if(l==="require")g[v]=u.require(t);else if(l==="exports")g[v]=u.exports(t),w=!0;else if(l==="module")o=g[v]=u.module(t);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,m(s,!0),y(l),{}),g[v]=a[l]}}h=i.apply(a[t],g);if(t)if(o&&o.exports!==e&&o.exports!==a[t])a[t]=o.exports;else if(h!==e||!w)a[t]=h}else t&&(a[t]=i)},i=s=n=function(i,s,o,a,f){return typeof i=="string"?u[i]?u[i](s):b(r(i,s).f):(i.splice||(l=i,s.splice?(i=s,s=o,o=null):i=e),s=s||function(){},typeof o=="function"&&(o=a,a=f),a?t(e,i,s,o):setTimeout(function(){t(e,i,s,o)},4),n)},n.config=function(e){return l=e,l.deps&&n(l.deps,l.callback),n},o=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},o.amd={jQuery:!0}})();var u=o;u("$",[],function(){return n}),u("knockout",[],function(){return t}),u("_",[],function(){return r}),o("core/xmlparser",["require","exports","module","_"],function(e,t,n){function s(e){var t,n;try{return window.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)),t}catch(r){console.error("Invalid XML:"+e)}}function u(e,t){o[e]=t}function a(e){if(e.nodeType===1){var t={type:e.tagName.toLowerCase()},n=f(e.attributes),i=o[t.type];if(i){var s=i(e);s&&typeof s!="object"?console.error("Parser must return an object converted from attributes"):r.extend(n,s)}var u=l(n,t),a=document.createElement("div");return a.setAttribute("data-bind","qpf:"+u),a}if(e.nodeType===8)return;return}function f(e){var t={};for(var n=0;n<e.length;n++){var r=e[n];t[r.nodeName]=r.nodeValue}return t}function l(e,t){t=t||{};var n=function(e,t){r.each(e,function(e,r){if(e.constructor==Array)t[r]=[],n(e,t[r]);else if(e.constructor==Object)t[r]={},n(e,t[r]);else if(typeof e!="undefined"){var i=/^\s*@binding\[(.*?)\]\s*$/.exec(e);i&&(e="{{BINDINGSTART"+i[1]+"BINDINGEND}}"),t[r]=e}})};n(e,t);var i=JSON.stringify(t);return i=i.replace(/\"\{\{BINDINGSTART(.*?)BINDINGEND\}\}\"/g,"$1"),i}function c(e,t){var n=h(e);for(var r=0;r<n.length;r++){var i=a(n[r]);i&&(t.appendChild(i),c(n[r],i))}}function h(e){var t=[],n=e.firstChild;while(n)t.push(n),n=n.nextSibling;return t}function p(e,t){var n=h(e);return r.filter(n,function(e){return e.tagName&&e.tagName.toLowerCase()===t})}function d(e){var t=h(e),n="";return r.each(t,function(e){e.nodeType==3&&(n+=e.textContent.replace(/(^\s*)|(\s*$)/g,""))}),n}var r=e("_"),i=function(e,t){if(typeof e=="string")var n=s(e);else var n=e;if(n){var r=t||document.createElement("div");return c(n,r),r}},o={};t.parse=i,t.provideParser=u,t.util={convertAttributes:f,objectToDataBindingFormat:l,getChildren:h,getChildrenByTagName:p,getTextContent:d}}),o("core/mixin/derive",["require","_"],function(e){function n(e,n,r){typeof n=="object"&&(r=n,n=null);var i={"instanceof":function(e){var t=o;while(t){if(t===e)return!0;t=t.__super__}}},s=this,o=function(r){s.call(this),t.extend(this,typeof e=="function"?e.call(this):e),t.extend(this,r);if(this.constructor==o){var i=o,u=[n];while(i.__super__)i=i.__super__,u.unshift(i.__initialize__);for(var a=0;a<u.length;a++)u[a]&&u[a].call(this)}};return o.__super__=s,o.__initialize__=n,t.extend(o.prototype,s.prototype,i,r),o.prototype.constructor=o,o.derive=s.derive,o}var t=e("_");return{derive:n}}),o("core/mixin/event",[],function(){return{trigger:function(){if(!this.__handlers__)return;var e=arguments[0],t=Array.prototype.slice.call(arguments,1),n=this.__handlers__[e];if(n)for(var r=0;r<n.length;r+=2){var i=n[r],s=n[r+1];i.apply(s||this,t)}},on:function(e,t,n){if(!e)return;var r=this.__handlers__||(this.__handlers__={});return r[e]||(r[e]=[]),r[e].indexOf(t)==-1&&(r[e].push(t),r[e].push(n)),t},off:function(e,t){var n=this.__handlers__||(this.__handlers__={});if(n[e])if(t){var r=n[e],i=r.indexOf(t);i>=0&&r.splice(i,2)}else n[e]=[]}}}),o("core/clazz",["require","./mixin/derive","./mixin/event","_"],function(e){var t=e("./mixin/derive"),n=e("./mixin/event"),r=e("_"),i=new Function;return r.extend(i,t),r.extend(i.prototype,n),i}),o("components/base",["require","core/clazz","core/mixin/event","knockout","$","_"],function(e){function f(e){var t=e.data.context,n=e.type;t.trigger(n)}function p(e,t){var n=t(),r=h(n)||{},s=h(r.type);if(s){var o=c[s];if(o){var u=d(r,o);u&&(e.innerHTML="",e.appendChild(u.$el[0]),i(e).addClass("qpf-wrapper")),e.setAttribute("data-qpf-guid",u.__GUID__)}else console.error("Unkown UI type, "+s)}else console.error("UI type is needed");return u}function d(e,t){var n=h(e.type),r=h(e.name),i=s.omit(e,"type","name"),o={};s.each(i,function(e,n){n.indexOf("on")==0&&t.prototype.eventsProvided.indexOf(n.substr("on".length))>=0&&typeof e=="function"&&(delete i[n],o[n.substr("on".length)]=e)});var u=new t({name:r||"",attributes:i,events:o});return u}function v(e,t){e(t());var n=s.clone(e());e.subscribe(function(e){try{s.isEqual(n,e)||(n=s.clone(e),t(e))}catch(r){console.error(r.toString())}}),t.subscribe(function(t){try{s.isEqual(n,t)||(n=s.clone(t),e(t))}catch(r){console.error(r.toString())}})}var t=e("core/clazz"),n=e("core/mixin/event"),r=e("knockout"),i=e("$"),s=e("_"),o={},u=t.derive(function(){return{name:"",tag:"div",attr:{},$el:null,attributes:{},parent:null,skin:"",classPrefix:"qpf-ui-",skinPrefix:"qpf-skin-",id:r.observable(""),width:r.observable(),"class":r.observable(),height:r.observable(),visible:r.observable(!0),disable:r.observable(!1),style:r.observable(""),temporary:!1,events:{}}},function(){this.__GUID__=l(),this.temporary||(o[this.__GUID__]=this),this.$el||(this.$el=i(document.createElement(this.tag))),this.$el[0].setAttribute("data-qpf-guid",this.__GUID__),this.$el.attr(this.attr),this.skin&&this.$el.addClass(this.withPrefix(this.skin,this.skinPrefix)),this.css&&s.each(s.union(this.css),function(e){this.$el.addClass(this.withPrefix(e,this.classPrefix))},this),this.width.subscribe(function(e){this.$el.width(e),this.afterResize()},this),this.height.subscribe(function(e){this.$el.height(e),this.afterResize()},this),this.disable.subscribe(function(e){this.$el[e?"addClass":"removeClass"]("qpf-disable")},this),this.id.subscribe(function(e){this.$el.attr("id",e)},this),this.class.subscribe(function(e){this.$el.addClass(e)},this),this.visible.subscribe(function(e){e?this.$el.show():this.$el.hide()},this),this.style.subscribe(function(e){var t=e,n=/(\S*?)\s*:\s*(.*)/g;e="{"+s.chain(e.split(";")).map(function(e){return e.replace(/(^\s*)|(\s*$)/g,"").replace(n,'"$1":"$2"')}).filter(function(e){return e}).value().join(",")+"}";try{var i=r.utils.parseJson(e);this.$el.css(i)}catch(o){console.error("Syntax Error of style: "+t)}},this);for(var e in this.events){var t=this.events[e];typeof t=="function"&&this.on(e,t)}this._mappingAttributes(this.attributes),this.initialize(),this.trigger("initialize")},{type:"BASE",template:"",eventsProvided:["click","mousedown","mouseup","mousemove","resize","initialize","beforerender","render","dispose"],initialize:function(){},set:function(e,t){if(typeof e=="string"){var n={};n[e]=t}else n=e;this._mappingAttributes(n,!0)},render:function(){this.beforeRender&&this.beforeRender(),this.trigger("beforerender"),this.doRender(),this.afterRender&&this.afterRender(),this.trigger("render"),this.afterResize()},doRender:function(){this.$el.children().each(function(){u.disposeDom(this)}),this.$el.html(this.template),r.applyBindings(this,this.$el[0])},dispose:function(){this.$el&&this.$el.remove(),o[this.__GUID__]=null,this.trigger("dispose")},resize:function(e,t){typeof e=="number"&&this.width(e),typeof t=="number"&&this.height(t)},afterResize:function(){this.trigger("resize")},withPrefix:function(e,t){if(e.indexOf(t)!=0)return t+e},withoutPrefix:function(e,t){if(e.indexOf(t)==0)return e.substr(t.length)},_mappingAttributes:function(e,t){for(var n in e){var i=e[n],s=this[n];if(!s){var o=r.utils.unwrapObservable(i);r.isObservable(i)&&i.push||i.constructor==Array?this[n]=r.observableArray(o):this[n]=r.observable(o),s=this[n]}else r.isObservable(s)?s(r.utils.unwrapObservable(i)):this[n]=r.utils.unwrapObservable(i);t||r.isObservable(i)&&v(s,i)}}}),a=["click","mousedown","mouseup","mousemove"];u.prototype.on=function(e){a.indexOf(e)>=0&&this.$el.unbind(e,f).bind(e,{context:this},f),n.on.apply(this,arguments)},u.get=function(e){return o[e]},u.getByDom=function(e){var t=e.getAttribute("data-qpf-guid");return u.get(t)},u.disposeDom=function(e,t){function n(e){var t=e.getAttribute("data-qpf-guid"),r=u.get(t);if(r)r.dispose();else if(recursive)for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];s.nodeType==1&&n(s)}}typeof recursive=="undefined"&&(recursive=!0),n(e)};var l=function(){var e=0;return function(){return e++}}();r.extenders.numeric=function(e,t){var n=r.computed({read:e,write:function(n){if(n===""){e("");return}var i=parseFloat(n);i=isNaN(i)?0:i;var s=parseFloat(r.utils.unwrapObservable(t));if(!isNaN(s)){var o=Math.pow(10,s);i=Math.round(i*o)/o}e(i)}});return n(e()),n},r.extenders.clamp=function(e,t){var n=t.min,i=t.max,s=r.computed({read:e,write:function(t){var s=parseFloat(r.utils.unwrapObservable(n)),o=parseFloat(r.utils.unwrapObservable(i));isNaN(s)||(t=Math.max(s,t)),isNaN(o)||(t=Math.min(o,t)),e(t)}});return s(e()),s};var c={};u.provideBinding=function(e,t){c[e]=t},r.bindingHandlers.qpf={createComponent:function(e,t){var n=u.getByDom(e);n&&n.dispose();var r=p(e,t,c);return r},init:function(e,t){var n=r.bindingHandlers.qpf.createComponent(e,t);return n.render(),{controlsDescendantBindings:!0}},update:function(e,t){}},r.bindingHandlers.qpf_view={init:function(e,t){var n=t(),i=r.utils.unwrapObservable(n);return i&&i.$el&&(u.disposeDom(e),e.parentNode.replaceChild(i.$el[0],e)),{controlsDescendantBindings:!0}}},i.fn.qpf=function(e,t){e=e||"get";if(e==="get"){var n=[];return this.each(function(){var e=u.getByDom(this);e&&n.push(e)}),n}if(e==="init")return this.each(function(){r.applyBindings(t,this)}),this.qpf("get");e==="dispose"&&this.each(function(){u.disposeDom(this)})};var h=r.utils.unwrapObservable;return u}),o("components/util",["require","knockout","core/xmlparser","./base"],function(e){var t=e("knockout"),n=e("core/xmlparser"),r=e("./base"),i={};return i.createComponentsFromXML=function(e,i){var s=n.parse(e);t.applyBindings(i||{},s);var o=[],u=s.firstChild;while(u){var a=r.getByDom(u);a&&o.push(a),u=u.nextSibling}return o},i}),o("components/mixin/draggable",["require","core/mixin/derive","core/mixin/event","knockout","$","_"],function(e){var t=e("core/mixin/derive"),n=e("core/mixin/event"),r=e("knockout"),i=e("$"),s=e("_"),o=new Function;s.extend(o,t),s.extend(o.prototype,n);var u=o.derive(function(){return{id:0,target:null,handle:null,margins:{},originPosition:{},offsetParentOffset:{},width:0,height:0,positionType:"",data:{},host:null}},{setData:function(e){},remove:function(){this.host.remove(this.target)}}),a=o.derive(function(){return{items:{},axis:null,container:null,helper:null,_boundingBox:null,_mouseStart:{},_$helper:null}},{add:function(e,t){var n=f(),r=i(e);if(t)var s=i(t);r.attr("data-qpf-draggable",n).addClass("qpf-draggable"),(t?i(t):r).unbind("mousedown",this._mouseDown).bind("mousedown",{context:this},this._mouseDown);var o=new u({id:n,target:e,host:this,handle:t});return this.items[n]=o,o},remove:function(e){if(e instanceof u)var t=e,n=i(t.elem),r=t.id;else{var n=i(e),r=n.attr("data-qpf-draggable");if(r)var t=this.items[r]}delete this.items[r],n.removeAttr("data-qpf-draggable").removeClass("qpf-draggable"),(t.handle?i(t.handle):n).unbind("mousedown",this._mouseDown)},clear:function(){s.each(this.items,function(e){this.remove(e.target)},this)},_save:function(){s.each(this.items,function(e){var t=i(e.target),n=t.offsetParent(),r=t.position(),s=n.offset(),o={left:parseInt(t.css("marginLeft"))||0,top:parseInt(t.css("marginTop"))||0};e.margin=o,e.originPosition={left:r.left-o.left,top:r.top-o.top},e.offsetParentOffset=s,e.width=t.width(),e.height=t.height(),e.positionType=t.css("position")},this)},_restore:function(e){s.each(this.items,function(t){var n=i(t.target),r=n.offset();n.css("position",t.positionType),e?n.offset({left:t.originPosition.left+t.margin.left,top:t.originPosition.top+t.margin.top}):n.offset(r)},this)},_mouseDown:function(e){if(e.which!==1)return;var t=e.data.context;e.preventDefault(),t._save(),t._triggerProxy("dragstart",e),t.helper?(t._$helper=i(t.helper),document.body.appendChild(t._$helper[0]),t._$helper.css({left:e.pageX,top:e.pageY})):(s.each(t.items,function(e){var t=i(e.target);t.addClass("qpf-draggable-dragging"),t.css({position:"absolute",left:e.originPosition.left+"px",top:e.originPosition.top+"px"})},t),t.container?t._boundingBox=t._computeBoundingBox(t.container):t._boundingBox=null),i(document.body).unbind("mousemove",t._mouseMove).bind("mousemove",{context:t},t._mouseMove).unbind("mouseout",t._mouseOut).bind("mouseout",{context:t},t._mouseOut).unbind("mouseup",t._mouseUp).bind("mouseup",{context:t},t._mouseUp),t._mouseStart={x:e.pageX,y:e.pageY}},_computeBoundingBox:function(e){if(s.isArray(e))return{left:e[0][0],top:e[0][1],right:e[1][0],bottom:e[1][1]};if(e.left&&e.right&&e.top&&e.bottom)return e;try{var t=i(e),n=t.offset(),r={left:n.left+parseInt(t.css("padding-left"))||0,top:n.top+parseInt(t.css("padding-top"))||0,right:n.left+t.width()-parseInt(t.css("padding-right"))||0,bottom:n.top+t.height()-parseInt(t.css("padding-bottom"))||0};return r}catch(o){console.error("Invalid container type")}},_mouseMove:function(e){var t=e.data.context;t._triggerProxy("drag",e);var n={x:e.pageX-t._mouseStart.x,y:e.pageY-t._mouseStart.y};t._$helper?t._$helper.css({left:e.pageX,top:e.pageY}):s.each(t.items,function(e){var s=e.originPosition.left+e.offsetParentOffset.left+n.x,o=e.originPosition.top+e.offsetParentOffset.top+n.y;if(t._boundingBox){var u=t._boundingBox;s=s>u.left?s+e.width<u.right?s:u.right-e.width:u.left,o=o>u.top?o+e.height<u.bottom?o:u.bottom-e.height:u.top}var a=r.utils.unwrapObservable(t.axis);(!a||a.toLowerCase()!=="y")&&i(e.target).css("left",s-e.offsetParentOffset.left+"px"),(!a||a.toLowerCase()!=="x")&&i(e.target).css("top",o-e.offsetParentOffset.top+"px")},t)},_mouseUp:function(e){var t=e.data.context;i(document.body).unbind("mousemove",t._mouseMove).unbind("mouseout",t._mouseOut).unbind("mouseup",t._mouseUp),t._$helper?t._$helper.remove():s.each(t.items,function(e){var t=i(e.target);t.removeClass("qpf-draggable-dragging")},t),t._restore(),t._triggerProxy("dragend",e)},_mouseOut:function(e){},_triggerProxy:function(){var e=arguments;s.each(this.items,function(t){t.trigger.apply(t,e)})}}),f=function(){var e=1;return function(){return e++}}();return{applyTo:function(e,t){e.draggable=new a(t)}}}),o("components/meta/meta",["require","../base","knockout"],function(e){var t=e("../base"),n=e("knockout"),r=t.derive({},{type:"META",css:"meta"});return r.provideBinding=t.provideBinding,r}),o("components/meta/button",["require","./meta","core/xmlparser","knockout","$","_"],function(e){var t=e("./meta"),n=e("core/xmlparser"),r=e("knockout"),i=e("$"),s=e("_"),o=t.derive(function(){return{$el:i('<button data-bind="html:text"></button>'),text:r.observable("Button")}},{type:"BUTTON",css:"button",afterRender:function(){var e=this}});return t.provideBinding("button",o),n.provideParser("button",function(e){var t=n.util.getTextContent(e);if(t)return{text:t}}),o}),o("components/meta/checkbox",["require","./meta","knockout","$","_"],function(e){var t=e("./meta"),n=e("knockout"),r=e("$"),i=e("_"),s=t.derive(function(){return{checked:n.observable(!1),label:n.observable("")}},{template:'<input type="checkbox" data-bind="checked:checked" />                <span data-bind="css:{checked:checked}"></span>                <label data-bind="text:label"></label>',type:"CHECKBOX",css:"checkbox",afterRender:function(){var e=this;this.$el.click(function(){e.checked(!e.checked())})}});return t.provideBinding("checkbox",s),s}),o("components/meta/combobox",["require","./meta","core/xmlparser","knockout","$","_"],function(e){var t=e("./meta"),n=e("core/xmlparser"),r=e("knockout"),i=e("$"),s=e("_"),o=t.derive(function(){return{$el:i('<div data-bind="css:{active:active}" tabindex="0"></div>'),value:r.observable(),items:r.observableArray(),defaultText:r.observable("select"),active:r.observable(!1)}},{type:"COMBOBOX",css:"combobox",eventsProvided:s.union(t.prototype.eventsProvided,"change"),initialize:function(){this.selectedText=r.computed(function(){var e=this.value(),t=s.filter(this.items(),function(t){return r.utils.unwrapObservable(t.value)==e})[0];return typeof t=="undefined"?this.defaultText():r.utils.unwrapObservable(t.text)},this)},template:'<div class="qpf-combobox-selected" data-bind="click:_toggle">                    <div class="qpf-left" data-bind="html:selectedText"></div>                    <div class="qpf-right qpf-common-button">                        <div class="qpf-icon"></div>                    </div>                </div>                <ul class="qpf-combobox-items" data-bind="foreach:items">                    <li data-bind="html:text,attr:{\'data-qpf-value\':value},click:$parent._select.bind($parent,value),css:{selected:$parent._isSelected(value)}"></li>                </ul>',afterRender:function(){var e=this;this._$selected=this.$el.find(".qpf-combobox-selected"),this._$items=this.$el.find(".qpf-combobox-items"),this.$el.blur(function(){e._blur()})},_focus:function(){this.active(!0)},_blur:function(){this.active(!1)},_toggle:function(){this.active(!this.active())},_select:function(e){e=r.utils.unwrapObservable(e),this.value(e),this._blur()},_isSelected:function(e){return this.value()===r.utils.unwrapObservable(e)}});return t.provideBinding("combobox",o),n.provideParser("combobox",function(e){var t=[],r=n.util.getChildrenByTagName(e,"item");s.each(r,function(e){var r=e.getAttribute("value"),i=e.getAttribute("text")||n.util.getTextContent(e);r!==null&&t.push({value:r,text:i})});if(t.length)return{items:t}}),o}),o("components/meta/label",["require","./meta","core/xmlparser","knockout","$","_"],function(e){var t=e("./meta"),n=e("core/xmlparser"),r=e("knockout"),i=e("$"),s=e("_"),o=t.derive(function(){return{text:r.observable("Label")}},{template:'<Label data-bind="html:text"></Label>',type:"LABEL",css:"label"});return t.provideBinding("label",o),n.provideParser("label",function(e){var t=n.util.getTextContent(e);if(t)return{text:t}}),o}),o("components/meta/range",["require","./meta","../mixin/draggable","knockout","$","_"],function(e){var t=e("./meta"),n=e("../mixin/draggable"),r=e("knockout"),i=e("$"),s=e("_"),o=t.derive(function(){var e={$el:i('<div data-bind="css:orientation"></div>'),value:r.observable(0),step:r.observable(1),min:r.observable(-100),max:r.observable(100),orientation:r.observable("horizontal"),precision:r.observable(2),format:"{{value}}",_format:function(e){return this.format.replace("{{value}}",e)},autoResize:!0};return e.value=r.observable(1).extend({numeric:e.precision,clamp:{max:e.max,min:e.min}}),e},{type:"RANGE",css:"range",template:'<div class="qpf-range-groove-box">                    <div class="qpf-range-groove-outer">                        <div class="qpf-range-groove">                            <div class="qpf-range-percentage"></div>                        </div>                    </div>                </div>                <div class="qpf-range-min" data-bind="text:_format(min())"></div>                <div class="qpf-range-max" data-bind="text:_format(max())"></div>                <div class="qpf-range-slider">                    <div class="qpf-range-slider-inner"></div>                    <div class="qpf-range-value" data-bind="text:_format(value())"></div>                </div>',eventsProvided:s.union(t.prototype.eventsProvided,"change"),initialize:function(){n.applyTo(this,{axis:r.computed(function(){return this.orientation()=="horizontal"?"x":"y"},this)});var e=this.value();this.value.subscribe(function(t){this._$box&&this.updatePosition(),this.trigger("change",parseFloat(t),parseFloat(e),this),e=t},this)},afterRender:function(){this._$box=this.$el.find(".qpf-range-groove-box"),this._$percentage=this.$el.find(".qpf-range-percentage"),this._$slider=this.$el.find(".qpf-range-slider"),this.draggable.container=this.$el.find(".qpf-range-groove-box");var e=this.draggable.add(this._$slider);e.on("drag",this._dragHandler,this),this.updatePosition(),this.$el.mousedown(function(e){e.preventDefault()})},afterResize:function(){this.updatePosition(),t.prototype.afterResize.call(this)},_dragHandler:function(){var e=this.computePercentage(),t=parseFloat(this.min()),n=parseFloat(this.max()),r=(n-t)*e+t;this.value(r)},_cacheSize:function(){var e=this._isHorizontal();this._boxSize=e?this._$box.width():this._$box.height(),this._sliderSize=e?this._$slider.width():this._$slider.height()},computePercentage:function(){this.autoResize&&this._cacheSize();var e=this._computeOffset();return e/(this._boxSize-this._sliderSize)},_computeOffset:function(){var e=this._isHorizontal(),t=e?this._$box.offset().left:this._$box.offset().top,n=e?this._$slider.offset().left:this._$slider.offset().top;return n-t},_setOffset:function(e){var t=this._isHorizontal(),n=t?this._$box.offset().left:this._$box.offset().top,r=t?{left:n+e}:{top:n+e};this._$slider.offset(r)},updatePosition:function(){if(!this._$slider)return;this.autoResize&&this._cacheSize();var e=this.min(),t=this.max(),n=this.value(),r=(n-e)/(t-e),i=(this._boxSize-this._sliderSize)*r;this._boxSize>0?this._setOffset(i):this._$slider.css(this._isHorizontal()?"right":"bottom",(1-r)*100+"%"),this._$percentage.css(this._isHorizontal()?"width":"height",r*100+"%")},_isHorizontal:function(){return r.utils.unwrapObservable(this.orientation)=="horizontal"}});return t.provideBinding("range",o),o}),o("components/meta/spinner",["require","./meta","knockout","$","_"],function(e){function s(){this.value(parseFloat(this.value())+parseFloat(this.step()))}function o(){this.value(parseFloat(this.value())-parseFloat(this.step()))}var t=e("./meta"),n=e("knockout"),r=e("$"),i=e("_"),u=t.derive(function(){var e={step:n.observable(1),valueUpdate:"afterkeydown",precision:n.observable(2),min:n.observable(null),max:n.observable(null),increase:s,decrease:o};return e.value=n.observable(1).extend({numeric:e.precision,clamp:{max:e.max,min:e.min}}),e},{type:"SPINNER",css:"spinner",initialize:function(){var e=this.value()||0;this.value.subscribe(function(t){this.trigger("change",parseFloat(t),parseFloat(e),this),e=t},this)},eventsProvided:i.union(t.prototype.eventsProvided,"change"),template:'<div class="qpf-left">					<input type="text" class="qpf-spinner-value" data-bind="value:value,valueUpdate:valueUpdate" />				</div>				<div class="qpf-right">					<div class="qpf-common-button qpf-increase" data-bind="click:increase">					+</div>					<div class="qpf-common-button qpf-decrease" data-bind="click:decrease">					-</div>				</div>',afterRender:function(){var e=this;this.$el.find(".qpf-increase,.qpf-decrease").mousedown(function(e){e.preventDefault()}),this._$value=this.$el.find(".qpf-spinner-value"),this._$value.keydown(function(e){if(e.keyCode==46||e.keyCode==8||e.keyCode==9||e.keyCode==27||e.keyCode==190||e.keyCode==65&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39)return;(e.shiftKey||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105))&&e.preventDefault()}),this._$value.change(function(){this.value!==e.value().toString()&&(this.value=e.value())})}});return t.provideBinding("spinner",u),u}),o("components/meta/textfield",["require","./meta","knockout","_"],function(e){var t=e("./meta"),n=e("knockout"),r=e("_"),i=t.derive(function(){return{tag:"div",text:n.observable(""),placeholder:n.observable("")}},{type:"TEXTFIELD",css:"textfield",template:'<input type="text" data-bind="attr:{placeholder:placeholder}, value:text"/>',afterResize:function(){this.$el.find("input").width(this.width()),t.prototype.afterResize.call(this)}});return t.provideBinding("textfield",i),i}),o("components/container/container",["require","../base","knockout","$","_"],function(e){var t=e("../base"),n=e("knockout"),r=e("$"),i=e("_"),s=t.derive(function(){return{children:n.observableArray()}},{type:"CONTAINER",css:"container",template:'<div data-bind="foreach:children" class="qpf-children">                    <div data-bind="qpf_view:$data"></div>                </div>',initialize:function(){function r(){e.remove(this)}var e=this,t=this.children().slice();this.children.subscribe(function(e){var s=n.utils.compareArrays(t,e);i.each(s,function(e){e.status=="added"?e.value.on("dispose",r,e.value):e.status=="deleted"&&e.value.off("dispose",r)},this)})},add:function(e){e.parent=this,this.children.push(e)},remove:function(e){e.parent=null,this.children.remove(e)},removeAll:function(){i.each(this.children(),function(e){this.remove(e)},this)},children:function(){return this.children()},doRender:function(){t.prototype.doRender.call(this),i.each(this.children(),function(e){e.render()})},afterResize:function(){this.height()&&this.$el.children(".qpf-children").height(this.height()),i.each(this.children(),function(e){e.afterResize()},this),t.prototype.afterResize.call(this)},dispose:function(){i.each(this.children(),function(e){e.dispose()}),t.prototype.dispose.call(this)},get:function(e){if(!e)return;return i.filter(this.children(),function(t){return t.name===e})[0]}});s.provideBinding=t.provideBinding;var o=n.bindingHandlers.qpf;return n.bindingHandlers.qpf={init:function(e,r,u,a){var f=Array.prototype.slice.call(e.childNodes),l=o.createComponent(e,r);if(l&&l.instanceof(s)){var c={__deferredrender__:!0};i.extend(c,a);for(var h=0;h<f.length;h++){var p=f[h];if(n.bindingProvider.prototype.nodeHasBindings(p)){n.applyBindings(c,p);var d=t.getByDom(p);d&&l.add(d)}}}return a.__deferredrender__||l.render(),{controlsDescendantBindings:!0}},update:function(e,t){o.update(e,t)}},s.provideBinding("container",s),s}),o("components/container/panel",["require","./container","knockout","$"],function(e){var t=e("./container"),n=e("knockout"),r=e("$"),i=t.derive(function(){return{title:n.observable("")}},{type:"PANEL",css:"panel",template:'<div class="qpf-panel-header">                    <div class="qpf-panel-title" data-bind="html:title"></div>                    <div class="qpf-panel-tools"></div>                </div>                <div class="qpf-panel-body" data-bind="foreach:children" class="qpf-children">                    <div data-bind="qpf_view:$data"></div>                </div>                <div class="qpf-panel-footer"></div>',afterRender:function(){var e=this.$el;this._$header=e.children(".qpf-panel-header"),this._$tools=this._$header.children(".qpf-panel-tools"),this._$body=e.children(".qpf-panel-body"),this._$footer=e.children(".qpf-panel-footer")},afterResize:function(){if(this._$body&&this.height()){var e=this._$header.height(),n=this._$footer.height();this._$body.height(this.$el.height()-e-n)}t.prototype.afterResize.call(this)}});return t.provideBinding("panel",i),i}),o("components/container/window",["require","./container","./panel","../mixin/draggable","knockout","$","_"],function(e){var t=e("./container"),n=e("./panel"),r=e("../mixin/draggable"),i=e("knockout"),s=e("$"),o=e("_"),u=n.derive(function(){return{$el:s('<div data-bind="style:{left:_leftPx, top:_topPx}"></div>'),children:i.observableArray(),title:i.observable("Window"),left:i.observable(0),top:i.observable(0),_leftPx:i.computed(function(){return this.left()+"px"},this,{deferEvaluation:!0}),_topPx:i.computed(function(){return this.top()+"px"},this,{deferEvaluation:!0})}},{type:"WINDOW",css:o.union("window",n.prototype.css),initialize:function(){r.applyTo(this),n.prototype.initialize.call(this)},afterRender:function(){n.prototype.afterRender.call(this),this.draggable.add(this.$el,this._$header)}});return t.provideBinding("window",u),u}),o("components/container/tab",["require","./container","./panel","knockout","$","_"],function(e){var t=e("./container"),n=e("./panel"),r=e("knockout"),i=e("$"),s=e("_"),o=n.derive(function(){var e={actived:r.observable(0),maxTabWidth:100,minTabWidth:30};return e.actived.subscribe(function(e){this._active(e)},this),e},{type:"TAB",css:"tab",add:function(e){e.instanceof(n)?n.prototype.add.call(this,e):console.error("Children of tab container must be instance of panel"),this._active(this.actived())},eventsProvided:s.union("change",t.prototype.eventsProvided),initialize:function(){this.children.subscribe(function(){this._updateTabSize()},this),n.prototype.initialize.call(this)},template:'<div class="qpf-tab-header">                    <ul class="qpf-tab-tabs" data-bind="foreach:children">                        <li data-bind="click:$parent.actived.bind($data, $index())">                            <a data-bind="html:title"></a>                        </li>                    </ul>                    <div class="qpf-tab-tools"></div>                </div>                <div class="qpf-tab-body">                    <div class="qpf-tab-views" data-bind="foreach:children" class="qpf-children">                        <div data-bind="qpf_view:$data"></div>                    </div>                </div>                <div class="qpf-tab-footer"></div>',afterRender:function(){this._updateTabSize();var e=this.$el;this._$header=e.children(".qpf-tab-header"),this._$tools=this._$header.children(".qpf-tab-tools"),this._$body=e.children(".qpf-tab-body"),this._$footer=e.children(".qpf-tab-footer"),this._active(this.actived())},afterResize:function(){this._adjustCurrentSize(),this._updateTabSize(),t.prototype.afterResize.call(this)},_unActiveAll:function(){s.each(this.children(),function(e){e.$el.css("display","none")})},_updateTabSize:function(){var e=this.children().length,t=Math.floor((this.$el.width()-20)/e);t=Math.min(this.maxTabWidth,Math.max(this.minTabWidth,t)),this.$el.find(".qpf-tab-header>.qpf-tab-tabs>li").width(t)},_adjustCurrentSize:function(){var e=this.children()[this.actived()];if(e&&this._$body){var t=this._$header.height(),n=this._$footer.height();this.height()&&this.height()!=="auto"&&e.height(this.$el.height()-t-n),this.width()=="auto"}},_active:function(e){this._unActiveAll();var t=this.children()[e];t&&(t.$el.css("display","block"),this._adjustCurrentSize(),t.afterResize(),this.trigger("change",e,t)),this.$el.find(".qpf-tab-header>.qpf-tab-tabs>li").removeClass("actived").eq(e).addClass("actived")}});return t.provideBinding("tab",o),o}),o("components/container/box",["require","./container","knockout","$","_"],function(e){var t=e("./container"),n=e("knockout"),r=e("$"),i=e("_"),s=t.derive(function(){return{}},{type:"BOX",css:"box",initialize:function(){this.children.subscribe(function(e){this.afterResize()},this),this.$el.css("position","relative"),t.prototype.initialize.call(this)},_getMargin:function(e){return{left:parseInt(e.css("marginLeft"))||0,top:parseInt(e.css("marginTop"))||0,bottom:parseInt(e.css("marginBottom"))||0,right:parseInt(e.css("marginRight"))||0}},_resizeTimeout:0,afterResize:function(){var e=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(function(){e.resizeChildren(),t.prototype.afterResize.call(e)})}});return s}),o("components/container/vbox",["require","./container","./box","knockout","$","_"],function(e){var t=e("./container"),n=e("./box"),r=e("knockout"),i=e("$"),s=e("_"),o=n.derive(function(){return{}},{type:"VBOX",css:"vbox",resizeChildren:function(){var e=0,t=this.$el.height(),n=[];marginCache=[],marginCacheWithFlex=[],s.each(this.children(),function(i){var s=this._getMargin(i.$el);marginCache.push(s),i.width(this.$el.width()-s.left-s.right);var o=r.utils.unwrapObservable(i.prefer);if(o)o=Math.min(o,t),i.height(o),t-=o+s.top+s.bottom;else{var u=parseInt(r.utils.unwrapObservable(i.flex)||1);n.push(i),marginCacheWithFlex.push(s),e+=u}},this),s.each(n,function(n,i){var s=marginCacheWithFlex[i],o=parseInt(r.utils.unwrapObservable(n.flex)||1),u=o/e;n.height(Math.floor(t*u)-s.top-s.bottom)});var i=0;s.each(this.children(),function(e,t){var n=marginCache[t];e.$el.css({position:"absolute",left:"0px",top:i+"px"}),i+=e.height()+n.top+n.bottom})}});return t.provideBinding("vbox",o),o}),o("components/container/hbox",["require","./container","./box","knockout","$","_"],function(e){var t=e("./container"),n=e("./box"),r=e("knockout"),i=e("$"),s=e("_"),o=n.derive(function(){return{}},{type:"HBOX",css:"hbox",resizeChildren:function(){var e=0,t=this.$el.width(),n=[],i=[],o=[];s.each(this.children(),function(s,u){var a=this._getMargin(s.$el);i.push(a),s.height(this.$el.height()-a.top-a.bottom);var f=r.utils.unwrapObservable(s.prefer);if(f)f=Math.min(f,t),s.width(f),t-=f+a.left+a.right;else{var l=parseInt(r.utils.unwrapObservable(s.flex)||1);n.push(s),o.push(a),e+=l}},this),s.each(n,function(n,i){var s=o[i],u=parseInt(r.utils.unwrapObservable(n.flex)||1),a=u/e;n.width(Math.floor(t*a)-s.left-s.right)});var u=0;s.each(this.children(),function(e,t){var n=i[t];e.$el.css({position:"absolute",top:"0px",left:u+"px"}),u+=e.width()+n.left+n.right})}});return t.provideBinding("hbox",o),o}),o("components/container/inline",["require","./container","knockout","$"],function(e){var t=e("./container"),n=e("knockout"),r=e("$"),i=t.derive({},{type:"INLINE",css:"inline",template:'<div data-bind="foreach:children" class="qpf-children">                    <div data-bind="qpf_view:$data"></div>                </div>                <div style="clear:both"></div>'});return t.provideBinding("inline",i),i}),o("components/container/application",["require","./container","knockout","$"],function(e){var t=e("./container"),n=e("knockout"),r=e("$"),i=t.derive(function(){},{type:"APPLICATION",css:"application",initialize:function(){r(window).resize(this._resize.bind(this)),this._resize()},_resize:function(){this.width(r(window).width()),this.height(r(window).height())}});return t.provideBinding("application",i),i}),o("components/widget/widget",["require","../base","../meta/meta","../container/container","knockout","_"],function(e){var t=e("../base"),n=e("../meta/meta"),r=e("../container/container"),i=e("knockout"),s=e("_"),o=t.derive({},{type:"WIDGET",css:"widget"});return o.provideBinding=t.provideBinding,o.provideBinding("widget",o),o}),o("components/widget/vector",["require","./widget","../base","core/xmlparser","knockout","$","../meta/spinner","../meta/range","_"],function(e){var t=e("./widget"),n=e("../base"),r=e("core/xmlparser"),i=e("knockout"),s=e("$"),o=e("../meta/spinner"),u=e("../meta/range"),a=e("_"),f=t.derive(function(){return{items:i.observableArray(),constrainProportion:i.observable(!1),constrainType:i.observable("diff"),_toggleConstrain:function(){this.constrainProportion(!this.constrainProportion())},_constrainRatio:[],_constrainDiff:[],_sub:[]}},{type:"VECTOR",css:"vector",initialize:function(){this.$el.attr("data-bind",'css:{"qpf-vector-constrain":constrainProportion}'),this.items.subscribe(function(e){this._$list&&(this._cacheSubComponents(),this._updateConstraint())},this),this.constrainProportion.subscribe(function(e){e&&this._computeContraintInfo()},this)},eventsProvided:a.union(t.prototype.eventsProvided,"change"),template:'<div class="qpf-left">                    <div class="qpf-vector-link" data-bind="click:_toggleConstrain"></div>                </div>                <div class="qpf-right" >                    <ul class="qpf-list" data-bind="foreach:items">                        <li data-bind="qpf:$data"></li>                    </ul>                </div>',afterRender:function(){this._$list=this.$el.find(".qpf-list"),this._cacheSubComponents(),this._updateConstraint()},afterResize:function(){a.each(this._sub,function(e){e.afterResize()}),t.prototype.afterResize.call(this)},dispose:function(){a.each(this._sub,function(e){e.dispose()}),n.prototype.dispose.call(this)},_cacheSubComponents:function(){var e=this;e._sub=[],this._$list.children().each(function(){var t=n.getByDom(this);e._sub.push(t)}),this._computeContraintInfo()},_computeContraintInfo:function(){this._constrainDiff=[],this._constrainRatio=[],a.each(this._sub,function(e,t){var n=this._sub[t+1];if(!n)return;var r=e.value(),i=n.value();this._constrainDiff.push(i-r),this._constrainRatio.push(r==0?1:i/r)},this)},_updateConstraint:function(){a.each(this._sub,function(e){e.on("change",this._constrainHandler,this)},this)},_constrainHandler:function(e,t,n){if(this.constrainProportion()){var r=this._sub.indexOf(n),i=this.constrainType();for(var s=r;s>0;s--){var o=this._sub[s].value,u=this._sub[s-1].value;if(i=="diff"){var a=this._constrainDiff[s-1];u(o()-a)}else if(i=="ratio"){var f=this._constrainRatio[s-1];u(o()/f)}}for(var s=r;s<this._sub.length-1;s++){var o=this._sub[s].value,l=this._sub[s+1].value;if(i=="diff"){var a=this._constrainDiff[s];l(o()+a)}else if(i=="ratio"){var f=this._constrainRatio[s];l(o()*f)}}}}});return t.provideBinding("vector",f),r.provideParser("vector",function(e){var t=[],n=r.util.getChildren(e);a.chain(n).filter(function(e){var t=e.tagName&&e.tagName.toLowerCase();return t&&(t==="spinner"||t==="range")}).each(function(e){var n=r.util.convertAttributes(e.attributes);n.type=e.tagName.toLowerCase(),t.push(n)});if(t.length)return{items:t}}),f}),o("components/widget/color_vm",["require","knockout","core/clazz","_"],function(e){function i(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n),s,o,u=r,a=r-i;o=r==0?0:a/r;if(r==i)s=0;else{switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4}s/=6}return[s*360,o*100,u*100]}function s(e,t,n){e/=360,t/=100,n/=100;var r,i,s,o=Math.floor(e*6),u=e*6-o,a=n*(1-t),f=n*(1-u*t),l=n*(1-(1-u)*t);switch(o%6){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;case 5:r=n,i=a,s=f}return[Math.round(r*255),Math.round(i*255),Math.round(s*255)]}function o(e){var t=e>>16&255,n=e>>8&255,r=e&255;return[t,n,r]}function u(e,t,n){return e<<16|t<<8|n}function a(e){var t=o(e);return i(t[0],t[1],t[2])}function f(e,t,n){return u(s(e,t,n))}var t=e("knockout"),n=e("core/clazz"),r=e("_"),l=n.derive({_r:t.observable().extend({numeric:0}),_g:t.observable().extend({numeric:0}),_b:t.observable().extend({numeric:0}),_h:t.observable().extend({clamp:{min:0,max:360}}),_s:t.observable().extend({clamp:{min:0,max:100}}),_v:t.observable().extend({clamp:{min:0,max:100}}),alpha:t.observable(1).extend({numeric:2,clamp:{min:0,max:1}})},function(){this.hex=t.computed({read:function(){return u(this._r(),this._g(),this._b())},write:function(e){var t=a(e);this._h(t[0]),this._s(t[1]),this._v(t[2])}},this),this.rgb=t.computed({read:function(){var e=s(this._h(),this._s(),this._v());return this._r(e[0]),this._g(e[1]),this._b(e[2]),e}},this),this.hsv=t.computed(function(){return[this._h(),this._s(),this._v()]},this),this.set=function(e){var t=a(e),n=o(e);this._h(t[0]),this._s(t[1]),this._v(t[2]),this._r(n[0]),this._g(n[1]),this._b(n[2])},this.hexString=t.computed({read:function(){var e=this.hex().toString(16),t=[];for(var n=0;n<6-e.length;n++)t.push("0");return t.join("")+e},write:function(){}},this),this.hueRGB=t.computed(function(){return"rgb("+s(this._h(),100,100).join(",")+")"},this);var e=["_r","_g","_b"];this.rgbVector=[];for(var n=0;n<3;n++)this.rgbVector.push({type:"spinner",min:0,max:255,step:1,precision:0,value:this[e[n]]});var e=["_h","_s","_v"];this.hsvVector=[];for(var n=0;n<3;n++)this.hsvVector.push({type:"spinner",min:0,max:100,step:1,precision:0,value:this[e[n]]});this.hsvVector[0].max=360,this.set(16777215)});return l.intToRgb=o,l.rgbToInt=u,l.rgbToHsv=i,l.hsvToRgb=s,l.intToHsv=a,l.hsvToInt=f,l}),o("components/widget/palette",["require","./widget","knockout","./color_vm","$","_","components/widget/vector","components/meta/textfield","components/meta/range"],function(e){var t=e("./widget"),n=e("knockout"),r=e("./color_vm"),i=e("$"),s=e("_");e("components/widget/vector"),e("components/meta/textfield"),e("components/meta/range");var o=t.derive(function(){var e=new r,t=this;return s.extend(e,{_recent:n.observableArray(),_recentMax:5}),e},{type:"PALETTE",css:"palette",eventsProvided:s.union(t.prototype.eventsProvided,["change","apply"]),template:'<div class="qpf-palette-adjuster">                    <div class="qpf-left">                        <div class="qpf-palette-picksv" data-bind="style:{backgroundColor:hueRGB}">                            <div class="qpf-palette-saturation">                                <div class="qpf-palette-value"></div>                            </div>                            <div class="qpf-palette-picker"></div>                        </div>                        <div class="qpf-palette-pickh">                            <div class="qpf-palette-picker"></div>                        </div>                        <div style="clear:both"></div>                        <div class="qpf-palette-alpha">                            <div data-bind="qpf:{type:\'range\', min:0, max:1, value:alpha, precision:2}"></div>                        </div>                    </div>                    <div class="qpf-right">                        <div class="qpf-palette-rgb">                            <div data-bind="qpf:{type:\'label\', text:\'RGB\'}"></div>                            <div data-bind="qpf:{type:\'vector\', items:rgbVector}"></div>                        </div>                        <div class="qpf-palette-hsv">                            <div data-bind="qpf:{type:\'label\', text:\'HSV\'}"></div>                            <div data-bind="qpf:{type:\'vector\', items:hsvVector}"></div>                        </div>                        <div class="qpf-palette-hex">                            <div data-bind="qpf:{type:\'label\', text:\'#\'}"></div>                            <div data-bind="qpf:{type:\'textfield\',text:hexString}"></div>                        </div>                    </div>                </div>                <div style="clear:both"></div>                <ul class="qpf-palette-recent" data-bind="foreach:_recent">                    <li data-bind="style:{backgroundColor:rgbString},                                    attr:{title:hexString},                                    click:$parent.hex.bind($parent, hex)"></li>                </ul>                <div class="qpf-palette-buttons">                    <div data-bind="qpf:{type:\'button\', text:\'Cancel\', class:\'small\', onclick:_cancel.bind($data)}"></div>                    <div data-bind="qpf:{type:\'button\', text:\'Apply\', class:\'small\', onclick:_apply.bind($data)}"></div>                </div>',initialize:function(){this.hsv.subscribe(function(e){this._setPickerPosition(),this.trigger("change",this.hex())},this),this._h.subscribe(this._setPickerPosition,this)},afterRender:function(){this._$svSpace=i(".qpf-palette-picksv"),this._$hSpace=i(".qpf-palette-pickh"),this._$svPicker=this._$svSpace.children(".qpf-palette-picker"),this._$hPicker=this._$hSpace.children(".qpf-palette-picker"),this._svSize=this._$svSpace.height(),this._hSize=this._$hSpace.height(),this._setPickerPosition(),this._setupSvDragHandler(),this._setupHDragHandler()},_setupSvDragHandler:function(){var e=this,t=function(t){var n=e._$svSpace.offset(),r=t.pageX-n.left,i=t.pageY-n.top;return{left:r,top:i}},n=function(n){var r=t(n);e._computeSV(r.left,r.top)},r=function(e){i(document.body).unbind("mousemove",n).unbind("mouseup",r).unbind("mousedown",s)},s=function(e){e.preventDefault()};this._$svSpace.mousedown(function(o){var u=t(o);e._computeSV(u.left,u.top),i(document.body).bind("mousemove",n).bind("mouseup",r).bind("mousedown",s)})},_setupHDragHandler:function(){var e=this,t=function(t){var n=e._$hSpace.offset(),r=t.pageY-n.top;return r},n=function(n){e._computeH(t(n))},r=function(e){e.preventDefault()},s=function(e){i(document.body).unbind("mousemove",n).unbind("mouseup",s).unbind("mousedown",r)};this._$hSpace.mousedown(function(o){e._computeH(t(o)),i(document.body).bind("mousemove",n).bind("mouseup",s).bind("mousedown",r)})},_computeSV:function(e,t){var n=e/this._svSize,r=(this._svSize-t)/this._svSize;this._s(n*100),this._v(r*100)},_computeH:function(e){this._h(e/this._hSize*360)},_setPickerPosition:function(){if(this._$svPicker){var e=this.hsv(),t=e[0],n=e[1],r=e[2];this._$svPicker.css({left:Math.round(n/100*this._svSize)+"px",top:Math.round((100-r)/100*this._svSize)+"px"}),this._$hPicker.css({top:Math.round(t/360*this._hSize)+"px"})}},_apply:function(){this._recent().length>this._recentMax&&this._recent.shift(),this._recent.push({rgbString:"rgb("+this.rgb().join(",")+")",hexString:this.hexString(),hex:this.hex()}),this.trigger("apply",this.hex())},_cancel:function(){}});return t.provideBinding("palette",o),o}),o("src/qpf",["require","core/xmlparser","core/mixin/derive","core/mixin/event","components/base","components/util","components/mixin/draggable","components/meta/meta","components/meta/button","components/meta/checkbox","components/meta/combobox","components/meta/label","components/meta/range","components/meta/spinner","components/meta/textfield","components/container/container","components/container/panel","components/container/window","components/container/tab","components/container/vbox","components/container/hbox","components/container/inline","components/container/application","components/widget/widget","components/widget/vector","components/widget/palette"],function(e){return console.log("qpf is loaded"),{core:{xmlparser:e("core/xmlparser"),mixin:{derive:e("core/mixin/derive"),event:e("core/mixin/event")}},components:{base:e("components/base"),util:e("components/util"),mixin:{draggable:e("components/mixin/draggable")},meta:{meta:e("components/meta/meta"),button:e("components/meta/button"),checkbox:e("components/meta/checkbox"),combobox:e("components/meta/combobox"),label:e("components/meta/label"),range:e("components/meta/range"),spinner:e("components/meta/spinner"),textfield:e("components/meta/textfield")},container:{container:e("components/container/container"),panel:e("components/container/panel"),window:e("components/container/window"),tab:e("components/container/tab"),vbox:e("components/container/vbox"),hbox:e("components/container/hbox"),inline:e("components/container/inline"),application:e("components/container/application")},widget:{widget:e("components/widget/widget"),vector:e("components/widget/vector"),palette:e("components/widget/palette")}}}});var a=s("src/qpf");e.use=function(e){return s(e)};for(var f in a)e[f]=a[f]}),function(){var e=!0;(function(t,n,r,i,s){!function(e){if(typeof require=="function"&&typeof exports=="object"&&typeof module=="object"){var n=module.exports||exports;e(n)}else typeof define=="function"&&define.amd?define("knockout",["exports"],e):e(t.ko={})}(function(o){function a(e){var t=this;if(e)for(var n in e){var r=u.extenders[n];typeof r=="function"&&(t=r(t,e[n]))}return t}function v(e){u.bindingHandlers[e]={init:function(t,n,r,i){var s=function(){var t={};return t[e]=n(),t};return u.bindingHandlers.event.init.call(this,t,s,r,i)}}}function y(e,t,n,r){u.bindingHandlers[e]={init:function(e,t,n,r,i){return u.utils.domData.set(e,g,{}),{controlsDescendantBindings:!0}},update:function(e,i,s,o,a){var f=u.utils.domData.get(e,g),l=u.utils.unwrapObservable(i()),c=!n!=!l,h=!f.savedNodes,p=h||t||c!==f.didDisplayOnLastUpdate;p&&(h&&(f.savedNodes=u.utils.cloneNodes(u.virtualElements.childNodes(e),!0)),c?(h||u.virtualElements.setDomNodeChildren(e,u.utils.cloneNodes(f.savedNodes)),u.applyBindingsToDescendants(r?r(a,l):a,e)):u.virtualElements.emptyNode(e),f.didDisplayOnLastUpdate=c)}},u.expressionRewriting.bindingRewriteValidators[e]=!1,u.virtualElements.allowedBindings[e]=!0}function b(e,t,n){n&&t!==u.selectExtensions.readValue(e)&&u.selectExtensions.writeValue(e,t),t!==u.selectExtensions.readValue(e)&&u.dependencyDetection.ignore(u.utils.triggerEvent,null,[e,"change"])}var u=typeof o!="undefined"?o:{};u.exportSymbol=function(e,t){var n=e.split("."),r=u;for(var i=0;i<n.length-1;i++)r=r[n[i]];r[n[n.length-1]]=t},u.exportProperty=function(e,t,n){e[t]=n},u.version="2.2.0",u.exportSymbol("version",u.version),u.utils=new function(){function y(e,t){if(u.utils.tagNameLower(e)!=="input"||!e.type)return!1;if(t.toLowerCase()!="click")return!1;var n=e.type;return n=="checkbox"||n=="radio"}var e=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,o={},a={},f=/Firefox\/2/i.test(r.userAgent)?"KeyboardEvent":"UIEvents";o[f]=["keyup","keydown","keypress"],o.MouseEvents=["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave"];for(var l in o){var c=o[l];if(c.length)for(var h=0,p=c.length;h<p;h++)a[c[h]]=l}var d={propertychange:!0},v=function(){var e=3,t=n.createElement("div"),r=t.getElementsByTagName("i");while(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",r[0]);return e>4?e:s}(),m=v===6,g=v===7;return{fieldsIncludedWithJsonPost:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],arrayForEach:function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n])},arrayIndexOf:function(e,t){if(typeof Array.prototype.indexOf=="function")return Array.prototype.indexOf.call(e,t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},arrayFirst:function(e,t,n){for(var r=0,i=e.length;r<i;r++)if(t.call(n,e[r]))return e[r];return null},arrayRemoveItem:function(e,t){var n=u.utils.arrayIndexOf(e,t);n>=0&&e.splice(n,1)},arrayGetDistinctValues:function(e){e=e||[];var t=[];for(var n=0,r=e.length;n<r;n++)u.utils.arrayIndexOf(t,e[n])<0&&t.push(e[n]);return t},arrayMap:function(e,t){e=e||[];var n=[];for(var r=0,i=e.length;r<i;r++)n.push(t(e[r]));return n},arrayFilter:function(e,t){e=e||[];var n=[];for(var r=0,i=e.length;r<i;r++)t(e[r])&&n.push(e[r]);return n},arrayPushAll:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,r=t.length;n<r;n++)e.push(t[n]);return e},extend:function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},emptyDomNode:function(e){while(e.firstChild)u.removeNode(e.firstChild)},moveCleanedNodesToContainerElement:function(e){var t=u.utils.makeArray(e),r=n.createElement("div");for(var i=0,s=t.length;i<s;i++)r.appendChild(u.cleanNode(t[i]));return r},cloneNodes:function(e,t){for(var n=0,r=e.length,i=[];n<r;n++){var s=e[n].cloneNode(!0);i.push(t?u.cleanNode(s):s)}return i},setDomNodeChildren:function(e,t){u.utils.emptyDomNode(e);if(t)for(var n=0,r=t.length;n<r;n++)e.appendChild(t[n])},replaceDomNodes:function(e,t){var n=e.nodeType?[e]:e;if(n.length>0){var r=n[0],i=r.parentNode;for(var s=0,o=t.length;s<o;s++)i.insertBefore(t[s],r);for(var s=0,o=n.length;s<o;s++)u.removeNode(n[s])}},setOptionNodeSelectionState:function(e,t){v<7?e.setAttribute("selected",t):e.selected=t},stringTrim:function(t){return(t||"").replace(e,"")},stringTokenize:function(e,t){var n=[],r=(e||"").split(t);for(var i=0,s=r.length;i<s;i++){var o=u.utils.stringTrim(r[i]);o!==""&&n.push(o)}return n},stringStartsWith:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},domNodeIsContainedBy:function(e,t){if(t.compareDocumentPosition)return(t.compareDocumentPosition(e)&16)==16;while(e!=null){if(e==t)return!0;e=e.parentNode}return!1},domNodeIsAttachedToDocument:function(e){return u.utils.domNodeIsContainedBy(e,e.ownerDocument)},tagNameLower:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},registerEventHandler:function(e,t,n){var r=v&&d[t];if(!r&&typeof i!="undefined"){if(y(e,t)){var s=n;n=function(e,t){var n=this.checked;t&&(this.checked=t.checkedStateBeforeEvent!==!0),s.call(this,e),this.checked=n}}i(e).bind(t,n)}else if(!r&&typeof e.addEventListener=="function")e.addEventListener(t,n,!1);else{if(typeof e.attachEvent=="undefined")throw new Error("Browser doesn't support addEventListener or attachEvent");e.attachEvent("on"+t,function(t){n.call(e,t)})}},triggerEvent:function(e,r){if(!e||!e.nodeType)throw new Error("element must be a DOM node when calling triggerEvent");if(typeof i!="undefined"){var s=[];y(e,r)&&s.push({checkedStateBeforeEvent:e.checked}),i(e).trigger(r,s)}else if(typeof n.createEvent=="function"){if(typeof e.dispatchEvent!="function")throw new Error("The supplied element doesn't support dispatchEvent");var o=a[r]||"HTMLEvents",u=n.createEvent(o);u.initEvent(r,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(u)}else{if(typeof e.fireEvent=="undefined")throw new Error("Browser doesn't support triggering events");y(e,r)&&(e.checked=e.checked!==!0),e.fireEvent("on"+r)}},unwrapObservable:function(e){return u.isObservable(e)?e():e},peekObservable:function(e){return u.isObservable(e)?e.peek():e},toggleDomNodeCssClass:function(e,t,n){if(t){var r=/[\w-]+/g,i=e.className.match(r)||[];u.utils.arrayForEach(t.match(r),function(e){var t=u.utils.arrayIndexOf(i,e);t>=0?n||i.splice(t,1):n&&i.push(e)}),e.className=i.join(" ")}},setTextContent:function(e,t){var r=u.utils.unwrapObservable(t);if(r===null||r===s)r="";if(e.nodeType===3)e.data=r;else{var i=u.virtualElements.firstChild(e);!i||i.nodeType!=3||u.virtualElements.nextSibling(i)?u.virtualElements.setDomNodeChildren(e,[n.createTextNode(r)]):i.data=r,u.utils.forceRefresh(e)}},setElementName:function(e,t){e.name=t;if(v<=7)try{e.mergeAttributes(n.createElement("<input name='"+e.name+"'/>"),!1)}catch(r){}},forceRefresh:function(e){if(v>=9){var t=e.nodeType==1?e:e.parentNode;t.style&&(t.style.zoom=t.style.zoom)}},ensureSelectElementIsRenderedCorrectly:function(e){if(v>=9){var t=e.style.width;e.style.width=0,e.style.width=t}},range:function(e,t){e=u.utils.unwrapObservable(e),t=u.utils.unwrapObservable(t);var n=[];for(var r=e;r<=t;r++)n.push(r);return n},makeArray:function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t},isIe6:m,isIe7:g,ieVersion:v,getFormFields:function(e,t){var n=u.utils.makeArray(e.getElementsByTagName("input")).concat(u.utils.makeArray(e.getElementsByTagName("textarea"))),r=typeof t=="string"?function(e){return e.name===t}:function(e){return t.test(e.name)},i=[];for(var s=n.length-1;s>=0;s--)r(n[s])&&i.push(n[s]);return i},parseJson:function(e){if(typeof e=="string"){e=u.utils.stringTrim(e);if(e)return t.JSON&&t.JSON.parse?t.JSON.parse(e):(new Function("return "+e))()}return null},stringifyJson:function(e,t,n){if(typeof JSON=="undefined"||typeof JSON.stringify=="undefined")throw new Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return JSON.stringify(u.utils.unwrapObservable(e),t,n)},postJson:function(e,t,r){r=r||{};var i=r.params||{},s=r.includeFields||this.fieldsIncludedWithJsonPost,o=e;if(typeof e=="object"&&u.utils.tagNameLower(e)==="form"){var a=e;o=a.action;for(var f=s.length-1;f>=0;f--){var l=u.utils.getFormFields(a,s[f]);for(var c=l.length-1;c>=0;c--)i[l[c].name]=l[c].value}}t=u.utils.unwrapObservable(t);var h=n.createElement("form");h.style.display="none",h.action=o,h.method="post";for(var p in t){var d=n.createElement("input");d.name=p,d.value=u.utils.stringifyJson(u.utils.unwrapObservable(t[p])),h.appendChild(d)}for(var p in i){var d=n.createElement("input");d.name=p,d.value=i[p],h.appendChild(d)}n.body.appendChild(h),r.submitter?r.submitter(h):h.submit(),setTimeout(function(){h.parentNode.removeChild(h)},0)}}},u.exportSymbol("utils",u.utils),u.exportSymbol("utils.arrayForEach",u.utils.arrayForEach),u.exportSymbol("utils.arrayFirst",u.utils.arrayFirst),u.exportSymbol("utils.arrayFilter",u.utils.arrayFilter),u.exportSymbol("utils.arrayGetDistinctValues",u.utils.arrayGetDistinctValues),u.exportSymbol("utils.arrayIndexOf",u.utils.arrayIndexOf),u.exportSymbol("utils.arrayMap",u.utils.arrayMap),u.exportSymbol("utils.arrayPushAll",u.utils.arrayPushAll),u.exportSymbol("utils.arrayRemoveItem",u.utils.arrayRemoveItem),u.exportSymbol("utils.extend",u.utils.extend),u.exportSymbol("utils.fieldsIncludedWithJsonPost",u.utils.fieldsIncludedWithJsonPost),u.exportSymbol("utils.getFormFields",u.utils.getFormFields),u.exportSymbol("utils.peekObservable",u.utils.peekObservable),u.exportSymbol("utils.postJson",u.utils.postJson),u.exportSymbol("utils.parseJson",u.utils.parseJson),u.exportSymbol("utils.registerEventHandler",u.utils.registerEventHandler),u.exportSymbol("utils.stringifyJson",u.utils.stringifyJson),u.exportSymbol("utils.range",u.utils.range),u.exportSymbol("utils.toggleDomNodeCssClass",u.utils.toggleDomNodeCssClass),u.exportSymbol("utils.triggerEvent",u.utils.triggerEvent),u.exportSymbol("utils.unwrapObservable",u.utils.unwrapObservable),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments),e=n.shift();return function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}}),u.utils.domData=new function(){var e=0,t="__ko__"+(new Date).getTime(),n={};return{get:function(e,t){var n=u.utils.domData.getAll(e,!1);return n===s?s:n[t]},set:function(e,t,n){if(n===s&&u.utils.domData.getAll(e,!1)===s)return;var r=u.utils.domData.getAll(e,!0);r[t]=n},getAll:function(r,i){var o=r[t],u=o&&o!=="null"&&n[o];if(!u){if(!i)return s;o=r[t]="ko"+e++,n[o]={}}return n[o]},clear:function(e){var r=e[t];return r?(delete n[r],e[t]=null,!0):!1}}},u.exportSymbol("utils.domData",u.utils.domData),u.exportSymbol("utils.domData.clear",u.utils.domData.clear),u.utils.domNodeDisposal=new function(){function r(t,n){var r=u.utils.domData.get(t,e);return r===s&&n&&(r=[],u.utils.domData.set(t,e,r)),r}function o(t){u.utils.domData.set(t,e,s)}function a(e){var t=r(e,!1);if(t){t=t.slice(0);for(var s=0;s<t.length;s++)t[s](e)}u.utils.domData.clear(e),typeof i=="function"&&typeof i["cleanData"]=="function"&&i.cleanData([e]),n[e.nodeType]&&f(e)}function f(e){var t,n=e.firstChild;while(t=n)n=t.nextSibling,t.nodeType===8&&a(t)}var e="__ko_domNodeDisposal__"+(new Date).getTime(),t={1:!0,8:!0,9:!0},n={1:!0,9:!0};return{addDisposeCallback:function(e,t){if(typeof t!="function")throw new Error("Callback must be a function");r(e,!0).push(t)},removeDisposeCallback:function(e,t){var n=r(e,!1);n&&(u.utils.arrayRemoveItem(n,t),n.length==0&&o(e))},cleanNode:function(e){if(t[e.nodeType]){a(e);if(n[e.nodeType]){var r=[];u.utils.arrayPushAll(r,e.getElementsByTagName("*"));for(var i=0,s=r.length;i<s;i++)a(r[i])}}return e},removeNode:function(e){u.cleanNode(e),e.parentNode&&e.parentNode.removeChild(e)}}},u.cleanNode=u.utils.domNodeDisposal.cleanNode,u.removeNode=u.utils.domNodeDisposal.removeNode,u.exportSymbol("cleanNode",u.cleanNode),u.exportSymbol("removeNode",u.removeNode),u.exportSymbol("utils.domNodeDisposal",u.utils.domNodeDisposal),u.exportSymbol("utils.domNodeDisposal.addDisposeCallback",u.utils.domNodeDisposal.addDisposeCallback),u.exportSymbol("utils.domNodeDisposal.removeDisposeCallback",u.utils.domNodeDisposal.removeDisposeCallback),function(){function r(e){var r=u.utils.stringTrim(e).toLowerCase(),i=n.createElement("div"),s=r.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!r.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!r.indexOf("<td")||!r.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],o="ignored<div>"+s[1]+e+s[2]+"</div>";typeof t["innerShiv"]=="function"?i.appendChild(t.innerShiv(o)):i.innerHTML=o;while(s[0]--)i=i.lastChild;return u.utils.makeArray(i.lastChild.childNodes)}function o(e){var t=i.clean([e]);if(t&&t[0]){var n=t[0];while(n.parentNode&&n.parentNode.nodeType!==11)n=n.parentNode;n.parentNode&&n.parentNode.removeChild(n)}return t}var e=/^(\s*)<!--(.*?)-->/;u.utils.parseHtmlFragment=function(e){return typeof i!="undefined"?o(e):r(e)},u.utils.setHtml=function(e,t){u.utils.emptyDomNode(e),t=u.utils.unwrapObservable(t);if(t!==null&&t!==s){typeof t!="string"&&(t=t.toString());if(typeof i!="undefined")i(e).html(t);else{var n=u.utils.parseHtmlFragment(t);for(var r=0;r<n.length;r++)e.appendChild(n[r])}}}}(),u.exportSymbol("utils.parseHtmlFragment",u.utils.parseHtmlFragment),u.exportSymbol("utils.setHtml",u.utils.setHtml),u.memoization=function(){function t(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function n(){return t()+t()}function r(e,t){if(!e)return;if(e.nodeType==8){var n=u.memoization.parseMemoText(e.nodeValue);n!=null&&t.push({domNode:e,memoId:n})}else if(e.nodeType==1)for(var i=0,s=e.childNodes,o=s.length;i<o;i++)r(s[i],t)}var e={};return{memoize:function(t){if(typeof t!="function")throw new Error("You can only pass a function to ko.memoization.memoize()");var r=n();return e[r]=t,"<!--[ko_memo:"+r+"]-->"},unmemoize:function(t,n){var r=e[t];if(r===s)throw new Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return r.apply(null,n||[]),!0}finally{delete e[t]}},unmemoizeDomNodeAndDescendants:function(e,t){var n=[];r(e,n);for(var i=0,s=n.length;i<s;i++){var o=n[i].domNode,a=[o];t&&u.utils.arrayPushAll(a,t),u.memoization.unmemoize(n[i].memoId,a),o.nodeValue="",o.parentNode&&o.parentNode.removeChild(o)}},parseMemoText:function(e){var t=e.match(/^\[ko_memo\:(.*?)\]$/);return t?t[1]:null}}}(),u.exportSymbol("memoization",u.memoization),u.exportSymbol("memoization.memoize",u.memoization.memoize),u.exportSymbol("memoization.unmemoize",u.memoization.unmemoize),u.exportSymbol("memoization.parseMemoText",u.memoization.parseMemoText),u.exportSymbol("memoization.unmemoizeDomNodeAndDescendants",u.memoization.unmemoizeDomNodeAndDescendants),u.extenders={throttle:function(e,t){e.throttleEvaluation=t;var n=null;return u.dependentObservable({read:e,write:function(r){clearTimeout(n),n=setTimeout(function(){e(r)},t)}})},notify:function(e,t){return e.equalityComparer=t=="always"?function(){return!1}:u.observable.fn.equalityComparer,e}},u.exportSymbol("extenders",u.extenders),u.subscription=function(e,t,n){this.target=e,this.callback=t,this.disposeCallback=n,u.exportProperty(this,"dispose",this.dispose)},u.subscription.prototype.dispose=function(){this.isDisposed=!0,this.disposeCallback()},u.subscribable=function(){this._subscriptions={},u.utils.extend(this,u.subscribable.fn),u.exportProperty(this,"subscribe",this.subscribe),u.exportProperty(this,"extend",this.extend),u.exportProperty(this,"getSubscriptionsCount",this.getSubscriptionsCount)};var f="change";u.subscribable.fn={subscribe:function(e,t,n){n=n||f;var r=t?e.bind(t):e,i=new u.subscription(this,r,function(){u.utils.arrayRemoveItem(this._subscriptions[n],i)}.bind(this));return this._subscriptions[n]||(this._subscriptions[n]=[]),this._subscriptions[n].push(i),i},notifySubscribers:function(e,t){t=t||f,this._subscriptions[t]&&u.dependencyDetection.ignore(function(){u.utils.arrayForEach(this._subscriptions[t].slice(0),function(t){t&&t.isDisposed!==!0&&t.callback(e)})},this)},getSubscriptionsCount:function(){var e=0;for(var t in this._subscriptions)this._subscriptions.hasOwnProperty(t)&&(e+=this._subscriptions[t].length);return e},extend:a},u.isSubscribable=function(e){return typeof e.subscribe=="function"&&typeof e["notifySubscribers"]=="function"},u.exportSymbol("subscribable",u.subscribable),u.exportSymbol("isSubscribable",u.isSubscribable),u.dependencyDetection=function(){var e=[];return{begin:function(t){e.push({callback:t,distinctDependencies:[]})},end:function(){e.pop()},registerDependency:function(t){if(!u.isSubscribable(t))throw new Error("Only subscribable things can act as dependencies");if(e.length>0){var n=e[e.length-1];if(!n||u.utils.arrayIndexOf(n.distinctDependencies,t)>=0)return;n.distinctDependencies.push(t),n.callback(t)}},ignore:function(t,n,r){try{return e.push(null),t.apply(n,r||[])}finally{e.pop()}}}}();var l={"undefined":!0,"boolean":!0,number:!0,string:!0};u.observable=function(t){function r(){if(arguments.length>0){if(!r.equalityComparer||!r.equalityComparer(n,arguments[0]))r.valueWillMutate(),n=arguments[0],e&&(r._latestValue=n),r.valueHasMutated();return this}return u.dependencyDetection.registerDependency(r),n}var n=t;return e&&(r._latestValue=n),u.subscribable.call(r),r.peek=function(){return n},r.valueHasMutated=function(){r.notifySubscribers(n)},r.valueWillMutate=function(){r.notifySubscribers(n,"beforeChange")},u.utils.extend(r,u.observable.fn),u.exportProperty(r,"peek",r.peek),u.exportProperty(r,"valueHasMutated",r.valueHasMutated),u.exportProperty(r,"valueWillMutate",r.valueWillMutate),r},u.observable.fn={equalityComparer:function(t,n){var r=t===null||typeof t in l;return r?t===n:!1}};var c=u.observable.protoProperty="__ko_proto__";u.observable.fn[c]=u.observable,u.hasPrototype=function(e,t){return e===null||e===s||e[c]===s?!1:e[c]===t?!0:u.hasPrototype(e[c],t)},u.isObservable=function(e){return u.hasPrototype(e,u.observable)},u.isWriteableObservable=function(e){return typeof e=="function"&&e[c]===u.observable?!0:typeof e=="function"&&e[c]===u.dependentObservable&&e.hasWriteFunction?!0:!1},u.exportSymbol("observable",u.observable),u.exportSymbol("isObservable",u.isObservable),u.exportSymbol("isWriteableObservable",u.isWriteableObservable),u.observableArray=function(e){arguments.length==0&&(e=[]);if(e===null||e===s||"length"in e){var t=u.observable(e);return u.utils.extend(t,u.observableArray.fn),t}throw new Error("The argument passed when initializing an observable array must be an array, or null, or undefined.")},u.observableArray.fn={remove:function(e){var t=this.peek(),n=[],r=typeof e=="function"?e:function(t){return t===e};for(var i=0;i<t.length;i++){var s=t[i];r(s)&&(n.length===0&&this.valueWillMutate(),n.push(s),t.splice(i,1),i--)}return n.length&&this.valueHasMutated(),n},removeAll:function(e){if(e===s){var t=this.peek(),n=t.slice(0);return this.valueWillMutate(),t.splice(0,t.length),this.valueHasMutated(),n}return e?this.remove(function(t){return u.utils.arrayIndexOf(e,t)>=0}):[]},destroy:function(e){var t=this.peek(),n=typeof e=="function"?e:function(t){return t===e};this.valueWillMutate();for(var r=t.length-1;r>=0;r--){var i=t[r];n(i)&&(t[r]._destroy=!0)}this.valueHasMutated()},destroyAll:function(e){return e===s?this.destroy(function(){return!0}):e?this.destroy(function(t){return u.utils.arrayIndexOf(e,t)>=0}):[]},indexOf:function(e){var t=this();return u.utils.arrayIndexOf(t,e)},replace:function(e,t){var n=this.indexOf(e);n>=0&&(this.valueWillMutate(),this.peek()[n]=t,this.valueHasMutated())}},u.utils.arrayForEach(["pop","push","reverse","shift","sort","splice","unshift"],function(e){u.observableArray.fn[e]=function(){var t=this.peek();this.valueWillMutate();var n=t[e].apply(t,arguments);return this.valueHasMutated(),n}}),u.utils.arrayForEach(["slice"],function(e){u.observableArray.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),u.exportSymbol("observableArray",u.observableArray),u.dependentObservable=function(t,n,r){function l(e){E.push(e.subscribe(h))}function c(){u.utils.arrayForEach(E,function(e){e.dispose()}),E=[]}function h(){var e=d.throttleEvaluation;e&&e>=0?(clearTimeout(S),S=setTimeout(p,e)):p()}function p(){if(a)return;if(o&&b()){w();return}a=!0;try{var t=u.utils.arrayMap(E,function(e){return e.target});u.dependencyDetection.begin(function(e){var n;(n=u.utils.arrayIndexOf(t,e))>=0?t[n]=s:l(e)});var r=f.call(n);for(var c=t.length-1;c>=0;c--)t[c]&&E.splice(c,1)[0].dispose();o=!0,d.notifySubscribers(i,"beforeChange"),i=r,e&&(d._latestValue=i)}finally{u.dependencyDetection.end()}d.notifySubscribers(i),a=!1,E.length||w()}function d(){if(arguments.length>0){if(typeof g!="function")throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return g.apply(n,arguments),this}return o||p(),u.dependencyDetection.registerDependency(d),i}function v(){return o||p(),i}function m(){return!o||E.length>0}var i,o=!1,a=!1,f=t;f&&typeof f=="object"?(r=f,f=r.read):(r=r||{},f||(f=r.read));if(typeof f!="function")throw new Error("Pass a function that returns the value of the ko.computed");var g=r.write,y=r.disposeWhenNodeIsRemoved||r.disposeWhenNodeIsRemoved||null,b=r.disposeWhen||r.disposeWhen||function(){return!1},w=c,E=[],S=null;n||(n=r.owner),d.peek=v,d.getDependenciesCount=function(){return E.length},d.hasWriteFunction=typeof r.write=="function",d.dispose=function(){w()},d.isActive=m,u.subscribable.call(d),u.utils.extend(d,u.dependentObservable.fn),u.exportProperty(d,"peek",d.peek),u.exportProperty(d,"dispose",d.dispose),u.exportProperty(d,"isActive",d.isActive),u.exportProperty(d,"getDependenciesCount",d.getDependenciesCount),r.deferEvaluation!==!0&&p();if(y&&m()){w=function(){u.utils.domNodeDisposal.removeDisposeCallback(y,arguments.callee),c()},u.utils.domNodeDisposal.addDisposeCallback(y,w);var x=b;b=function(){return!u.utils.domNodeIsAttachedToDocument(y)||x()}}return d},u.isComputed=function(e){return u.hasPrototype(e,u.dependentObservable)};var h=u.observable.protoProperty;u.dependentObservable[h]=u.observable,u.dependentObservable.fn={},u.dependentObservable.fn[h]=u.dependentObservable,u.exportSymbol("dependentObservable",u.dependentObservable),u.exportSymbol("computed",u.dependentObservable),u.exportSymbol("isComputed",u.isComputed),function(){function t(e,i,o){o=o||new r,e=i(e);var u=typeof e=="object"&&e!==null&&e!==s&&!(e instanceof Date);if(!u)return e;var a=e instanceof Array?[]:{};return o.save(e,a),n(e,function(n){var r=i(e[n]);switch(typeof r){case"boolean":case"number":case"string":case"function":a[n]=r;break;case"object":case"undefined":var u=o.get(r);a[n]=u!==s?u:t(r,i,o)}}),a}function n(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)t(n);typeof e["toJSON"]=="function"&&t("toJSON")}else for(var r in e)t(r)}function r(){var e=[],t=[];this.save=function(n,r){var i=u.utils.arrayIndexOf(e,n);i>=0?t[i]=r:(e.push(n),t.push(r))},this.get=function(n){var r=u.utils.arrayIndexOf(e,n);return r>=0?t[r]:s}}var e=10;u.toJS=function(n){if(arguments.length==0)throw new Error("When calling ko.toJS, pass the object you want to convert.");return t(n,function(t){for(var n=0;u.isObservable(t)&&n<e;n++)t=t();return t})},u.toJSON=function(e,t,n){var r=u.toJS(e);return u.utils.stringifyJson(r,t,n)}}(),u.exportSymbol("toJS",u.toJS),u.exportSymbol("toJSON",u.toJSON),function(){var e="__ko__hasDomDataOptionValue__";u.selectExtensions={readValue:function(t){switch(u.utils.tagNameLower(t)){case"option":if(t[e]===!0)return u.utils.domData.get(t,u.bindingHandlers.options.optionValueDomDataKey);return u.utils.ieVersion<=7?t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return t.selectedIndex>=0?u.selectExtensions.readValue(t.options[t.selectedIndex]):s;default:return t.value}},writeValue:function(t,n){switch(u.utils.tagNameLower(t)){case"option":switch(typeof n){case"string":u.utils.domData.set(t,u.bindingHandlers.options.optionValueDomDataKey,s),e in t&&delete t[e],t.value=n;break;default:u.utils.domData.set(t,u.bindingHandlers.options.optionValueDomDataKey,n),t[e]=!0,t.value=typeof n=="number"?n:""}break;case"select":for(var r=t.options.length-1;r>=0;r--)if(u.selectExtensions.readValue(t.options[r])==n){t.selectedIndex=r;break}break;default:if(n===null||n===s)n="";t.value=n}}}}(),u.exportSymbol("selectExtensions",u.selectExtensions),u.exportSymbol("selectExtensions.readValue",u.selectExtensions.readValue),u.exportSymbol("selectExtensions.writeValue",u.selectExtensions.writeValue),u.expressionRewriting=function(){function r(t,n){var r=null;while(t!=r)r=t,t=t.replace(e,function(e,t){return n[t]});return t}function i(e){if(u.utils.arrayIndexOf(t,u.utils.stringTrim(e).toLowerCase())>=0)return!1;var r=e.match(n);return r===null?!1:r[1]?"Object("+r[1]+")"+r[2]:e}function s(e){var t=u.utils.stringTrim(e);switch(t.length&&t.charAt(0)){case"'":case'"':return e;default:return"'"+t+"'"}}var e=/\@ko_token_(\d+)\@/g,t=["true","false"],n=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;return{bindingRewriteValidators:[],parseObjectLiteral:function(e){var t=u.utils.stringTrim(e);if(t.length<3)return[];t.charAt(0)==="{"&&(t=t.substring(1,t.length-1));var n=[],i=null,s;for(var o=0;o<t.length;o++){var a=t.charAt(o);if(i===null)switch(a){case'"':case"'":case"/":i=o,s=a}else if(a==s&&t.charAt(o-1)!=="\\"){var f=t.substring(i,o+1);n.push(f);var l="@ko_token_"+(n.length-1)+"@";t=t.substring(0,i)+l+t.substring(o+1),o-=f.length-l.length,i=null}}i=null,s=null;var c=0,h=null;for(var o=0;o<t.length;o++){var a=t.charAt(o);if(i===null)switch(a){case"{":i=o,h=a,s="}";break;case"(":i=o,h=a,s=")";break;case"[":i=o,h=a,s="]"}if(a===h)c++;else if(a===s){c--;if(c===0){var f=t.substring(i,o+1);n.push(f);var l="@ko_token_"+(n.length-1)+"@";t=t.substring(0,i)+l+t.substring(o+1),o-=f.length-l.length,i=null}}}var p=[],d=t.split(",");for(var v=0,m=d.length;v<m;v++){var g=d[v],y=g.indexOf(":");if(y>0&&y<g.length-1){var b=g.substring(0,y),w=g.substring(y+1);p.push({key:r(b,n),value:r(w,n)})}else p.push({unknown:r(g,n)})}return p},preProcessBindings:function(e){var t=typeof e=="string"?u.expressionRewriting.parseObjectLiteral(e):e,n=[],r=[],o;for(var a=0;o=t[a];a++){n.length>0&&n.push(",");if(o.key){var f=s(o.key),l=o.value;n.push(f),n.push(":"),n.push(l);if(l=i(u.utils.stringTrim(l)))r.length>0&&r.push(", "),r.push(f+" : function(__ko_value) { "+l+" = __ko_value; }")}else o.unknown&&n.push(o.unknown)}var c=n.join("");if(r.length>0){var h=r.join("");c=c+", '_ko_property_writers' : { "+h+" } "}return c},keyValueArrayContainsKey:function(e,t){for(var n=0;n<e.length;n++)if(u.utils.stringTrim(e[n]["key"])==t)return!0;return!1},writeValueToProperty:function(e,t,n,r,i){if(!e||!u.isWriteableObservable(e)){var s=t()._ko_property_writers;s&&s[n]&&s[n](r)}else(!i||e.peek()!==r)&&e(r)}}}(),u.exportSymbol("expressionRewriting",u.expressionRewriting),u.exportSymbol("expressionRewriting.bindingRewriteValidators",u.expressionRewriting.bindingRewriteValidators),u.exportSymbol("expressionRewriting.parseObjectLiteral",u.expressionRewriting.parseObjectLiteral),u.exportSymbol("expressionRewriting.preProcessBindings",u.expressionRewriting.preProcessBindings),u.exportSymbol("jsonExpressionRewriting",u.expressionRewriting),u.exportSymbol("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",u.expressionRewriting.preProcessBindings),function(){function s(n){return n.nodeType==8&&(e?n.text:n.nodeValue).match(t)}function o(t){return t.nodeType==8&&(e?t.text:t.nodeValue).match(r)}function a(e,t){var n=e,r=1,i=[];while(n=n.nextSibling){if(o(n)){r--;if(r===0)return i}i.push(n),s(n)&&r++}if(!t)throw new Error("Cannot find closing comment tag to match: "+e.nodeValue);return null}function f(e,t){var n=a(e,t);return n?n.length>0?n[n.length-1].nextSibling:e.nextSibling:null}function l(e){var t=e.firstChild,n=null;if(t)do if(n)n.push(t);else if(s(t)){var r=f(t,!0);r?t=r:n=[t]}else o(t)&&(n=[t]);while(t=t.nextSibling);return n}var e=n.createComment("test").text==="<!--test-->",t=e?/^<!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*-->$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,r=e?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/,i={ul:!0,ol:!0};u.virtualElements={allowedBindings:{},childNodes:function(e){return s(e)?a(e):e.childNodes},emptyNode:function(e){if(!s(e))u.utils.emptyDomNode(e);else{var t=u.virtualElements.childNodes(e);for(var n=0,r=t.length;n<r;n++)u.removeNode(t[n])}},setDomNodeChildren:function(e,t){if(!s(e))u.utils.setDomNodeChildren(e,t);else{u.virtualElements.emptyNode(e);var n=e.nextSibling;for(var r=0,i=t.length;r<i;r++)n.parentNode.insertBefore(t[r],n)}},prepend:function(e,t){s(e)?e.parentNode.insertBefore(t,e.nextSibling):e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},insertAfter:function(e,t,n){n?s(e)?e.parentNode.insertBefore(t,n.nextSibling):n.nextSibling?e.insertBefore(t,n.nextSibling):e.appendChild(t):u.virtualElements.prepend(e,t)},firstChild:function(e){return s(e)?!e.nextSibling||o(e.nextSibling)?null:e.nextSibling:e.firstChild},nextSibling:function(e){return s(e)&&(e=f(e)),e.nextSibling&&o(e.nextSibling)?null:e.nextSibling},virtualNodeBindingValue:function(e){var t=s(e);return t?t[1]:null},normaliseVirtualElementDomStructure:function(e){if(!i[u.utils.tagNameLower(e)])return;var t=e.firstChild;if(t)do if(t.nodeType===1){var n=l(t);if(n){var r=t.nextSibling;for(var s=0;s<n.length;s++)r?e.insertBefore(n[s],r):e.appendChild(n[s])}}while(t=t.nextSibling)}}}(),u.exportSymbol("virtualElements",u.virtualElements),u.exportSymbol("virtualElements.allowedBindings",u.virtualElements.allowedBindings),u.exportSymbol("virtualElements.emptyNode",u.virtualElements.emptyNode),u.exportSymbol("virtualElements.insertAfter",u.virtualElements.insertAfter),u.exportSymbol("virtualElements.prepend",u.virtualElements.prepend),u.exportSymbol("virtualElements.setDomNodeChildren",u.virtualElements.setDomNodeChildren),function(){function t(e,t){var r=e;return t[r]||(t[r]=n(e))}function n(e){var t=u.expressionRewriting.preProcessBindings(e),n="with($context){with($data||{}){return{"+t+"}}}";return new Function("$context","$element",n)}var e="data-bind";u.bindingProvider=function(){this.bindingCache={}},u.utils.extend(u.bindingProvider.prototype,{nodeHasBindings:function(t){switch(t.nodeType){case 1:return t.getAttribute(e)!=null;case 8:return u.virtualElements.virtualNodeBindingValue(t)!=null;default:return!1}},getBindings:function(e,t){var n=this.getBindingsString(e,t);return n?this.parseBindingsString(n,t,e):null},getBindingsString:function(t,n){switch(t.nodeType){case 1:return t.getAttribute(e);case 8:return u.virtualElements.virtualNodeBindingValue(t);default:return null}},parseBindingsString:function(e,n,r){try{var i=t(e,this.bindingCache);return i(n,r)}catch(s){throw new Error("Unable to parse bindings.\nMessage: "+s+";\nBindings value: "+e)}}}),u.bindingProvider.instance=new u.bindingProvider}(),u.exportSymbol("bindingProvider",u.bindingProvider),function(){function e(e){var t=u.virtualElements.allowedBindings[e];if(!t)throw new Error("The binding '"+e+"' cannot be used with virtual elements")}function n(e,t,n){var i,s=u.virtualElements.firstChild(t);while(i=s)s=u.virtualElements.nextSibling(i),r(e,i,n)}function r(e,t,r){var s=!0,o=t.nodeType===1;o&&u.virtualElements.normaliseVirtualElementDomStructure(t);var a=o&&r||u.bindingProvider.instance.nodeHasBindings(t);a&&(s=i(t,null,e,r).shouldBindDescendants),s&&n(e,t,!o)}function i(t,n,r,i){function f(e){return function(){return a[e]}}function l(){return a}var o=0,a,c;return u.dependentObservable(function(){var h=r&&r instanceof u.bindingContext?r:new u.bindingContext(u.utils.unwrapObservable(r)),p=h.$data;i&&u.storedBindingContextForNode(t,h);var d=typeof n=="function"?n(h,t):n;a=d||u.bindingProvider.instance.getBindings(t,h);if(a){if(o===0){o=1;for(var v in a){var m=u.bindingHandlers[v];m&&t.nodeType===8&&e(v);if(m&&typeof m["init"]=="function"){var g=m.init,y=g(t,f(v),l,p,h);if(y&&y.controlsDescendantBindings){if(c!==s)throw new Error("Multiple bindings ("+c+" and "+v+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");c=v}}}o=2}if(o===2)for(var v in a){var m=u.bindingHandlers[v];if(m&&typeof m["update"]=="function"){var b=m.update;b(t,f(v),l,p,h)}}}},null,{disposeWhenNodeIsRemoved:t}),{shouldBindDescendants:c===s}}u.bindingHandlers={},u.bindingContext=function(e,t,n){t?(u.utils.extend(this,t),this.$parentContext=t,this.$parent=t.$data,this.$parents=(t.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=e,this.ko=u),this.$data=e,n&&(this[n]=e)},u.bindingContext.prototype.createChildContext=function(e,t){return new u.bindingContext(e,this,t)},u.bindingContext.prototype.extend=function(e){var t=u.utils.extend(new u.bindingContext,this);return u.utils.extend(t,e)};var o="__ko_bindingContext__";u.storedBindingContextForNode=function(e,t){if(arguments.length!=2)return u.utils.domData.get(e,o);u.utils.domData.set(e,o,t)},u.applyBindingsToNode=function(e,t,n){return e.nodeType===1&&u.virtualElements.normaliseVirtualElementDomStructure(e),i(e,t,n,!0)},u.applyBindingsToDescendants=function(e,t){(t.nodeType===1||t.nodeType===8)&&n(e,t,!0)},u.applyBindings=function(e,n){if(n&&n.nodeType!==1&&n.nodeType!==8)throw new Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");n=n||t.document.body,r(e,n,!0)},u.contextFor=function(e){switch(e.nodeType){case 1:case 8:var t=u.storedBindingContextForNode(e);if(t)return t;if(e.parentNode)return u.contextFor(e.parentNode)}return s},u.dataFor=function(e){var t=u.contextFor(e);return t?t.$data:s},u.exportSymbol("bindingHandlers",u.bindingHandlers),u.exportSymbol("applyBindings",u.applyBindings),u.exportSymbol("applyBindingsToDescendants",u.applyBindingsToDescendants),u.exportSymbol("applyBindingsToNode",u.applyBindingsToNode),u.exportSymbol("contextFor",u.contextFor),u.exportSymbol("dataFor",u.dataFor)}();var p={"class":"className","for":"htmlFor"};u.bindingHandlers.attr={update:function(e,t,n){var r=u.utils.unwrapObservable(t())||{};for(var i in r)if(typeof i=="string"){var o=u.utils.unwrapObservable(r[i]),a=o===!1||o===null||o===s;a&&e.removeAttribute(i),u.utils.ieVersion<=8&&i in p?(i=p[i],a?e.removeAttribute(i):e[i]=o):a||e.setAttribute(i,o.toString()),i==="name"&&u.utils.setElementName(e,a?"":o.toString())}}},u.bindingHandlers.checked={init:function(e,t,n){var r=function(){var r;if(e.type=="checkbox")r=e.checked;else{if(e.type!="radio"||!e.checked)return;r=e.value}var i=t(),s=u.utils.unwrapObservable(i);if(e.type=="checkbox"&&s instanceof Array){var o=u.utils.arrayIndexOf(s,e.value);e.checked&&o<0?i.push(e.value):!e.checked&&o>=0&&i.splice(o,1)}else u.expressionRewriting.writeValueToProperty(i,n,"checked",r,!0)};u.utils.registerEventHandler(e,"click",r),e.type=="radio"&&!e.name&&u.bindingHandlers.uniqueName.init(e,function(){return!0})},update:function(e,t){var n=u.utils.unwrapObservable(t());e.type=="checkbox"?n instanceof Array?e.checked=u.utils.arrayIndexOf(n,e.value)>=0:e.checked=n:e.type=="radio"&&(e.checked=e.value==n)}};var d="__ko__cssValue";u.bindingHandlers.css={update:function(e,t){var n=u.utils.unwrapObservable(t());if(typeof n=="object")for(var r in n){var i=u.utils.unwrapObservable(n[r]);u.utils.toggleDomNodeCssClass(e,r,i)}else n=String(n||""),u.utils.toggleDomNodeCssClass(e,e[d],!1),e[d]=n,u.utils.toggleDomNodeCssClass(e,n,!0)}},u.bindingHandlers.enable={update:function(e,t){var n=u.utils.unwrapObservable(t());n&&e.disabled?e.removeAttribute("disabled"):!n&&!e.disabled&&(e.disabled=!0)}},u.bindingHandlers.disable={update:function(e,t){u.bindingHandlers.enable.update(e,function(){return!u.utils.unwrapObservable(t())})}},u.bindingHandlers.event={init:function(e,t,n,r){var i=t()||{};for(var s in i)(function(){var i=s;typeof i=="string"&&u.utils.registerEventHandler(e,i,function(e){var s,o=t()[i];if(!o)return;var a=n();try{var f=u.utils.makeArray(arguments);f.unshift(r),s=o.apply(r,f)}finally{s!==!0&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}var l=a[i+"Bubble"]!==!1;l||(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())})})()}},u.bindingHandlers.foreach={makeTemplateValueAccessor:function(e){return function(){var t=e(),n=u.utils.peekObservable(t);return!n||typeof n.length=="number"?{foreach:t,templateEngine:u.nativeTemplateEngine.instance}:(u.utils.unwrapObservable(t),{foreach:n.data,as:n.as,includeDestroyed:n.includeDestroyed,afterAdd:n.afterAdd,beforeRemove:n.beforeRemove,afterRender:n.afterRender,beforeMove:n.beforeMove,afterMove:n.afterMove,templateEngine:u.nativeTemplateEngine.instance})}},init:function(e,t,n,r,i){return u.bindingHandlers.template.init(e,u.bindingHandlers.foreach.makeTemplateValueAccessor(t))},update:function(e,t,n,r,i){return u.bindingHandlers.template.update(e,u.bindingHandlers.foreach.makeTemplateValueAccessor(t),n,r,i)}},u.expressionRewriting.bindingRewriteValidators.foreach=!1,u.virtualElements.allowedBindings.foreach=!0;var m="__ko_hasfocusUpdating";u.bindingHandlers.hasfocus={init:function(e,t,n){var r=function(r){e[m]=!0;var i=e.ownerDocument;"activeElement"in i&&(r=i.activeElement===e);var s=t();u.expressionRewriting.writeValueToProperty(s,n,"hasfocus",r,!0),e[m]=!1},i=r.bind(null,!0),s=r.bind(null,!1);u.utils.registerEventHandler(e,"focus",i),u.utils.registerEventHandler(e,"focusin",i),u.utils.registerEventHandler(e,"blur",s),u.utils.registerEventHandler(e,"focusout",s)},update:function(e,t){var n=u.utils.unwrapObservable(t());e[m]||(n?e.focus():e.blur(),u.dependencyDetection.ignore(u.utils.triggerEvent,null,[e,n?"focusin":"focusout"]))}},u.bindingHandlers.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){u.utils.setHtml(e,t())}};var g="__ko_withIfBindingData";y("if"),y("ifnot",!1,!0),y("with",!0,!1,function(e,t){return e.createChildContext(t)}),u.bindingHandlers.options={update:function(e,t,r){if(u.utils.tagNameLower(e)!=="select")throw new Error("options binding applies only to SELECT elements");var i=e.length==0,o=u.utils.arrayMap(u.utils.arrayFilter(e.childNodes,function(e){return e.tagName&&u.utils.tagNameLower(e)==="option"&&e.selected}),function(e){return u.selectExtensions.readValue(e)||e.innerText||e.textContent}),a=e.scrollTop,f=u.utils.unwrapObservable(t()),l=e.value;while(e.length>0)u.cleanNode(e.options[0]),e.remove(0);if(f){var c=r(),h=c.optionsIncludeDestroyed;typeof f.length!="number"&&(f=[f]);if(c.optionsCaption){var p=n.createElement("option");u.utils.setHtml(p,c.optionsCaption),u.selectExtensions.writeValue(p,s),e.appendChild(p)}for(var d=0,v=f.length;d<v;d++){var m=f[d];if(m&&m._destroy&&!h)continue;var p=n.createElement("option");function g(e,t,n){var r=typeof t;return r=="function"?t(e):r=="string"?e[t]:n}var y=g(m,c.optionsValue,m);u.selectExtensions.writeValue(p,u.utils.unwrapObservable(y));var w=g(m,c.optionsText,y);u.utils.setTextContent(p,w),e.appendChild(p)}var E=e.getElementsByTagName("option"),S=0;for(var d=0,v=E.length;d<v;d++)u.utils.arrayIndexOf(o,u.selectExtensions.readValue(E[d]))>=0&&(u.utils.setOptionNodeSelectionState(E[d],!0),S++);e.scrollTop=a,i&&"value"in c&&b(e,u.utils.peekObservable(c.value),!0),u.utils.ensureSelectElementIsRenderedCorrectly(e)}}},u.bindingHandlers.options.optionValueDomDataKey="__ko.optionValueDomData__",u.bindingHandlers.selectedOptions={init:function(e,t,n){u.utils.registerEventHandler(e,"change",function(){var r=t(),i=[];u.utils.arrayForEach(e.getElementsByTagName("option"),function(e){e.selected&&i.push(u.selectExtensions.readValue(e))}),u.expressionRewriting.writeValueToProperty(r,n,"value",i)})},update:function(e,t){if(u.utils.tagNameLower(e)!="select")throw new Error("values binding applies only to SELECT elements");var n=u.utils.unwrapObservable(t());n&&typeof n.length=="number"&&u.utils.arrayForEach(e.getElementsByTagName("option"),function(e){var t=u.utils.arrayIndexOf(n,u.selectExtensions.readValue(e))>=0;u.utils.setOptionNodeSelectionState(e,t)})}},u.bindingHandlers.style={update:function(e,t){var n=u.utils.unwrapObservable(t()||{});for(var r in n)if(typeof r=="string"){var i=u.utils.unwrapObservable(n[r]);e.style[r]=i||""}}},u.bindingHandlers.submit={init:function(e,t,n,r){if(typeof t()!="function")throw new Error("The value for a submit binding must be a function");u.utils.registerEventHandler(e,"submit",function(n){var i,s=t();try{i=s.call(r,e)}finally{i!==!0&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}})}},u.bindingHandlers.text={update:function(e,t){u.utils.setTextContent(e,t())}},u.virtualElements.allowedBindings.text=!0,u.bindingHandlers.uniqueName={init:function(e,t){if(t()){var n="ko_unique_"+ ++u.bindingHandlers.uniqueName.currentIndex;u.utils.setElementName(e,n)}}},u.bindingHandlers.uniqueName.currentIndex=0,u.bindingHandlers.value={init:function(e,t,n){var r=["change"],i=n().valueUpdate,s=!1;i&&(typeof i=="string"&&(i=[i]),u.utils.arrayPushAll(r,i),r=u.utils.arrayGetDistinctValues(r));var o=function(){s=!1;var r=t(),i=u.selectExtensions.readValue(e);u.expressionRewriting.writeValueToProperty(r,n,"value",i)},a=u.utils.ieVersion&&e.tagName.toLowerCase()=="input"&&e.type=="text"&&e.autocomplete!="off"&&(!e.form||e.form.autocomplete!="off");a&&u.utils.arrayIndexOf(r,"propertychange")==-1&&(u.utils.registerEventHandler(e,"propertychange",function(){s=!0}),u.utils.registerEventHandler(e,"blur",function(){s&&o()})),u.utils.arrayForEach(r,function(t){var n=o;u.utils.stringStartsWith(t,"after")&&(n=function(){setTimeout(o,0)},t=t.substring("after".length)),u.utils.registerEventHandler(e,t,n)})},update:function(e,t){var n=u.utils.tagNameLower(e)==="select",r=u.utils.unwrapObservable(t()),i=u.selectExtensions.readValue(e),s=r!=i;r===0&&i!==0&&i!=="0"&&(s=!0);if(s){var o=function(){u.selectExtensions.writeValue(e,r)};o();var a=n;a&&setTimeout(o,0)}n&&e.length>0&&b(e,r,!1)}},u.bindingHandlers.visible={update:function(e,t){var n=u.utils.unwrapObservable(t()),r=e.style.display!="none";n&&!r?e.style.display="":!n&&r&&(e.style.display="none")}},v("click"),u.templateEngine=function(){},u.templateEngine.prototype.renderTemplateSource=function(e,t,n){throw new Error("Override renderTemplateSource")},u.templateEngine.prototype.createJavaScriptEvaluatorBlock=function(e){throw new Error("Override createJavaScriptEvaluatorBlock")},u.templateEngine.prototype.makeTemplateSource=function(e,t){if(typeof e=="string"){t=t||n;var r=t.getElementById(e);if(!r)throw new Error("Cannot find template with ID "+e);return new u.templateSources.domElement(r)}if(e.nodeType==1||e.nodeType==8)return new u.templateSources.anonymousTemplate(e);throw new Error("Unknown template type: "+e)},u.templateEngine.prototype.renderTemplate=function(e,t,n,r){var i=this.makeTemplateSource(e,r);return this.renderTemplateSource(i,t,n)},u.templateEngine.prototype.isTemplateRewritten=function(e,t){return this.allowTemplateRewriting===!1?!0:this.makeTemplateSource(e,t).data("isRewritten")},u.templateEngine.prototype.rewriteTemplate=function(e,t,n){var r=this.makeTemplateSource(e,n),i=t(r.text());r.text(i),r.data("isRewritten",!0)},u.exportSymbol("templateEngine",u.templateEngine),u.templateRewriting=function(){function n(e){var t=u.expressionRewriting.bindingRewriteValidators;for(var n=0;n<e.length;n++){var r=e[n].key;if(t.hasOwnProperty(r)){var i=t[r];if(typeof i=="function"){var s=i(e[n].value);if(s)throw new Error(s)}else if(!i)throw new Error("This template engine does not support the '"+r+"' binding within its templates")}}}function r(e,t,r){var i=u.expressionRewriting.parseObjectLiteral(e);n(i);var s=u.expressionRewriting.preProcessBindings(i),o="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+s+" } })()})";return r.createJavaScriptEvaluatorBlock(o)+t}var e=/(<[a-z]+\d*(\s+(?!data-bind=)[a-z0-9\-]+(=(\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind=(["'])([\s\S]*?)\5/gi,t=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;return{ensureTemplateIsRewritten:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,function(e){return u.templateRewriting.memoizeBindingAttributeSyntax(e,t)},n)},memoizeBindingAttributeSyntax:function(n,i){return n.replace(e,function(){return r(arguments[6],arguments[1],i)}).replace(t,function(){return r(arguments[1],"<!-- ko -->",i)})},applyMemoizedBindingsToNextSibling:function(e){return u.memoization.memoize(function(t,n){t.nextSibling&&u.applyBindingsToNode(t.nextSibling,e,n)})}}}(),u.exportSymbol("__tr_ambtns",u.templateRewriting.applyMemoizedBindingsToNextSibling),function(){u.templateSources={},u.templateSources.domElement=function(e){this.domElement=e},u.templateSources.domElement.prototype.text=function(){var e=u.utils.tagNameLower(this.domElement),t=e==="script"?"text":e==="textarea"?"value":"innerHTML";if(arguments.length==0)return this.domElement[t];var n=arguments[0];t==="innerHTML"?u.utils.setHtml(this.domElement,n):this.domElement[t]=n},u.templateSources.domElement.prototype.data=function(e){if(arguments.length===1)return u.utils.domData.get(this.domElement,"templateSourceData_"+e);u.utils.domData.set(this.domElement,"templateSourceData_"+e,arguments[1])};var e="__ko_anon_template__";u.templateSources.anonymousTemplate=function(e){this.domElement=e},u.templateSources.anonymousTemplate.prototype=new u.templateSources.domElement,u.templateSources.anonymousTemplate.prototype.text=function(){if(arguments.length==0){var t=u.utils.domData.get(this.domElement,e)||{};return t.textData===s&&t.containerData&&(t.textData=t.containerData.innerHTML),t.textData}var n=arguments[0];u.utils.domData.set(this.domElement,e,{textData:n})},u.templateSources.domElement.prototype.nodes=function(){if(arguments.length==0){var t=u.utils.domData.get(this.domElement,e)||{};return t.containerData}var n=arguments[0];u.utils.domData.set(this.domElement,e,{containerData:n})},u.exportSymbol("templateSources",u.templateSources),u.exportSymbol("templateSources.domElement",u.templateSources.domElement),u.exportSymbol("templateSources.anonymousTemplate",u.templateSources.anonymousTemplate)}(),function(){function t(e,t,n){var r,i=e,s=u.virtualElements.nextSibling(t);while(i&&(r=i)!==s)i=u.virtualElements.nextSibling(r),(r.nodeType===1||r.nodeType===8)&&n(r)}function n(e,n){if(e.length){var r=e[0],i=e[e.length-1];t(r,i,function(e){u.applyBindings(n,e)}),t(r,i,function(e){u.memoization.unmemoizeDomNodeAndDescendants(e,[n])})}}function r(e){return e.nodeType?e:e.length>0?e[0]:null}function i(t,i,s,o,a){a=a||{};var f=t&&r(t),l=f&&f.ownerDocument,c=a.templateEngine||e;u.templateRewriting.ensureTemplateIsRewritten(s,c,l);var h=c.renderTemplate(s,o,a,l);if(typeof h.length!="number"||h.length>0&&typeof h[0].nodeType!="number")throw new Error("Template engine must return an array of DOM nodes");var p=!1;switch(i){case"replaceChildren":u.virtualElements.setDomNodeChildren(t,h),p=!0;break;case"replaceNode":u.utils.replaceDomNodes(t,h),p=!0;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+i)}return p&&(n(h,o),a.afterRender&&u.dependencyDetection.ignore(a.afterRender,null,[h,o.$data])),h}function a(e,t){var n=u.utils.domData.get(e,o);n&&typeof n.dispose=="function"&&n.dispose(),u.utils.domData.set(e,o,t&&t.isActive()?t:s)}var e;u.setTemplateEngine=function(t){if(!(t==s||t instanceof u.templateEngine))throw new Error("templateEngine must inherit from ko.templateEngine");e=t},u.renderTemplate=function(t,n,o,a,f){o=o||{};if((o["templateEngine"]||e)==s)throw new Error("Set a template engine before calling renderTemplate");f=f||"replaceChildren";if(a){var l=r(a),c=function(){return!l||!u.utils.domNodeIsAttachedToDocument(l)},h=l&&f=="replaceNode"?l.parentNode:l;return u.dependentObservable(function(){var e=n&&n instanceof u.bindingContext?n:new u.bindingContext(u.utils.unwrapObservable(n)),s=typeof t=="function"?t(e.$data,e):t,c=i(a,f,s,e,o);f=="replaceNode"&&(a=c,l=r(a))},null,{disposeWhen:c,disposeWhenNodeIsRemoved:h})}return u.memoization.memoize(function(e){u.renderTemplate(t,n,o,e,"replaceNode")})},u.renderTemplateForEach=function(e,t,r,o,a){var f,l=function(t,n){f=a.createChildContext(u.utils.unwrapObservable(t),r.as),f.$index=n;var s=typeof e=="function"?e(t,f):e;return i(null,"ignoreTargetNode",s,f,r)},c=function(e,t,i){n(t,f),r.afterRender&&r.afterRender(t,e)};return u.dependentObservable(function(){var e=u.utils.unwrapObservable(t)||[];typeof e.length=="undefined"&&(e=[e]);var n=u.utils.arrayFilter(e,function(e){return r.includeDestroyed||e===s||e===null||!u.utils.unwrapObservable(e._destroy)});u.dependencyDetection.ignore(u.utils.setDomNodeChildrenFromArrayMapping,null,[o,n,l,r,c])},null,{disposeWhenNodeIsRemoved:o})};var o="__ko__templateComputedDomDataKey__";u.bindingHandlers.template={init:function(e,t){var n=u.utils.unwrapObservable(t());if(typeof n!="string"&&!n.name&&(e.nodeType==1||e.nodeType==8)){var r=e.nodeType==1?e.childNodes:u.virtualElements.childNodes(e),i=u.utils.moveCleanedNodesToContainerElement(r);(new u.templateSources.anonymousTemplate(e)).nodes(i)}return{controlsDescendantBindings:!0}},update:function(e,t,n,r,i){var s=u.utils.unwrapObservable(t()),o={},f=!0,l,c=null;typeof s!="string"&&(o=s,s=o.name,"if"in o&&(f=u.utils.unwrapObservable(o["if"])),f&&"ifnot"in o&&(f=!u.utils.unwrapObservable(o.ifnot)),l=u.utils.unwrapObservable(o.data));if("foreach"in o){var h=f&&o.foreach||[];c=u.renderTemplateForEach(s||e,h,o,e,i)}else if(!f)u.virtualElements.emptyNode(e);else{var p="data"in o?i.createChildContext(l,o.as):i;c=u.renderTemplate(s||e,p,o,e)}a(e,c)}},u.expressionRewriting.bindingRewriteValidators.template=function(e){var t=u.expressionRewriting.parseObjectLiteral(e);return t.length==1&&t[0].unknown?null:u.expressionRewriting.keyValueArrayContainsKey(t,"name")?null:"This template engine does not support anonymous templates nested within its templates"},u.virtualElements.allowedBindings.template=!0}(),u.exportSymbol("setTemplateEngine",u.setTemplateEngine),u.exportSymbol("renderTemplate",u.renderTemplate),u.utils.compareArrays=function(){function n(n,i,s){return n=n||[],i=i||[],n.length<=i.length?r(n,i,e,t,s):r(i,n,t,e,s)}function r(e,t,n,r,i){var s=Math.min,o=Math.max,u=[],a,f=e.length,l,c=t.length,h=c-f||1,p=f+c+1,d,v,m,g;for(a=0;a<=f;a++){v=d,u.push(d=[]),m=s(c,a+h),g=o(0,a-1);for(l=g;l<=m;l++)if(!l)d[l]=a+1;else if(!a)d[l]=l+1;else if(e[a-1]===t[l-1])d[l]=v[l-1];else{var y=v[l]||p,b=d[l-1]||p;d[l]=s(y,b)+1}}var w=[],E,S=[],x=[];for(a=f,l=c;a||l;)E=u[a][l]-1,l&&E===u[a][l-1]?S.push(w[w.length]={status:n,value:t[--l],index:l}):a&&E===u[a-1][l]?x.push(w[w.length]={status:r,value:e[--a],index:a}):(w.push({status:"retained",value:t[--l]}),--a);if(S.length&&x.length){var T=f*10,N,C,k,L,A;for(N=C=0;(i||N<T)&&(L=S[C]);C++){for(k=0;A=x[k];k++)if(L.value===A.value){L.moved=A.index,A.moved=L.index,x.splice(k,1),N=k=0;break}N+=k}}return w.reverse()}var e="added",t="deleted";return n}(),u.exportSymbol("utils.compareArrays",u.utils.compareArrays),function(){function e(e){while(e.length&&!u.utils.domNodeIsAttachedToDocument(e[0]))e.splice(0,1);if(e.length>1){var t=e[0],n=e[e.length-1],r=[t];while(t!==n){t=t.nextSibling;if(!t)return;r.push(t)}Array.prototype.splice.apply(e,[0,e.length].concat(r))}return e}function t(t,n,r,i,o){var a=[],f=u.dependentObservable(function(){var t=n(r,o)||[];a.length>0&&(u.utils.replaceDomNodes(e(a),t),i&&u.dependencyDetection.ignore(i,null,[r,t,o])),a.splice(0,a.length),u.utils.arrayPushAll(a,t)},null,{disposeWhenNodeIsRemoved:t,disposeWhen:function(){return a.length==0||!u.utils.domNodeIsAttachedToDocument(a[0])}});return{mappedNodes:a,dependentObservable:f.isActive()?f:s}}var n="setDomNodeChildrenFromArrayMapping_lastMappingResult";u.utils.setDomNodeChildrenFromArrayMapping=function(r,i,o,a,f){function x(t,n){S=c[n],m!==n&&(w[t]=S),S.indexObservable(m++),e(S.mappedNodes),d.push(S),y.push(S)}function T(e,t){if(e)for(var n=0,r=t.length;n<r;n++)t[n]&&u.utils.arrayForEach(t[n].mappedNodes,function(r){e(r,n,t[n].arrayEntry)})}i=i||[],a=a||{};var l=u.utils.domData.get(r,n)===s,c=u.utils.domData.get(r,n)||[],h=u.utils.arrayMap(c,function(e){return e.arrayEntry}),p=u.utils.compareArrays(h,i),d=[],v=0,m=0,g=[],y=[],b=[],w=[],E=[],S;for(var N=0,C,k;C=p[N];N++){k=C.moved;switch(C.status){case"deleted":k===s&&(S=c[v],S.dependentObservable&&S.dependentObservable.dispose(),g.push.apply(g,e(S.mappedNodes)),a.beforeRemove&&(b[N]=S,y.push(S))),v++;break;case"retained":x(N,v++);break;case"added":k!==s?x(N,k):(S={arrayEntry:C.value,indexObservable:u.observable(m++)},d.push(S),y.push(S),l||(E[N]=S))}}T(a.beforeMove,w),u.utils.arrayForEach(g,a.beforeRemove?u.cleanNode:u.removeNode);for(var N=0,L=u.virtualElements.firstChild(r),A,O;S=y[N];N++){S.mappedNodes||u.utils.extend(S,t(r,o,S.arrayEntry,f,S.indexObservable));for(var M=0;O=S.mappedNodes[M];L=O.nextSibling,A=O,M++)O!==L&&u.virtualElements.insertAfter(r,O,A);!S.initialized&&f&&(f(S.arrayEntry,S.mappedNodes,S.indexObservable),S.initialized=!0)}T(a.beforeRemove,b),T(a.afterMove,w),T(a.afterAdd,E),u.utils.domData.set(r,n,d)}}(),u.exportSymbol("utils.setDomNodeChildrenFromArrayMapping",u.utils.setDomNodeChildrenFromArrayMapping),u.nativeTemplateEngine=function(){this.allowTemplateRewriting=!1},u.nativeTemplateEngine.prototype=new u.templateEngine,u.nativeTemplateEngine.prototype.renderTemplateSource=function(e,t,n){var r=!(u.utils.ieVersion<9),i=r?e.nodes:null,s=i?e.nodes():null;if(s)return u.utils.makeArray(s.cloneNode(!0).childNodes);var o=e.text();return u.utils.parseHtmlFragment(o)},u.nativeTemplateEngine.instance=new u.nativeTemplateEngine,u.setTemplateEngine(u.nativeTemplateEngine.instance),u.exportSymbol("nativeTemplateEngine",u.nativeTemplateEngine),function(){u.jqueryTmplTemplateEngine=function(){function t(){if(e<2)throw new Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.")}function r(e,t,n){return i.tmpl(e,t,n)}var e=this.jQueryTmplVersion=function(){if(typeof i=="undefined"||!i.tmpl)return 0;try{if(i.tmpl.tag.tmpl.open.toString().indexOf("__")>=0)return 2}catch(e){}return 1}();this.renderTemplateSource=function(e,s,o){o=o||{},t();var u=e.data("precompiled");if(!u){var a=e.text()||"";a="{{ko_with $item.koBindingContext}}"+a+"{{/ko_with}}",u=i.template(null,a),e.data("precompiled",u)}var f=[s.$data],l=i.extend({koBindingContext:s},o.templateOptions),c=r(u,f,l);return c.appendTo(n.createElement("div")),i.fragments={},c},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){n.write("<script type='text/html' id='"+e+"'>"+t+"</script>")},e>0&&(i.tmpl.tag.ko_code={open:"__.push($1 || '');"},i.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},u.jqueryTmplTemplateEngine.prototype=new u.templateEngine;var e=new u.jqueryTmplTemplateEngine;e.jQueryTmplVersion>0&&u.setTemplateEngine(e),u.exportSymbol("jqueryTmplTemplateEngine",u.jqueryTmplTemplateEngine)}()})})(window,document,navigator,window.jQuery)}(),function(e,t){function _(e){var t=M[e]={};return v.each(e.split(y),function(e,n){t[n]=!0}),t}function H(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(P,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:+r+""===r?+r:D.test(r)?v.parseJSON(r):r}catch(s){}v.data(e,n,r)}else r=t}return r}function B(e){var t;for(t in e){if(t==="data"&&v.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function et(){return!1}function tt(){return!0}function ut(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function at(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function ft(e,t,n){t=t||0;if(v.isFunction(t))return v.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return v.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=v.grep(e,function(e){return e.nodeType===1});if(it.test(t))return v.filter(t,r,!n);t=v.filter(t,r)}return v.grep(e,function(e,r){return v.inArray(e,t)>=0===n})}function lt(e){var t=ct.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function At(e,t){if(t.nodeType!==1||!v.hasData(e))return;var n,r,i,s=v._data(e),o=v._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)v.event.add(t,n,u[n][r])}o.data&&(o.data=v.extend({},o.data))}function Ot(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==="object"?(t.parentNode&&(t.outerHTML=e.outerHTML),v.support.html5Clone&&e.innerHTML&&!v.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):n==="input"&&Et.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(v.expando)}function Mt(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function _t(e){Et.test(e.type)&&(e.defaultChecked=e.checked)}function Qt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Jt.length;while(i--){t=Jt[i]+n;if(t in e)return t}return r}function Gt(e,t){return e=t||e,v.css(e,"display")==="none"||!v.contains(e.ownerDocument,e)}function Yt(e,t){var n,r,i=[],s=0,o=e.length;for(;s<o;s++){n=e[s];if(!n.style)continue;i[s]=v._data(n,"olddisplay"),t?(!i[s]&&n.style.display==="none"&&(n.style.display=""),n.style.display===""&&Gt(n)&&(i[s]=v._data(n,"olddisplay",nn(n.nodeName)))):(r=Dt(n,"display"),!i[s]&&r!=="none"&&v._data(n,"olddisplay",r))}for(s=0;s<o;s++){n=e[s];if(!n.style)continue;if(!t||n.style.display==="none"||n.style.display==="")n.style.display=t?i[s]||"":"none"}return e}function Zt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function en(e,t,n,r){var i=n===(r?"border":"content")?4:t==="width"?1:0,s=0;for(;i<4;i+=2)n==="margin"&&(s+=v.css(e,n+$t[i],!0)),r?(n==="content"&&(s-=parseFloat(Dt(e,"padding"+$t[i]))||0),n!=="margin"&&(s-=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0)):(s+=parseFloat(Dt(e,"padding"+$t[i]))||0,n!=="padding"&&(s+=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0));return s}function tn(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=!0,s=v.support.boxSizing&&v.css(e,"boxSizing")==="border-box";if(r<=0||r==null){r=Dt(e,t);if(r<0||r==null)r=e.style[t];if(Ut.test(r))return r;i=s&&(v.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+en(e,t,n||(s?"border":"content"),i)+"px"}function nn(e){if(Wt[e])return Wt[e];var t=v("<"+e+">").appendTo(i.body),n=t.css("display");t.remove();if(n==="none"||n===""){Pt=i.body.appendChild(Pt||v.extend(i.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!Ht||!Pt.createElement)Ht=(Pt.contentWindow||Pt.contentDocument).document,Ht.write("<!doctype html><html><body>"),Ht.close();t=Ht.body.appendChild(Ht.createElement(e)),n=Dt(t,"display"),i.body.removeChild(Pt)}return Wt[e]=n,n}function fn(e,t,n,r){var i;if(v.isArray(t))v.each(t,function(t,i){n||sn.test(e)?r(e,i):fn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&v.type(t)==="object")for(i in t)fn(e+"["+i+"]",t[i],n,r);else r(e,t)}function Cn(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i,s,o=t.toLowerCase().split(y),u=0,a=o.length;if(v.isFunction(n))for(;u<a;u++)r=o[u],s=/^\+/.test(r),s&&(r=r.substr(1)||"*"),i=e[r]=e[r]||[],i[s?"unshift":"push"](n)}}function kn(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u,a=e[s],f=0,l=a?a.length:0,c=e===Sn;for(;f<l&&(c||!u);f++)u=a[f](n,r,i),typeof u=="string"&&(!c||o[u]?u=t:(n.dataTypes.unshift(u),u=kn(e,n,r,i,u,o)));return(c||!u)&&!o["*"]&&(u=kn(e,n,r,i,"*",o)),u}function Ln(e,n){var r,i,s=v.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&v.extend(!0,e,i)}function An(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(s in l)s in r&&(n[l[s]]=r[s]);while(f[0]==="*")f.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("content-type"));if(i)for(s in a)if(a[s]&&a[s].test(i)){f.unshift(s);break}if(f[0]in r)o=f[0];else{for(s in r){if(!f[0]||e.converters[s+" "+f[0]]){o=s;break}u||(u=s)}o=o||u}if(o)return o!==f[0]&&f.unshift(o),r[o]}function On(e,t){var n,r,i,s,o=e.dataTypes.slice(),u=o[0],a={},f=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(o[1])for(n in e.converters)a[n.toLowerCase()]=e.converters[n];for(;i=o[++f];)if(i!=="*"){if(u!=="*"&&u!==i){n=a[u+" "+i]||a["* "+i];if(!n)for(r in a){s=r.split(" ");if(s[1]===i){n=a[u+" "+s[0]]||a["* "+s[0]];if(n){n===!0?n=a[r]:a[r]!==!0&&(i=s[0],o.splice(f--,0,i));break}}}if(n!==!0)if(n&&e["throws"])t=n(t);else try{t=n(t)}catch(l){return{state:"parsererror",error:n?l:"No conversion from "+u+" to "+i}}}u=i}return{state:"success",data:t}}function Fn(){try{return new e.XMLHttpRequest}catch(t){}}function In(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function $n(){return setTimeout(function(){qn=t},0),qn=v.now()}function Jn(e,t){v.each(t,function(t,n){var r=(Vn[t]||[]).concat(Vn["*"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function Kn(e,t,n){var r,i=0,s=0,o=Xn.length,u=v.Deferred().always(function(){delete a.elem}),a=function(){var t=qn||$n(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,i=1-r,s=0,o=f.tweens.length;for(;s<o;s++)f.tweens[s].run(i);return u.notifyWith(e,[f,i,n]),i<1&&o?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:v.extend({},t),opts:v.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:qn||$n(),duration:n.duration,tweens:[],createTween:function(t,n,r){var i=v.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(i),i},stop:function(t){var n=0,r=t?f.tweens.length:0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;Qn(l,f.opts.specialEasing);for(;i<o;i++){r=Xn[i].call(f,e,l,f.opts);if(r)return r}return Jn(f,l),v.isFunction(f.opts.start)&&f.opts.start.call(e,f),v.fx.timer(v.extend(a,{anim:f,queue:f.opts.queue,elem:e})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Qn(e,t){var n,r,i,s,o;for(n in e){r=v.camelCase(n),i=t[r],s=e[n],v.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=v.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function Gn(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},m=[],g=e.nodeType&&Gt(e);n.queue||(l=v._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,v.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],v.css(e,"display")==="inline"&&v.css(e,"float")==="none"&&(!v.support.inlineBlockNeedsLayout||nn(e.nodeName)==="inline"?p.display="inline-block":p.zoom=1)),n.overflow&&(p.overflow="hidden",v.support.shrinkWrapBlocks||h.done(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){s=t[r];if(Un.exec(s)){delete t[r],a=a||s==="toggle";if(s===(g?"hide":"show"))continue;m.push(r)}}o=m.length;if(o){u=v._data(e,"fxshow")||v._data(e,"fxshow",{}),"hidden"in u&&(g=u.hidden),a&&(u.hidden=!g),g?v(e).show():h.done(function(){v(e).hide()}),h.done(function(){var t;v.removeData(e,"fxshow",!0);for(t in d)v.style(e,t,d[t])});for(r=0;r<o;r++)i=m[r],f=h.createTween(i,g?u[i]:0),d[i]=u[i]||v.style(e,i),i in u||(u[i]=f.start,g&&(f.end=f.start,f.start=i==="width"||i==="height"?1:0))}}function Yn(e,t,n,r,i){return new Yn.prototype.init(e,t,n,r,i)}function Zn(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=$t[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function tr(e){return v.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=e.document,s=e.location,o=e.navigator,u=e.jQuery,a=e.$,f=Array.prototype.push,l=Array.prototype.slice,c=Array.prototype.indexOf,h=Object.prototype.toString,p=Object.prototype.hasOwnProperty,d=String.prototype.trim,v=function(e,t){return new v.fn.init(e,t,n)},m=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,g=/\S/,y=/\s+/,b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,w=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,T=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,N=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,C=/^-ms-/,k=/-([\da-z])/gi,L=function(e,t){return(t+"").toUpperCase()},A=function(){i.addEventListener?(i.removeEventListener("DOMContentLoaded",A,!1),v.ready()):i.readyState==="complete"&&(i.detachEvent("onreadystatechange",A),v.ready())},O={};v.fn=v.prototype={constructor:v,init:function(e,n,r){var s,o,u,a;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?s=[null,e,null]:s=w.exec(e);if(s&&(s[1]||!n)){if(s[1])return n=n instanceof v?n[0]:n,a=n&&n.nodeType?n.ownerDocument||n:i,e=v.parseHTML(s[1],a,!0),E.test(s[1])&&v.isPlainObject(n)&&this.attr.call(e,n,!0),v.merge(this,e);o=i.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return r.find(e);this.length=1,this[0]=o}return this.context=i,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return v.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),v.makeArray(e,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return l.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=v.merge(this.constructor(),e);return r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return v.each(this,e,t)},ready:function(e){return v.ready.promise().done(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(l.apply(this,arguments),"slice",l.call(arguments).join(","))},map:function(e){return this.pushStack(v.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:[].sort,splice:[].splice},v.fn.init.prototype=v.fn,v.extend=v.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!v.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(n in e){r=u[n],i=e[n];if(u===i)continue;l&&i&&(v.isPlainObject(i)||(s=v.isArray(i)))?(s?(s=!1,o=r&&v.isArray(r)?r:[]):o=r&&v.isPlainObject(r)?r:{},u[n]=v.extend(l,o,i)):i!==t&&(u[n]=i)}return u},v.extend({noConflict:function(t){return e.$===v&&(e.$=a),t&&e.jQuery===v&&(e.jQuery=u),v},isReady:!1,readyWait:1,holdReady:function(e){e?v.readyWait++:v.ready(!0)},ready:function(e){if(e===!0?--v.readyWait:v.isReady)return;if(!i.body)return setTimeout(v.ready,1);v.isReady=!0;if(e!==!0&&--v.readyWait>0)return;r.resolveWith(i,[v]),v.fn.trigger&&v(i).trigger("ready").off("ready")},isFunction:function(e){return v.type(e)==="function"},isArray:Array.isArray||function(e){return v.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):O[h.call(e)]||"object"},isPlainObject:function(e){if(!e||v.type(e)!=="object"||e.nodeType||v.isWindow(e))return!1;try{if(e.constructor&&!p.call(e,"constructor")&&!p.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||p.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){var r;return!e||typeof e!="string"?null:(typeof t=="boolean"&&(n=t,t=0),t=t||i,(r=E.exec(e))?[t.createElement(r[1])]:(r=v.buildFragment([e],t,n?null:[]),v.merge([],(r.cacheable?v.clone(r.fragment):r.fragment).childNodes)))},parseJSON:function(t){if(!t||typeof t!="string")return null;t=v.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(S.test(t.replace(T,"@").replace(N,"]").replace(x,"")))return(new Function("return "+t))();v.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||typeof n!="string")return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&v.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&g.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(C,"ms-").replace(k,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,n,r){var i,s=0,o=e.length,u=o===t||v.isFunction(e);if(r){if(u){for(i in e)if(n.apply(e[i],r)===!1)break}else for(;s<o;)if(n.apply(e[s++],r)===!1)break}else if(u){for(i in e)if(n.call(e[i],i,e[i])===!1)break}else for(;s<o;)if(n.call(e[s],s,e[s++])===!1)break;return e},trim:d&&!d.call("")?function(e){return e==null?"":d.call(e)}:function(e){return e==null?"":(e+"").replace(b,"")},makeArray:function(e,t){var n,r=t||[];return e!=null&&(n=v.type(e),e.length==null||n==="string"||n==="function"||n==="regexp"||v.isWindow(e)?f.call(r,e):v.merge(r,e)),r},inArray:function(e,t,n){var r;if(t){if(c)return c.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r=="number")for(;s<r;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,n,r){var i,s,o=[],u=0,a=e.length,f=e instanceof v||a!==t&&typeof a=="number"&&(a>0&&e[0]&&e[a-1]||a===0||v.isArray(e));if(f)for(;u<a;u++)i=n(e[u],u,r),i!=null&&(o[o.length]=i);else for(s in e)i=n(e[s],s,r),i!=null&&(o[o.length]=i);return o.concat.apply([],o)},guid:1,proxy:function(e,n){var r,i,s;return typeof n=="string"&&(r=e[n],n=e,e=r),v.isFunction(e)?(i=l.call(arguments,2),s=function(){return e.apply(n,i.concat(l.call(arguments)))},s.guid=e.guid=e.guid||v.guid++,s):t},access:function(e,n,r,i,s,o,u){var a,f=r==null,l=0,c=e.length;if(r&&typeof r=="object"){for(l in r)v.access(e,n,l,r[l],1,o,i);s=1}else if(i!==t){a=u===t&&v.isFunction(i),f&&(a?(a=n,n=function(e,t,n){return a.call(v(e),n)}):(n.call(e,i),n=null));if(n)for(;l<c;l++)n(e[l],r,a?i.call(e[l],l,n(e[l],r)):i,u);s=1}return s?e:f?n.call(e):c?n(e[0],r):o},now:function(){return(new Date).getTime()}}),v.ready.promise=function(t){if(!r){r=v.Deferred();if(i.readyState==="complete")setTimeout(v.ready,1);else if(i.addEventListener)i.addEventListener("DOMContentLoaded",A,!1),e.addEventListener("load",v.ready,!1);else{i.attachEvent("onreadystatechange",A),e.attachEvent("onload",v.ready);var n=!1;try{n=e.frameElement==null&&i.documentElement}catch(s){}n&&n.doScroll&&function o(){if(!v.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}v.ready()}}()}}return r.promise(t)},v.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){O["[object "+t+"]"]=t.toLowerCase()}),n=v(i);var M={};v.Callbacks=function(e){e=typeof e=="string"?M[e]||_(e):v.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){n=e.memory&&t,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;u++)if(a[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):n?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function r(t){v.each(t,function(t,n){var i=v.type(n);i==="function"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&i!=="string"&&r(n)})})(arguments),i?o=a.length:n&&(s=t,l(n))}return this},remove:function(){return a&&v.each(arguments,function(e,t){var n;while((n=v.inArray(t,a,n))>-1)a.splice(n,1),i&&(n<=o&&o--,n<=u&&u--)}),this},has:function(e){return v.inArray(e,a)>-1},empty:function(){return a=[],this},disable:function(){return a=f=n=t,this},disabled:function(){return!a},lock:function(){return f=t,n||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!r||f)&&(i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},v.extend({Deferred:function(e){var t=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return v.Deferred(function(n){v.each(t,function(t,r){var s=r[0],o=e[t];i[r[1]](v.isFunction(o)?function(){var e=o.apply(this,arguments);e&&v.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===i?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return e!=null?v.extend(e,r):r}},i={};return r.pipe=r.then,v.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=o.fire,i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=l.call(arguments),r=n.length,i=r!==1||e&&v.isFunction(e.promise)?r:0,s=i===1?e:v.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?l.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&v.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),v.support=function(){var t,n,r,s,o,u,a,f,l,c,h,p=i.createElement("div");p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0];if(!n||!r||!n.length)return{};s=i.createElement("select"),o=s.appendChild(i.createElement("option")),u=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:u.value==="on",optSelected:o.selected,getSetAttribute:p.className!=="t",enctype:!!i.createElement("form").enctype,html5Clone:i.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:i.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},u.checked=!0,t.noCloneChecked=u.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",h=function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick"),p.detachEvent("onclick",h)),u=i.createElement("input"),u.value="t",u.setAttribute("type","radio"),t.radioValue=u.value==="t",u.setAttribute("checked","checked"),u.setAttribute("name","t"),p.appendChild(u),a=i.createDocumentFragment(),a.appendChild(p.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=u.checked,a.removeChild(u),a.appendChild(p);if(p.attachEvent)for(l in{submit:!0,change:!0,focusin:!0})f="on"+l,c=f in p,c||(p.setAttribute(f,"return;"),c=typeof p[f]=="function"),t[l+"Bubbles"]=c;return v(function(){var n,r,s,o,u="padding:0;margin:0;border:0;display:block;overflow:hidden;",a=i.getElementsByTagName("body")[0];if(!a)return;n=i.createElement("div"),n.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",a.insertBefore(n,a.firstChild),r=i.createElement("div"),n.appendChild(r),r.innerHTML="<table><tr><td></td><td>t</td></tr></table>",s=r.getElementsByTagName("td"),s[0].style.cssText="padding:0;margin:0;border:0;display:none",c=s[0].offsetHeight===0,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=c&&s[0].offsetHeight===0,r.innerHTML="",r.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=r.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(r,null)||{}).top!=="1%",t.boxSizingReliable=(e.getComputedStyle(r,null)||{width:"4px"}).width==="4px",o=i.createElement("div"),o.style.cssText=r.style.cssText=u,o.style.marginRight=o.style.width="0",r.style.width="1px",r.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),typeof r.style.zoom!="undefined"&&(r.innerHTML="",r.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=r.offsetWidth===3,r.style.display="block",r.style.overflow="visible",r.innerHTML="<div></div>",r.firstChild.style.width="5px",t.shrinkWrapBlocks=r.offsetWidth!==3,n.style.zoom=1),a.removeChild(n),n=r=s=o=null}),a.removeChild(p),n=r=s=o=u=a=p=null,t}();var D=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;v.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(v.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?v.cache[e[v.expando]]:e[v.expando],!!e&&!B(e)},data:function(e,n,r,i){if(!v.acceptData(e))return;var s,o,u=v.expando,a=typeof n=="string",f=e.nodeType,l=f?v.cache:e,c=f?e[u]:e[u]&&u;if((!c||!l[c]||!i&&!l[c].data)&&a&&r===t)return;c||(f?e[u]=c=v.deletedIds.pop()||v.guid++:c=u),l[c]||(l[c]={},f||(l[c].toJSON=v.noop));if(typeof n=="object"||typeof n=="function")i?l[c]=v.extend(l[c],n):l[c].data=v.extend(l[c].data,n);return s=l[c],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[v.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[v.camelCase(n)])):o=s,o},removeData:function(e,t,n){if(!v.acceptData(e))return;var r,i,s,o=e.nodeType,u=o?v.cache:e,a=o?e[v.expando]:v.expando;if(!u[a])return;if(t){r=n?u[a]:u[a].data;if(r){v.isArray(t)||(t in r?t=[t]:(t=v.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,s=t.length;i<s;i++)delete r[t[i]];if(!(n?B:v.isEmptyObject)(r))return}}if(!n){delete u[a].data;if(!B(u[a]))return}o?v.cleanData([e],!0):v.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null},_data:function(e,t,n){return v.data(e,t,n,!0)},acceptData:function(e){var t=e.nodeName&&v.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),v.fn.extend({data:function(e,n){var r,i,s,o,u,a=this[0],f=0,l=null;if(e===t){if(this.length){l=v.data(a);if(a.nodeType===1&&!v._data(a,"parsedAttrs")){s=a.attributes;for(u=s.length;f<u;f++)o=s[f].name,o.indexOf("data-")||(o=v.camelCase(o.substring(5)),H(a,o,l[o]));v._data(a,"parsedAttrs",!0)}}return l}return typeof e=="object"?this.each(function(){v.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",i=r[1]+"!",v.access(this,function(n){if(n===t)return l=this.triggerHandler("getData"+i,[r[0]]),l===t&&a&&(l=v.data(a,e),l=H(a,e,l)),l===t&&r[1]?this.data(r[0]):l;r[1]=n,this.each(function(){var t=v(this);t.triggerHandler("setData"+i,r),v.data(this,e,n),t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){v.removeData(this,e)})}}),v.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=v._data(e,t),n&&(!r||v.isArray(n)?r=v._data(e,t,v.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=v.queue(e,t),r=n.length,i=n.shift(),s=v._queueHooks(e,t),o=function(){v.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return v._data(e,n)||v._data(e,n,{empty:v.Callbacks("once memory").add(function(){v.removeData(e,t+"queue",!0),v.removeData(e,n,!0)})})}}),v.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?v.queue(this[0],e):n===t?this:this.each(function(){var t=v.queue(this,e,n);v._queueHooks(this,e),e==="fx"&&t[0]!=="inprogress"&&v.dequeue(this,e)})},dequeue:function(e){return this.each(function(){v.dequeue(this,e)})},delay:function(e,t){return e=v.fx?v.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=v.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!="string"&&(n=e,e=t),e=e||"fx";while(u--)r=v._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var j,F,I,q=/[\t\r\n]/g,R=/\r/g,U=/^(?:button|input)$/i,z=/^(?:button|input|object|select|textarea)$/i,W=/^a(?:rea|)$/i,X=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=v.support.getSetAttribute;v.fn.extend({attr:function(e,t){return v.access(this,v.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){v.removeAttr(this,e)})},prop:function(e,t){return v.access(this,v.prop,e,t,arguments.length>1)},removeProp:function(e){return e=v.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o,u;if(v.isFunction(e))return this.each(function(t){v(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(y);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{s=" "+i.className+" ";for(o=0,u=t.length;o<u;o++)s.indexOf(" "+t[o]+" ")<0&&(s+=t[o]+" ");i.className=v.trim(s)}}}return this},removeClass:function(e){var n,r,i,s,o,u,a;if(v.isFunction(e))return this.each(function(t){v(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(y);for(u=0,a=this.length;u<a;u++){i=this[u];if(i.nodeType===1&&i.className){r=(" "+i.className+" ").replace(q," ");for(s=0,o=n.length;s<o;s++)while(r.indexOf(" "+n[s]+" ")>=0)r=r.replace(" "+n[s]+" "," ");i.className=e?v.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return v.isFunction(e)?this.each(function(n){v(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=v(this),u=t,a=e.split(y);while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&v._data(this,"__className__",this.className),this.className=this.className||e===!1?"":v._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(q," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s)return n=v.valHooks[s.type]||v.valHooks[s.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(s,"value"))!==t?r:(r=s.value,typeof r=="string"?r.replace(R,""):r==null?"":r);return}return i=v.isFunction(e),this.each(function(r){var s,o=v(this);if(this.nodeType!==1)return;i?s=e.call(this,r,o.val()):s=e,s==null?s="":typeof s=="number"?s+="":v.isArray(s)&&(s=v.map(s,function(e){return e==null?"":e+""})),n=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,s,"value")===t)this.value=s})}}),v.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(v.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!v.nodeName(n.parentNode,"optgroup"))){t=v(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n=v.makeArray(t);return v(e).find("option").each(function(){this.selected=v.inArray(v(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{},attr:function(e,n,r,i){var s,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;if(i&&v.isFunction(v.fn[n]))return v(e)[n](r);if(typeof e.getAttribute=="undefined")return v.prop(e,n,r);u=a!==1||!v.isXMLDoc(e),u&&(n=n.toLowerCase(),o=v.attrHooks[n]||(X.test(n)?F:j));if(r!==t){if(r===null){v.removeAttr(e,n);return}return o&&"set"in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r)}return o&&"get"in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)},removeAttr:function(e,t){var n,r,i,s,o=0;if(t&&e.nodeType===1){r=t.split(y);for(;o<r.length;o++)i=r[o],i&&(n=v.propFix[i]||i,s=X.test(i),s||v.attr(e,i,""),e.removeAttribute(V?i:n),s&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(U.test(e.nodeName)&&e.parentNode)v.error("type property can't be changed");else if(!v.support.radioValue&&t==="radio"&&v.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return j&&v.nodeName(e,"button")?j.get(e,t):t in e?e.value:null},set:function(e,t,n){if(j&&v.nodeName(e,"button"))return j.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;return o=u!==1||!v.isXMLDoc(e),o&&(n=v.propFix[n]||n,s=v.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):z.test(e.nodeName)||W.test(e.nodeName)&&e.href?0:t}}}}),F={get:function(e,n){var r,i=v.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?v.removeAttr(e,n):(r=v.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},V||(I={name:!0,id:!0,coords:!0},j=v.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(I[n]?r.value!=="":r.specified)?r.value:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=i.createAttribute(n),e.setAttributeNode(r)),r.value=t+""}},v.each(["width","height"],function(e,t){v.attrHooks[t]=v.extend(v.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),v.attrHooks.contenteditable={get:j.get,set:function(e,t,n){t===""&&(t="false"),j.set(e,t,n)}}),v.support.hrefNormalized||v.each(["href","src","width","height"],function(e,n){v.attrHooks[n]=v.extend(v.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),v.support.style||(v.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+""}}),v.support.optSelected||(v.propHooks.selected=v.extend(v.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),v.support.enctype||(v.propFix.enctype="encoding"),v.support.checkOn||v.each(["radio","checkbox"],function(){v.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),v.each(["radio","checkbox"],function(){v.valHooks[this]=v.extend(v.valHooks[this],{set:function(e,t){if(v.isArray(t))return e.checked=v.inArray(v(e).val(),t)>=0}})});var $=/^(?:textarea|input|select)$/i,J=/^([^\.]*|)(?:\.(.+)|)$/,K=/(?:^|\s)hover(\.\S+|)\b/,Q=/^key/,G=/^(?:mouse|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=function(e){return v.event.special.hover?e:e.replace(K,"mouseenter$1 mouseleave$1")};v.event={add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,m,g;if(e.nodeType===3||e.nodeType===8||!n||!r||!(o=v._data(e)))return;r.handler&&(d=r,r=d.handler,s=d.selector),r.guid||(r.guid=v.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){return typeof v=="undefined"||!!e&&v.event.triggered===e.type?t:v.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=v.trim(Z(n)).split(" ");for(f=0;f<n.length;f++){l=J.exec(n[f])||[],c=l[1],h=(l[2]||"").split(".").sort(),g=v.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=v.event.special[c]||{},p=v.extend({type:c,origType:l[1],data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&v.expr.match.needsContext.test(s),namespace:h.join(".")},d),m=a[c];if(!m){m=a[c]=[],m.delegateCount=0;if(!g.setup||g.setup.call(e,i,h,u)===!1)e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent("on"+c,u)}g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),v.event.global[c]=!0}e=null},global:{},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,m,g=v.hasData(e)&&v._data(e);if(!g||!(h=g.events))return;t=v.trim(Z(t||"")).split(" ");for(s=0;s<t.length;s++){o=J.exec(t[s])||[],u=a=o[1],f=o[2];if(!u){for(u in h)v.event.remove(e,u+t[s],n,r,!0);continue}p=v.event.special[u]||{},u=(r?p.delegateType:p.bindType)||u,d=h[u]||[],l=d.length,f=f?new RegExp("(^|\\.)"+f.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(c=0;c<d.length;c++)m=d[c],(i||a===m.origType)&&(!n||n.guid===m.guid)&&(!f||f.test(m.namespace))&&(!r||r===m.selector||r==="**"&&m.selector)&&(d.splice(c--,1),m.selector&&d.delegateCount--,p.remove&&p.remove.call(e,m));d.length===0&&l!==d.length&&((!p.teardown||p.teardown.call(e,f,g.handle)===!1)&&v.removeEvent(e,u,g.handle),delete h[u])}v.isEmptyObject(h)&&(delete g.handle,v.removeData(e,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,s,o){if(!s||s.nodeType!==3&&s.nodeType!==8){var u,a,f,l,c,h,p,d,m,g,y=n.type||n,b=[];if(Y.test(y+v.event.triggered))return;y.indexOf("!")>=0&&(y=y.slice(0,-1),a=!0),y.indexOf(".")>=0&&(b=y.split("."),y=b.shift(),b.sort());if((!s||v.event.customEvent[y])&&!v.event.global[y])return;n=typeof n=="object"?n[v.expando]?n:new v.Event(y,n):new v.Event(y),n.type=y,n.isTrigger=!0,n.exclusive=a,n.namespace=b.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,h=y.indexOf(":")<0?"on"+y:"";if(!s){u=v.cache;for(f in u)u[f].events&&u[f].events[y]&&v.event.trigger(n,r,u[f].handle.elem,!0);return}n.result=t,n.target||(n.target=s),r=r!=null?v.makeArray(r):[],r.unshift(n),p=v.event.special[y]||{};if(p.trigger&&p.trigger.apply(s,r)===!1)return;m=[[s,p.bindType||y]];if(!o&&!p.noBubble&&!v.isWindow(s)){g=p.delegateType||y,l=Y.test(g+y)?s:s.parentNode;for(c=s;l;l=l.parentNode)m.push([l,g]),c=l;c===(s.ownerDocument||i)&&m.push([c.defaultView||c.parentWindow||e,g])}for(f=0;f<m.length&&!n.isPropagationStopped();f++)l=m[f][0],n.type=m[f][1],d=(v._data(l,"events")||{})[n.type]&&v._data(l,"handle"),d&&d.apply(l,r),d=h&&l[h],d&&v.acceptData(l)&&d.apply&&d.apply(l,r)===!1&&n.preventDefault();return n.type=y,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(s.ownerDocument,r)===!1)&&(y!=="click"||!v.nodeName(s,"a"))&&v.acceptData(s)&&h&&s[y]&&(y!=="focus"&&y!=="blur"||n.target.offsetWidth!==0)&&!v.isWindow(s)&&(c=s[h],c&&(s[h]=null),v.event.triggered=y,s[y](),v.event.triggered=t,c&&(s[h]=c)),n.result}return},dispatch:function(n){n=v.event.fix(n||e.event);var r,i,s,o,u,a,f,c,h,p,d=(v._data(this,"events")||{})[n.type]||[],m=d.delegateCount,g=l.call(arguments),y=!n.exclusive&&!n.namespace,b=v.event.special[n.type]||{},w=[];g[0]=n,n.delegateTarget=this;if(b.preDispatch&&b.preDispatch.call(this,n)===!1)return;if(m&&(!n.button||n.type!=="click"))for(s=n.target;s!=this;s=s.parentNode||this)if(s.disabled!==!0||n.type!=="click"){u={},f=[];for(r=0;r<m;r++)c=d[r],h=c.selector,u[h]===t&&(u[h]=c.needsContext?v(h,this).index(s)>=0:v.find(h,this,null,[s]).length),u[h]&&f.push(c);f.length&&w.push({elem:s,matches:f})}d.length>m&&w.push({elem:this,matches:d.slice(m)});for(r=0;r<w.length&&!n.isPropagationStopped();r++){a=w[r],n.currentTarget=a.elem;for(i=0;i<a.matches.length&&!n.isImmediatePropagationStopped();i++){c=a.matches[i];if(y||!n.namespace&&!c.namespace||n.namespace_re&&n.namespace_re.test(c.namespace))n.data=c.data,n.handleObj=c,o=((v.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,g),o!==t&&(n.result=o,o===!1&&(n.preventDefault(),n.stopPropagation()))}}return b.postDispatch&&b.postDispatch.call(this,n),n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,s,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||i,s=r.documentElement,o=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[v.expando])return e;var t,n,r=e,s=v.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=v.Event(r);for(t=o.length;t;)n=o[--t],e[n]=r[n];return e.target||(e.target=r.srcElement||i),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){v.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=v.extend(new v.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?v.event.trigger(i,null,t):v.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},v.event.handle=v.event.dispatch,v.removeEvent=i.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]=="undefined"&&(e[r]=null),e.detachEvent(r,n))},v.Event=function(e,t){if(!(this instanceof v.Event))return new v.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?tt:et):this.type=e,t&&v.extend(this,t),this.timeStamp=e&&e.timeStamp||v.now(),this[v.expando]=!0},v.Event.prototype={preventDefault:function(){this.isDefaultPrevented=tt;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=tt;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()},isDefaultPrevented:et,isPropagationStopped:et,isImmediatePropagationStopped:et},v.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){v.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj,o=s.selector;if(!i||i!==r&&!v.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),v.support.submitBubbles||(v.event.special.submit={setup:function(){if(v.nodeName(this,"form"))return!1;v.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=v.nodeName(n,"input")||v.nodeName(n,"button")?n.form:t;r&&!v._data(r,"_submit_attached")&&(v.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),v._data(r,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&v.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(v.nodeName(this,"form"))return!1;v.event.remove(this,"._submit")}}),v.support.changeBubbles||(v.event.special.change={setup:function(){if($.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")v.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),v.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),v.event.simulate("change",this,e,!0)});return!1}v.event.add(this,"beforeactivate._change",function(e){var t=e.target;$.test(t.nodeName)&&!v._data(t,"_change_attached")&&(v.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&v.event.simulate("change",this.parentNode,e,!0)}),v._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return v.event.remove(this,"._change"),!$.test(this.nodeName)}}),v.support.focusinBubbles||v.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){v.event.simulate(t,e.target,v.event.fix(e),!0)};v.event.special[t]={setup:function(){n++===0&&i.addEventListener(e,r,!0)},teardown:function(){--n===0&&i.removeEventListener(e,r,!0)}}}),v.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(u in e)this.on(u,n,r,e[u],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=et;else if(!i)return this;return s===1&&(o=i,i=function(e){return v().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=v.guid++)),this.each(function(){v.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,v(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if(typeof e=="object"){for(s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=et),this.each(function(){v.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return v(this.context).on(e,this.selector,t,n),this},die:function(e,t){return v(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){v.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return v.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||v.guid++,r=0,i=function(n){var i=(v._data(this,"lastToggle"+e.guid)||0)%r;return v._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){v.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},Q.test(t)&&(v.event.fixHooks[t]=v.event.keyHooks),G.test(t)&&(v.event.fixHooks[t]=v.event.mouseHooks)}),function(e,t){function nt(e,t,n,r){n=n||[],t=t||g;var i,s,a,f,l=t.nodeType;if(!e||typeof e!="string")return n;if(l!==1&&l!==9)return[];a=o(t);if(!a&&!r)if(i=R.exec(e))if(f=i[1]){if(l===9){s=t.getElementById(f);if(!s||!s.parentNode)return n;if(s.id===f)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f)return n.push(s),n}else{if(i[2])return S.apply(n,x.call(t.getElementsByTagName(e),0)),n;if((f=i[3])&&Z&&t.getElementsByClassName)return S.apply(n,x.call(t.getElementsByClassName(f),0)),n}return vt(e.replace(j,"$1"),t,n,r,a)}function rt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function it(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function st(e){return N(function(t){return t=+t,N(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ot(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}function ut(e,t){var n,r,s,o,u,a,f,l=L[d][e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=F.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=I.exec(u))s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=r[0].replace(j," ");for(o in i.filter)(r=J[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r);if(!n)break}return t?u.length:u?nt.error(e):L(e,a).slice(0)}function at(e,t,r){var i=t.dir,s=r&&t.dir==="parentNode",o=w++;return t.first?function(t,n,r){while(t=t[i])if(s||t.nodeType===1)return e(t,n,r)}:function(t,r,u){if(!u){var a,f=b+" "+o+" ",l=f+n;while(t=t[i])if(s||t.nodeType===1){if((a=t[d])===l)return t.sizset;if(typeof a=="string"&&a.indexOf(f)===0){if(t.sizset)return t}else{t[d]=l;if(e(t,r,u))return t.sizset=!0,t;t.sizset=!1}}}else while(t=t[i])if(s||t.nodeType===1)if(e(t,r,u))return t}}function ft(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function lt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function ct(e,t,n,r,i,s){return r&&!r[d]&&(r=ct(r)),i&&!i[d]&&(i=ct(i,s)),N(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||dt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?lt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=lt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?T.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=lt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):S.apply(o,g)})}function ht(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,f=at(function(e){return e===t},u,!0),l=at(function(e){return T.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[at(ft(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[d]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return ct(a>1&&ft(h),a>1&&e.slice(0,a-1).join("").replace(j,"$1"),n,a<r&&ht(e.slice(a,r)),r<s&&ht(e=e.slice(r)),r<s&&e.join(""))}h.push(n)}return ft(h)}function pt(e,t){var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){var p,d,v,m=[],y=0,w="0",x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG("*",h&&a.parentNode||a),k=b+=N==null?1:Math.E;T&&(c=a!==g&&a,n=o.el);for(;(p=C[w])!=null;w++){if(s&&p){for(d=0;v=e[d];d++)if(v(p,a,f)){l.push(p);break}T&&(b=k,n=++o.el)}r&&((p=!v&&p)&&y--,u&&x.push(p))}y+=w;if(r&&w!==y){for(d=0;v=t[d];d++)v(x,m,a,f);if(u){if(y>0)while(w--)!x[w]&&!m[w]&&(m[w]=E.call(l));m=lt(m)}S.apply(l,m),T&&!u&&m.length>0&&y+t.length>1&&nt.uniqueSort(l)}return T&&(b=k,c=N),x};return o.el=0,r?N(o):o}function dt(e,t,n){var r=0,i=t.length;for(;r<i;r++)nt(e,t[r],n);return n}function vt(e,t,n,r,s){var o,u,f,l,c,h=ut(e),p=h.length;if(!r&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&t.nodeType===9&&!s&&i.relative[u[1].type]){t=i.find.ID(f.matches[0].replace($,""),t,s)[0];if(!t)return n;e=e.slice(u.shift().length)}for(o=J.POS.test(e)?-1:u.length-1;o>=0;o--){f=u[o];if(i.relative[l=f.type])break;if(c=i.find[l])if(r=c(f.matches[0].replace($,""),z.test(u[0].type)&&t.parentNode||t,s)){u.splice(o,1),e=r.length&&u.join("");if(!e)return S.apply(n,x.call(r,0)),n;break}}}return a(e,h)(r,t,s,n,z.test(e)),n}function mt(){}var n,r,i,s,o,u,a,f,l,c,h=!0,p="undefined",d=("sizcache"+Math.random()).replace(".",""),m=String,g=e.document,y=g.documentElement,b=0,w=0,E=[].pop,S=[].push,x=[].slice,T=[].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},N=function(e,t){return e[d]=t==null||t,e},C=function(){var e={},t=[];return N(function(n,r){return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+" "]=r},e)},k=C(),L=C(),A=C(),O="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",_=M.replace("w","w#"),D="([*^$|!~]?=)",P="\\["+O+"*("+M+")"+O+"*(?:"+D+O+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+_+")|)|)"+O+"*\\]",H=":("+M+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+P+")|[^:]|\\\\.)*|.*))\\)|)",B=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)",j=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g"),F=new RegExp("^"+O+"*,"+O+"*"),I=new RegExp("^"+O+"*([\\x20\\t\\r\\n\\f>+~])"+O+"*"),q=new RegExp(H),R=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,U=/^:not/,z=/[\x20\t\r\n\f]*[+~]/,W=/:not\($/,X=/h\d/i,V=/input|select|textarea|button/i,$=/\\(?!\\)/g,J={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),NAME:new RegExp("^\\[name=['\"]?("+M+")['\"]?\\]"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+H),POS:new RegExp(B,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),needsContext:new RegExp("^"+O+"*[>+~]|"+B,"i")},K=function(e){var t=g.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}},Q=K(function(e){return e.appendChild(g.createComment("")),!e.getElementsByTagName("*").length}),G=K(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute("href")==="#"}),Y=K(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),Z=K(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),et=K(function(e){e.id=d+0,e.innerHTML="<a name='"+d+"'></a><div name='"+d+"'></div>",y.insertBefore(e,y.firstChild);var t=g.getElementsByName&&g.getElementsByName(d).length===2+g.getElementsByName(d+0).length;return r=!g.getElementById(d),y.removeChild(e),t});try{x.call(y.childNodes,0)[0].nodeType}catch(tt){x=function(e){var t,n=[];for(;t=this[e];e++)n.push(t);return n}}nt.matches=function(e,t){return nt(e,null,null,t)},nt.matchesSelector=function(e,t){return nt(t,null,null,[e]).length>0},s=nt.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},o=nt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},u=nt.contains=y.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:y.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1},nt.attr=function(e,t){var n,r=o(e);return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||Y?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]=="boolean"?e[t]?t:null:n.specified?n.value:null:null)},i=nt.selectors={cacheLength:50,createPseudo:N,match:J,attrHandle:G?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:r?function(e,t,n){if(typeof t.getElementById!==p&&!n){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}}:function(e,n,r){if(typeof n.getElementById!==p&&!r){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode("id").value===e?[i]:t:[]}},TAG:Q?function(e,t){if(typeof t.getElementsByTagName!==p)return t.getElementsByTagName(e)}:function(e,t){var n=t.getElementsByTagName(e);if(e==="*"){var r,i=[],s=0;for(;r=n[s];s++)r.nodeType===1&&i.push(r);return i}return n},NAME:et&&function(e,t){if(typeof t.getElementsByName!==p)return t.getElementsByName(name)},CLASS:Z&&function(e,t,n){if(typeof t.getElementsByClassName!==p&&!n)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace($,""),e[3]=(e[4]||e[5]||"").replace($,""),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]==="nth"?(e[2]||nt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd")),e[4]=+(e[6]+e[7]||e[2]==="odd")):e[2]&&nt.error(e[0]),e},PSEUDO:function(e){var t,n;if(J.CHILD.test(e[0]))return null;if(e[3])e[2]=e[3];else if(t=e[4])q.test(t)&&(n=ut(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t;return e.slice(0,3)}},filter:{ID:r?function(e){return e=e.replace($,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace($,""),function(t){var n=typeof t.getAttributeNode!==p&&t.getAttributeNode("id");return n&&n.value===e}},TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace($,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[d][e+" "];return t||(t=new RegExp("(^|"+O+")"+e+"("+O+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r,i){var s=nt.attr(r,e);return s==null?t==="!=":t?(s+="",t==="="?s===n:t==="!="?s!==n:t==="^="?n&&s.indexOf(n)===0:t==="*="?n&&s.indexOf(n)>-1:t==="$="?n&&s.substr(s.length-n.length)===n:t==="~="?(" "+s+" ").indexOf(n)>-1:t==="|="?s===n||s.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r){return e==="nth"?function(e){var t,i,s=e.parentNode;if(n===1&&r===0)return!0;if(s){i=0;for(t=s.firstChild;t;t=t.nextSibling)if(t.nodeType===1){i++;if(e===t)break}}return i-=r,i===n||i%n===0&&i/n>=0}:function(t){var n=t;switch(e){case"only":case"first":while(n=n.previousSibling)if(n.nodeType===1)return!1;if(e==="first")return!0;n=t;case"last":while(n=n.nextSibling)if(n.nodeType===1)return!1;return!0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||nt.error("unsupported pseudo: "+e);return r[d]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?N(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=T.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:N(function(e){var t=[],n=[],r=a(e.replace(j,"$1"));return r[d]?N(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:N(function(e){return function(t){return nt(e,t).length>0}}),contains:N(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!i.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>"@"||(t=e.nodeType)===3||t===4)return!1;e=e.nextSibling}return!0},header:function(e){return X.test(e.nodeName)},text:function(e){var t,n;return e.nodeName.toLowerCase()==="input"&&(t=e.type)==="text"&&((n=e.getAttribute("type"))==null||n.toLowerCase()===t)},radio:rt("radio"),checkbox:rt("checkbox"),file:rt("file"),password:rt("password"),image:rt("image"),submit:it("submit"),reset:it("reset"),button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},input:function(e){return V.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:st(function(){return[0]}),last:st(function(e,t){return[t-1]}),eq:st(function(e,t,n){return[n<0?n+t:n]}),even:st(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:st(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:st(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:st(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},f=y.compareDocumentPosition?function(e,t){return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t)return l=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;if(o===u)return ot(e,t);if(!o)return-1;if(!u)return 1;while(a)i.unshift(a),a=a.parentNode;a=u;while(a)s.unshift(a),a=a.parentNode;n=i.length,r=s.length;for(var f=0;f<n&&f<r;f++)if(i[f]!==s[f])return ot(i[f],s[f]);return f===n?ot(e,s[f],-1):ot(i[f],t,1)},[0,0].sort(f),h=!l,nt.uniqueSort=function(e){var t,n=[],r=1,i=0;l=h,e.sort(f);if(l){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},nt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},a=nt.compile=function(e,t){var n,r=[],i=[],s=A[d][e+" "];if(!s){t||(t=ut(e)),n=t.length;while(n--)s=ht(t[n]),s[d]?r.push(s):i.push(s);s=A(e,pt(i,r))}return s},g.querySelectorAll&&function(){var e,t=vt,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[":focus"],s=[":active"],u=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;K(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||i.push("\\["+O+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||i.push(":checked")}),K(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&i.push("[*^$]="+O+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||i.push(":enabled",":disabled")}),i=new RegExp(i.join("|")),vt=function(e,r,s,o,u){if(!o&&!u&&!i.test(e)){var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){a=ut(e),(l=r.getAttribute("id"))?c=l.replace(n,"\\$&"):r.setAttribute("id",c),c="[id='"+c+"'] ",f=a.length;while(f--)a[f]=c+a[f].join("");h=z.test(e)&&r.parentNode||r,p=a.join(",")}if(p)try{return S.apply(s,x.call(h.querySelectorAll(p),0)),s}catch(v){}finally{l||r.removeAttribute("id")}}return t(e,r,s,o,u)},u&&(K(function(t){e=u.call(t,"div");try{u.call(t,"[test!='']:sizzle"),s.push("!=",H)}catch(n){}}),s=new RegExp(s.join("|")),nt.matchesSelector=function(t,n){n=n.replace(r,"='$1']");if(!o(t)&&!s.test(n)&&!i.test(n))try{var a=u.call(t,n);if(a||e||t.document&&t.document.nodeType!==11)return a}catch(f){}return nt(n,null,null,[t]).length>0})}(),i.pseudos.nth=i.pseudos.eq,i.filters=mt.prototype=i.pseudos,i.setFilters=new mt,nt.attr=v.attr,v.find=nt,v.expr=nt.selectors,v.expr[":"]=v.expr.pseudos,v.unique=nt.uniqueSort,v.text=nt.getText,v.isXMLDoc=nt.isXML,v.contains=nt.contains}(e);var nt=/Until$/,rt=/^(?:parents|prev(?:Until|All))/,it=/^.[^:#\[\.,]*$/,st=v.expr.match.needsContext,ot={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(e){var t,n,r,i,s,o,u=this;if(typeof e!="string")return v(e).filter(function(){for(t=0,n=u.length;t<n;t++)if(v.contains(u[t],this))return!0});o=this.pushStack("","find",e);for(t=0,n=this.length;t<n;t++){r=o.length,v.find(e,this[t],o);if(t>0)for(i=r;i<o.length;i++)for(s=0;s<r;s++)if(o[s]===o[i]){o.splice(i--,1);break}}return o},has:function(e){var t,n=v(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(v.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1),"not",e)},filter:function(e){return this.pushStack(ft(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?st.test(e)?v(e,this.context).index(this[0])>=0:v.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=st.test(e)||typeof e!="string"?v(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:v.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return s=s.length>1?v.unique(s):s,this.pushStack(s,"closest",e)},index:function(e){return e?typeof e=="string"?v.inArray(this[0],v(e)):v.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?v(e,t):v.makeArray(e&&e.nodeType?[e]:e),r=v.merge(this.get(),n);return this.pushStack(ut(n[0])||ut(r[0])?r:v.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),v.fn.andSelf=v.fn.addBack,v.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return v.dir(e,"parentNode")},parentsUntil:function(e,t,n){return v.dir(e,"parentNode",n)},next:function(e){return at(e,"nextSibling")},prev:function(e){return at(e,"previousSibling")},nextAll:function(e){return v.dir(e,"nextSibling")},prevAll:function(e){return v.dir(e,"previousSibling")},nextUntil:function(e,t,n){return v.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return v.dir(e,"previousSibling",n)},siblings:function(e){return v.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return v.sibling(e.firstChild)},contents:function(e){return v.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:v.merge([],e.childNodes)}},function(e,t){v.fn[e]=function(n,r){var i=v.map(this,t,n);return nt.test(e)||(r=n),r&&typeof r=="string"&&(i=v.filter(r,i)),i=this.length>1&&!ot[e]?v.unique(i):i,this.length>1&&rt.test(e)&&(i=i.reverse()),this.pushStack(i,e,l.call(arguments).join(","))}}),v.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?v.find.matchesSelector(t[0],e)?[t[0]]:[]:v.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!v(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var ct="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ht=/ jQuery\d+="(?:null|\d+)"/g,pt=/^\s+/,dt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,vt=/<([\w:]+)/,mt=/<tbody/i,gt=/<|&#?\w+;/,yt=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,wt=new RegExp("<(?:"+ct+")[\\s/>]","i"),Et=/^(?:checkbox|radio)$/,St=/checked\s*(?:[^=]|=\s*.checked.)/i,xt=/\/(java|ecma)script/i,Tt=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Nt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ct=lt(i),kt=Ct.appendChild(i.createElement("div"));Nt.optgroup=Nt.option,Nt.tbody=Nt.tfoot=Nt.colgroup=Nt.caption=Nt.thead,Nt.th=Nt.td,v.support.htmlSerialize||(Nt._default=[1,"X<div>","</div>"]),v.fn.extend({text:function(e){return v.access(this,function(e){return e===t?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(v.isFunction(e))return this.each(function(t){v(this).wrapAll(e.call(this,t))});if(this[0]){var t=v(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return v.isFunction(e)?this.each(function(t){v(this).wrapInner(e.call(this,t))}):this.each(function(){var t=v(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=v.isFunction(e);return this.each(function(n){v(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,"body")||v(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(e,this),"before",this.selector)}},after:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(this,e),"after",this.selector)}},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++)if(!e||v.filter(e,[n]).length)!t&&n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),v.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n);return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&v.cleanData(e.getElementsByTagName("*"));while(e.firstChild)e.removeChild(e.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return v.clone(this,e,t)})},html:function(e){return v.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(ht,""):t;if(typeof e=="string"&&!yt.test(e)&&(v.support.htmlSerialize||!wt.test(e))&&(v.support.leadingWhitespace||!pt.test(e))&&!Nt[(vt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(dt,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return ut(this[0])?this.length?this.pushStack(v(v.isFunction(e)?e():e),"replaceWith",e):this:v.isFunction(e)?this.each(function(t){var n=v(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=v(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;v(this).remove(),t?v(t).before(e):v(n).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=[].concat.apply([],e);var i,s,o,u,a=0,f=e[0],l=[],c=this.length;if(!v.support.checkClone&&c>1&&typeof f=="string"&&St.test(f))return this.each(function(){v(this).domManip(e,n,r)});if(v.isFunction(f))return this.each(function(i){var s=v(this);e[0]=f.call(this,i,n?s.html():t),s.domManip(e,n,r)});if(this[0]){i=v.buildFragment(e,this,l),o=i.fragment,s=o.firstChild,o.childNodes.length===1&&(o=s);if(s){n=n&&v.nodeName(s,"tr");for(u=i.cacheable||c-1;a<c;a++)r.call(n&&v.nodeName(this[a],"table")?Lt(this[a],"tbody"):this[a],a===u?o:v.clone(o,!0,!0))}o=s=null,l.length&&v.each(l,function(e,t){t.src?v.ajax?v.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):v.error("no ajax"):v.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Tt,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),v.buildFragment=function(e,n,r){var s,o,u,a=e[0];return n=n||i,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,e.length===1&&typeof a=="string"&&a.length<512&&n===i&&a.charAt(0)==="<"&&!bt.test(a)&&(v.support.checkClone||!St.test(a))&&(v.support.html5Clone||!wt.test(a))&&(o=!0,s=v.fragments[a],u=s!==t),s||(s=n.createDocumentFragment(),v.clean(e,n,s,r),o&&(v.fragments[a]=u&&s)),{fragment:s,cacheable:o}},v.fragments={},v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){v.fn[e]=function(n){var r,i=0,s=[],o=v(n),u=o.length,a=this.length===1&&this[0].parentNode;if((a==null||a&&a.nodeType===11&&a.childNodes.length===1)&&u===1)return o[t](this[0]),this;for(;i<u;i++)r=(i>0?this.clone(!0):this).get(),v(o[i])[t](r),s=s.concat(r);return this.pushStack(s,e,o.selector)}}),v.extend({clone:function(e,t,n){var r,i,s,o;v.support.html5Clone||v.isXMLDoc(e)||!wt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(kt.innerHTML=e.outerHTML,kt.removeChild(o=kt.firstChild));if((!v.support.noCloneEvent||!v.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!v.isXMLDoc(e)){Ot(e,o),r=Mt(e),i=Mt(o);for(s=0;r[s];++s)i[s]&&Ot(r[s],i[s])}if(t){At(e,o);if(n){r=Mt(e),i=Mt(o);for(s=0;r[s];++s)At(r[s],i[s])}}return r=i=null,o},clean:function(e,t,n,r){var s,o,u,a,f,l,c,h,p,d,m,g,y=t===i&&Ct,b=[];if(!t||typeof t.createDocumentFragment=="undefined")t=i;for(s=0;(u=e[s])!=null;s++){typeof u=="number"&&(u+="");if(!u)continue;if(typeof u=="string")if(!gt.test(u))u=t.createTextNode(u);else{y=y||lt(t),c=t.createElement("div"),y.appendChild(c),u=u.replace(dt,"<$1></$2>"),a=(vt.exec(u)||["",""])[1].toLowerCase(),f=Nt[a]||Nt._default,l=f[0],c.innerHTML=f[1]+u+f[2];while(l--)c=c.lastChild;if(!v.support.tbody){h=mt.test(u),p=a==="table"&&!h?c.firstChild&&c.firstChild.childNodes:f[1]==="<table>"&&!h?c.childNodes:[];for(o=p.length-1;o>=0;--o)v.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])}!v.support.leadingWhitespace&&pt.test(u)&&c.insertBefore(t.createTextNode(pt.exec(u)[0]),c.firstChild),u=c.childNodes,c.parentNode.removeChild(c)}u.nodeType?b.push(u):v.merge(b,u)}c&&(u=c=y=null);if(!v.support.appendChecked)for(s=0;(u=b[s])!=null;s++)v.nodeName(u,"input")?_t(u):typeof u.getElementsByTagName!="undefined"&&v.grep(u.getElementsByTagName("input"),_t);if(n){m=function(e){if(!e.type||xt.test(e.type))return r?r.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)};for(s=0;(u=b[s])!=null;s++)if(!v.nodeName(u,"script")||!m(u))n.appendChild(u),typeof u.getElementsByTagName!="undefined"&&(g=v.grep(v.merge([],u.getElementsByTagName("script")),m),b.splice.apply(b,[s+1,0].concat(g)),s+=g.length)}return b},cleanData:function(e,t){var n,r,i,s,o=0,u=v.expando,a=v.cache,f=v.support.deleteExpando,l=v.event.special;for(;(i=e[o])!=null;o++)if(t||v.acceptData(i)){r=i[u],n=r&&a[r];if(n){if(n.events)for(s in n.events)l[s]?v.event.remove(i,s):v.removeEvent(i,s,n.handle);a[r]&&(delete a[r],f?delete i[u]:i.removeAttribute?i.removeAttribute(u):i[u]=null,v.deletedIds.push(r))}}}}),function(){var e,t;v.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e=v.uaMatch(o.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),v.browser=t,v.sub=function(){function e(t,n){return new e.fn.init(t,n)}v.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,i){return i&&i instanceof v&&!(i instanceof e)&&(i=e(i)),v.fn.init.call(this,r,i,t)},e.fn.init.prototype=e.fn;var t=e(i);return e}}();var Dt,Pt,Ht,Bt=/alpha\([^)]*\)/i,jt=/opacity=([^)]*)/,Ft=/^(top|right|bottom|left)$/,It=/^(none|table(?!-c[ea]).+)/,qt=/^margin/,Rt=new RegExp("^("+m+")(.*)$","i"),Ut=new RegExp("^("+m+")(?!px)[a-z%]+$","i"),zt=new RegExp("^([-+])=("+m+")","i"),Wt={BODY:"block"},Xt={position:"absolute",visibility:"hidden",display:"block"},Vt={letterSpacing:0,fontWeight:400},$t=["Top","Right","Bottom","Left"],Jt=["Webkit","O","Moz","ms"],Kt=v.fn.toggle;v.fn.extend({css:function(e,n){return v.access(this,function(e,n,r){return r!==t?v.style(e,n,r):v.css(e,n)},e,n,arguments.length>1)},show:function(){return Yt(this,!0)},hide:function(){return Yt(this)},toggle:function(e,t){var n=typeof e=="boolean";return v.isFunction(e)&&v.isFunction(t)?Kt.apply(this,arguments):this.each(function(){(n?e:Gt(this))?v(this).show():v(this).hide()})}}),v.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Dt(e,"opacity");return n===""?"1":n}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":v.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var s,o,u,a=v.camelCase(n),f=e.style;n=v.cssProps[a]||(v.cssProps[a]=Qt(f,a)),u=v.cssHooks[n]||v.cssHooks[a];if(r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];o=typeof r,o==="string"&&(s=zt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(v.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!v.cssNumber[a]&&(r+="px");if(!u||!("set"in u)||(r=u.set(e,r,i))!==t)try{f[n]=r}catch(l){}},css:function(e,n,r,i){var s,o,u,a=v.camelCase(n);return n=v.cssProps[a]||(v.cssProps[a]=Qt(e.style,a)),u=v.cssHooks[n]||v.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,i)),s===t&&(s=Dt(e,n)),s==="normal"&&n in Vt&&(s=Vt[n]),r||i!==t?(o=parseFloat(s),r||v.isNumeric(o)?o||0:s):s},swap:function(e,t,n){var r,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];r=n.call(e);for(i in t)e.style[i]=s[i];return r}}),e.getComputedStyle?Dt=function(t,n){var r,i,s,o,u=e.getComputedStyle(t,null),a=t.style;return u&&(r=u.getPropertyValue(n)||u[n],r===""&&!v.contains(t.ownerDocument,t)&&(r=v.style(t,n)),Ut.test(r)&&qt.test(n)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=r,r=u.width,a.width=i,a.minWidth=s,a.maxWidth=o)),r}:i.documentElement.currentStyle&&(Dt=function(e,t){var n,r,i=e.currentStyle&&e.currentStyle[t],s=e.style;return i==null&&s&&s[t]&&(i=s[t]),Ut.test(i)&&!Ft.test(t)&&(n=s.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),s.left=t==="fontSize"?"1em":i,i=s.pixelLeft+"px",s.left=n,r&&(e.runtimeStyle.left=r)),i===""?"auto":i}),v.each(["height","width"],function(e,t){v.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&It.test(Dt(e,"display"))?v.swap(e,Xt,function(){return tn(e,t,r)}):tn(e,t,r)},set:function(e,n,r){return Zt(e,n,r?en(e,t,r,v.support.boxSizing&&v.css(e,"boxSizing")==="border-box"):0)}}}),v.support.opacity||(v.cssHooks.opacity={get:function(e,t){return jt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=v.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&v.trim(s.replace(Bt,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=Bt.test(s)?s.replace(Bt,i):s+" "+i}}),v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(e,t){return v.swap(e,{display:"inline-block"},function(){if(t)return Dt(e,"marginRight")})}}),!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],function(e,t){v.cssHooks[t]={get:function(e,n){if(n){var r=Dt(e,t);return Ut.test(r)?v(e).position()[t]+"px":r}}}})}),v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(e){return e.offsetWidth===0&&e.offsetHeight===0||!v.support.reliableHiddenOffsets&&(e.style&&e.style.display||Dt(e,"display"))==="none"},v.expr.filters.visible=function(e){return!v.expr.filters.hidden(e)}),v.each({margin:"",padding:"",border:"Width"},function(e,t){v.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++)s[e+$t[r]+t]=i[r]||i[r-2]||i[0];return s}},qt.test(e)||(v.cssHooks[e+t].set=Zt)});var rn=/%20/g,sn=/\[\]$/,on=/\r?\n/g,un=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,an=/^(?:select|textarea)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?v.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||an.test(this.nodeName)||un.test(this.type))}).map(function(e,t){var n=v(this).val();return n==null?null:v.isArray(n)?v.map(n,function(e,n){return{name:t.name,value:e.replace(on,"\r\n")}}):{name:t.name,value:n.replace(on,"\r\n")}}).get()}}),v.param=function(e,n){var r,i=[],s=function(e,t){t=v.isFunction(t)?t():t==null?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(e)||e.jquery&&!v.isPlainObject(e))v.each(e,function(){s(this.name,this.value)});else for(r in e)fn(r,e[r],n,s);return i.join("&").replace(rn,"+")};var ln,cn,hn=/#.*$/,pn=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,dn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,vn=/^(?:GET|HEAD)$/,mn=/^\/\//,gn=/\?/,yn=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bn=/([?&])_=[^&]*/,wn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,En=v.fn.load,Sn={},xn={},Tn=["*/"]+["*"];try{cn=s.href}catch(Nn){cn=i.createElement("a"),cn.href="",cn=cn.href}ln=wn.exec(cn.toLowerCase())||[],v.fn.load=function(e,n,r){if(typeof e!="string"&&En)return En.apply(this,arguments);if(!this.length)return this;var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),v.isFunction(n)?(r=n,n=t):n&&typeof n=="object"&&(s="POST"),v.ajax({url:e,type:s,dataType:"html",data:n,complete:function(e,t){r&&u.each(r,o||[e.responseText,t,e])}}).done(function(e){o=arguments,u.html(i?v("<div>").append(e.replace(yn,"")).find(i):e)}),this},v.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){v.fn[t]=function(e){return this.on(t,e)}}),v.each(["get","post"],function(e,n){v[n]=function(e,r,i,s){return v.isFunction(r)&&(s=s||i,i=r,r=t),v.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),v.extend({getScript:function(e,n){return v.get(e,t,n,"script")},getJSON:function(e,t,n){return v.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?Ln(e,v.ajaxSettings):(t=e,e=v.ajaxSettings),Ln(e,t),e},ajaxSettings:{url:cn,isLocal:dn.test(ln[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Tn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":v.parseJSON,"text xml":v.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Cn(Sn),ajaxTransport:Cn(xn),ajax:function(e,n){function T(e,n,s,a){var l,y,b,w,S,T=n;if(E===2)return;E=2,u&&clearTimeout(u),o=t,i=a||"",x.readyState=e>0?4:0,s&&(w=An(c,x,s));if(e>=200&&e<300||e===304)c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(v.lastModified[r]=S),S=x.getResponseHeader("Etag"),S&&(v.etag[r]=S)),e===304?(T="notmodified",l=!0):(l=On(c,w),T=l.state,y=l.data,b=l.error,l=!b);else{b=T;if(!T||e)T="error",e<0&&(e=0)}x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[y,T,x]):d.rejectWith(h,[x,T,b]),x.statusCode(g),g=t,f&&p.trigger("ajax"+(l?"Success":"Error"),[x,c,l?y:b]),m.fireWith(h,[x,T]),f&&(p.trigger("ajaxComplete",[x,c]),--v.active||v.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=v.ajaxSetup({},n),h=c.context||c,p=h!==c&&(h.nodeType||h instanceof v)?v(h):v.event,d=v.Deferred(),m=v.Callbacks("once memory"),g=c.statusCode||{},b={},w={},E=0,S="canceled",x={readyState:0,setRequestHeader:function(e,t){if(!E){var n=e.toLowerCase();e=w[n]=w[n]||e,b[e]=t}return this},getAllResponseHeaders:function(){return E===2?i:null},getResponseHeader:function(e){var n;if(E===2){if(!s){s={};while(n=pn.exec(i))s[n[1].toLowerCase()]=n[2]}n=s[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return E||(c.mimeType=e),this},abort:function(e){return e=e||S,o&&o.abort(e),T(0,e),this}};d.promise(x),x.success=x.done,x.error=x.fail,x.complete=m.add,x.statusCode=function(e){if(e){var t;if(E<2)for(t in e)g[t]=[g[t],e[t]];else t=e[x.status],x.always(t)}return this},c.url=((e||c.url)+"").replace(hn,"").replace(mn,ln[1]+"//"),c.dataTypes=v.trim(c.dataType||"*").toLowerCase().split(y),c.crossDomain==null&&(a=wn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ln[1]&&a[2]===ln[2]&&(a[3]||(a[1]==="http:"?80:443))==(ln[3]||(ln[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=v.param(c.data,c.traditional)),kn(Sn,c,n,x);if(E===2)return x;f=c.global,c.type=c.type.toUpperCase(),c.hasContent=!vn.test(c.type),f&&v.active++===0&&v.event.trigger("ajaxStart");if(!c.hasContent){c.data&&(c.url+=(gn.test(c.url)?"&":"?")+c.data,delete c.data),r=c.url;if(c.cache===!1){var N=v.now(),C=c.url.replace(bn,"$1_="+N);c.url=C+(C===c.url?(gn.test(c.url)?"&":"?")+"_="+N:"")}}(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),c.ifModified&&(r=r||c.url,v.lastModified[r]&&x.setRequestHeader("If-Modified-Since",v.lastModified[r]),v.etag[r]&&x.setRequestHeader("If-None-Match",v.etag[r])),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+Tn+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)x.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&E!==2){S="abort";for(l in{success:1,error:1,complete:1})x[l](c[l]);o=kn(xn,c,n,x);if(!o)T(-1,"No Transport");else{x.readyState=1,f&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{E=1,o.send(b,T)}catch(k){if(!(E<2))throw k;T(-1,k)}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var Mn=[],_n=/\?/,Dn=/(=)\?(?=&|$)|\?\?/,Pn=v.now();v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Mn.pop()||v.expando+"_"+Pn++;return this[e]=!0,e}}),v.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.data,f=n.url,l=n.jsonp!==!1,c=l&&Dn.test(f),h=l&&!c&&typeof a=="string"&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dn.test(a);if(n.dataTypes[0]==="jsonp"||c||h)return s=n.jsonpCallback=v.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,o=e[s],c?n.url=f.replace(Dn,"$1"+s):h?n.data=a.replace(Dn,"$1"+s):l&&(n.url+=(_n.test(f)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||v.error(s+" was not called"),u[0]},n.dataTypes[0]="json",e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,Mn.push(s)),u&&v.isFunction(o)&&o(u[0]),u=o=t}),"script"}),v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return v.globalEval(e),e}}}),v.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),v.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=i.head||i.getElementsByTagName("head")[0]||i.documentElement;return{send:function(s,o){n=i.createElement("script"),n.async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||o(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Hn,Bn=e.ActiveXObject?function(){for(var e in Hn)Hn[e](0,1)}:!1,jn=0;v.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&Fn()||In()}:Fn,function(e){v.extend(v.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(v.ajaxSettings.xhr()),v.support.ajax&&v.ajaxTransport(function(n){if(!n.crossDomain||v.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c,h;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=v.noop,Bn&&delete Hn[o]);if(i)a.readyState!==4&&a.abort();else{u=a.status,l=a.getAllResponseHeaders(),c={},h=a.responseXML,h&&h.documentElement&&(c.xml=h);try{c.text=a.responseText}catch(p){}try{f=a.statusText}catch(p){f=""}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(d){i||s(-1,d)}c&&s(u,f,c,l)},n.async?a.readyState===4?setTimeout(r,0):(o=++jn,Bn&&(Hn||(Hn={},v(e).unload(Bn)),Hn[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(0,1)}}}});var qn,Rn,Un=/^(?:toggle|show|hide)$/,zn=new RegExp("^(?:([-+])=|)("+m+")([a-z%]*)$","i"),Wn=/queueHooks$/,Xn=[Gn],Vn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=zn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(v.cssNumber[e]?"":"px");if(r!=="px"&&u){u=v.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,v.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};v.Animation=v.extend(Kn,{tweener:function(e,t){v.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],Vn[n]=Vn[n]||[],Vn[n].unshift(t)},prefilter:function(e,t){t?Xn.unshift(e):Xn.push(e)}}),v.Tween=Yn,Yn.prototype={constructor:Yn,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(v.cssNumber[n]?"":"px")},cur:function(){var e=Yn.propHooks[this.prop];return e&&e.get?e.get(this):Yn.propHooks._default.get(this)},run:function(e){var t,n=Yn.propHooks[this.prop];return this.options.duration?this.pos=t=v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yn.propHooks._default.set(this),this}},Yn.prototype.init.prototype=Yn.prototype,Yn.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=v.css(e.elem,e.prop,!1,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){v.fx.step[e.prop]?v.fx.step[e.prop](e):e.elem.style&&(e.elem.style[v.cssProps[e.prop]]!=null||v.cssHooks[e.prop])?v.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yn.propHooks.scrollTop=Yn.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},v.each(["toggle","show","hide"],function(e,t){var n=v.fn[t];v.fn[t]=function(r,i,s){return r==null||typeof r=="boolean"||!e&&v.isFunction(r)&&v.isFunction(i)?n.apply(this,arguments):this.animate(Zn(t,!0),r,i,s)}}),v.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Gt).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=v.isEmptyObject(e),s=v.speed(t,n,r),o=function(){var t=Kn(this,v.extend({},e),s);i&&t.stop(!0)};return i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=e!=null&&e+"queueHooks",s=v.timers,o=v._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Wn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&v.dequeue(this,e)})}}),v.each({slideDown:Zn("show"),slideUp:Zn("hide"),slideToggle:Zn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){v.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),v.speed=function(e,t,n){var r=e&&typeof e=="object"?v.extend({},e):{complete:n||!n&&t||v.isFunction(e)&&e,duration:e,easing:n&&t||t&&!v.isFunction(t)&&t};r.duration=v.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){v.isFunction(r.old)&&r.old.call(this),r.queue&&v.dequeue(this,r.queue)},r},v.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},v.timers=[],v.fx=Yn.prototype.init,v.fx.tick=function(){var e,n=v.timers,r=0;qn=v.now();for(;r<n.length;r++)e=n[r],!e()&&n[r]===e&&n.splice(r--,1);n.length||v.fx.stop(),qn=t},v.fx.timer=function(e){e()&&v.timers.push(e)&&!Rn&&(Rn=setInterval(v.fx.tick,v.fx.interval))},v.fx.interval=13,v.fx.stop=function(){clearInterval(Rn),Rn=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fx.step={},v.expr&&v.expr.filters&&(v.expr.filters.animated=function(e){return v.grep(v.timers,function(t){return e===t.elem}).length});var er=/^(?:body|html)$/i;v.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){v.offset.setOffset(this,e,t)});var n,r,i,s,o,u,a,f={top:0,left:0},l=this[0],c=l&&l.ownerDocument;if(!c)return;return(r=c.body)===l?v.offset.bodyOffset(l):(n=c.documentElement,v.contains(n,l)?(typeof l.getBoundingClientRect!="undefined"&&(f=l.getBoundingClientRect()),i=tr(c),s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,{top:f.top+u-s,left:f.left+a-o}):f)},v.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return v.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(v.css(e,"marginTop"))||0,n+=parseFloat(v.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=v.css(e,"position");r==="static"&&(e.style.position="relative");var i=v(e),s=i.offset(),o=v.css(e,"top"),u=v.css(e,"left"),a=(r==="absolute"||r==="fixed")&&v.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),v.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},v.fn.extend({position:function(){if(!this[0])return;var e=this[0],t=this.offsetParent(),n=this.offset(),r=er.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(v.css(e,"marginTop"))||0,n.left-=parseFloat(v.css(e,"marginLeft"))||0,r.top+=parseFloat(v.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(v.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.body;while(e&&!er.test(e.nodeName)&&v.css(e,"position")==="static")e=e.offsetParent;return e||i.body})}}),v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);v.fn[e]=function(i){return v.access(this,function(e,i,s){var o=tr(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?v(o).scrollLeft():s,r?s:v(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),v.each({Height:"height",Width:"width"},function(e,n){v.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){v.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!="boolean"),u=r||(i===!0||s===!0?"margin":"border");return v.access(this,function(n,r,i){var s;return v.isWindow(n)?n.document.documentElement["client"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?v.css(n,r,i,u):v.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=v,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return v})}(window),define("$",function(e){return function(){var t,n;return t||e.$}}(this)),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.3";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2);return x.map(e,function(e){return(x.isFunction(t)?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t){return x.isEmpty(t)?[]:x.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length===0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("_",function(e){return function(){var t,n;return t||e._}}(this)),define("modules/module",["require","qpf","knockout"],function(e){var t=e("qpf"),n=t.use("components/base"),r=e("knockout"),i=t.use("core/xmlparser"),s=t.use("core/mixin/derive"),o=t.use("core/mixin/event"),u=new Function;_.extend(u,s),_.extend(u.prototype,o);var a=u.derive(function(){return{name:"",$el:$("<div style='position:relative'></div>"),xml:"",context:{},mainComponent:null}},{start:function(){return this.xml&&this.applyXML(this.xml),this.trigger("start"),this.$el},enable:function(e){this.$el.show(),this.trigger("enable"),e&&e()},disable:function(e){this.$el.hide(),this.trigger("disable"),e&&e()},setContext:function(e){this._defaultContext||(this._defaultContext={},_.each(this.context,function(e,t){this._defaultContext[t]=e()},this));for(var t in this.context)typeof e[t]!="undefined"?this.context[t](e[t]):this.context[t](this._defaultContext[t]);n.prototype._mappingAttributes.call(this.context,e,!0)},dispose:function(){n.disposeByDom(this.$el[0]),this.$el.remove()},loadingStart:function(){this._$mask&&this._$mask.addClass("loading").show()},loadingEnd:function(){this._$mask&&this._$mask.removeClass("loading").hide()},applyXML:function(e){i.parse(e,this.$el[0]),r.applyBindings(this,this.$el[0]);var t=this.$el[0].firstChild;t&&(this.mainComponent=n.getByDom(t))}});return a}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.5",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);c.onXhr&&c.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText))},s.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!modules/filters/filters.xml",[],function(){return'<tab id="Filters" actived="1">\n    <panel title="Filters">\n    	<container>\n    		<textfield text="@binding[seachKeyword]" class="qpf-fitlers-search" placeholder="search"></textfield>\n    	</container>\n    	<list dataSource="@binding[filters]" itemView="@binding[FilterView]"/>\n    </panel>\n    <panel title="Adjustment" id="Adjustment">\n        <histogram id="Histogram" height="100"></histogram>\n        <container id="ColorAdjust">\n            <label>Brightness</label>\n            <range value="@binding[colorAdjust.brightness]" max="1.0" min="-1.0" step="0.01"></range>\n            <label>Contrast</label>\n            <range value="@binding[colorAdjust.contrast]" max="4.0" min="0.0" step="0.1"></range>\n            <label>Exposure</label>\n            <range value="@binding[colorAdjust.exposure]" max="10.0" min="-10.0" step="0.1"></range>\n            <label>Gamma</label>\n            <range value="@binding[colorAdjust.gamma]" max="3.0" min="0.0" step="0.1"></range>\n            <label>Saturation</label>\n            <range value="@binding[colorAdjust.saturation]" max="10.0" min="0.0" step="0.1"></range>\n        </container>\n    </panel>\n</tab>\n'}),define("text!modules/filters/filter.html",[],function(){return'<div class="qpf-filter-header" data-bind="click:use.bind($data)">\n    <div class="qpf-filter-preview">\n        <img data-bind="attr:{src:_previewSrc}" />\n    </div>\n    <div class="qpf-filter-title">\n        <h5 data-bind="html:title"></h5>\n    </div>\n</div>'}),define("text!modules/viewport/viewport.xml",[],function(){return'<container id="Viewport">\n	<viewport></viewport>\n    <nativehtml class="draghint">\n        <![CDATA[ <p>DRAG AND DROP THE IMAGE</p> ]]>\n    </nativehtml>\n</container>'}),define("modules/viewport/viewport",["require","qpf","knockout"],function(e){var t=e("qpf"),n=t.use("components/meta/meta"),r=e("knockout"),i=n.derive(function(){return{tag:"canvas"}},{type:"VIEWPORT",css:"viewport"});return n.provideBinding("viewport",i),i}),function(e){typeof define!="undefined"&&define.amd?define("emage",["exports"],e.bind(window)):e(window.image={})}(function(e){var t,n,r;(function(e){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(t){if(d(f,t)){var n=f[t];delete f[t],c[t]=!0,i.apply(e,n)}if(!d(a,t)&&!d(c,t))throw new Error("No "+t);return a[t]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(t,n,r,i){var s,l,h,p,v,g=[],w;i=i||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=o(n[v],i),l=p.f;if(l==="require")g[v]=u.require(t);else if(l==="exports")g[v]=u.exports(t),w=!0;else if(l==="module")s=g[v]=u.module(t);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=r.apply(a[t],g);if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!w)a[t]=h}else t&&(a[t]=r)},t=n=s=function(t,n,r,a,f){return typeof t=="string"?u[t]?u[t](n):b(o(t,n).f):(t.splice||(l=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},typeof r=="function"&&(r=a,a=f),a?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},r=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},r.amd={jQuery:!0}})(),r("build/almond",function(){}),function(e){typeof r!="undefined"&&r.amd?r("qtek",["exports"],e.bind(window)):e(window.qtek={})}(function(e){var t,n,r;(function(e){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(t){if(d(f,t)){var n=f[t];delete f[t],c[t]=!0,i.apply(e,n)}if(!d(a,t)&&!d(c,t))throw new Error("No "+t);return a[t]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(t,n,r,i){var s,l,h,p,v,g=[],w;i=i||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=o(n[v],i),l=p.f;if(l==="require")g[v]=u.require(t);else if(l==="exports")g[v]=u.exports(t),w=!0;else if(l==="module")s=g[v]=u.module(t);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=r.apply(a[t],g);if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!w)a[t]=h}else t&&(a[t]=r)},t=n=s=function(t,n,r,a,f){return typeof t=="string"?u[t]?u[t](n):b(o(t,n).f):(t.splice||(l=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},typeof r=="function"&&(r=a,a=f),a?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},r=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},r.amd={jQuery:!0}})(),r("../build/almond",function(){}),r("2d/camera",function(){}),r("core/mixin/derive",[],function(){function e(e,t,n){typeof t=="object"&&(n=t,t=null);var r={"instanceof":function(e){var t=s;while(t){if(t===e)return!0;t=t.__super__}}},i=this,s=function(n){i.call(this),_.extend(this,typeof e=="function"?e.call(this):e),_.extend(this,n);if(this.constructor==s){var r=s,o=[t];while(r.__super__)r=r.__super__,o.unshift(r.__initialize__);for(var u=0;u<o.length;u++)o[u]&&o[u].call(this)}};return s.__super__=i,s.__initialize__=t,_.extend(s.prototype,i.prototype,r,n),s.prototype.constructor=s,s.derive=i.derive,s}return{derive:e}}),r("core/mixin/notifier",[],function(){return{trigger:function(){if(!this.__handlers__)return;var e=arguments[0],t=Array.prototype.slice.call(arguments,1),n=this.__handlers__[e];if(n)for(var r=0;r<n.length;r+=2){var i=n[r],s=n[r+1];i.apply(s||this,t)}},on:function(e,t,n){if(!e)return;var r=this.__handlers__||(this.__handlers__={});return r[e]||(r[e]=[]),r[e].indexOf(t)==-1&&(r[e].push(t),r[e].push(n)),t},off:function(e,t){var n=this.__handlers__||(this.__handlers__={});if(n[e])if(t){var r=n[e],i=r.indexOf(t);i>=0&&r.splice(i,2)}else n[e]=[]},has:function(e,t){return!this.__handlers__||!this.__handlers__[e]?!1:t?this.__handlers__[e].indexOf(t)!==-1:this.__handlers__[e].length}}}),r("core/mixin/dirty",{dirty:function(e){this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[e]=!0},fresh:function(e){this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[e]=!1},isDirty:function(e){return this._dirtyFlag||(this._dirtyFlag={}),typeof this._dirtyFlag[e]=="undefined"?!0:this._dirtyFlag[e]}}),r("core/cache",[],function(){var e=function(){this._contextId="",this._caches={},this._context={}};return e.prototype={use:function(e,t){if(!this._caches.hasOwnProperty(e)){this._caches[e]={};if(t)for(var n in t)this._caches[e][n]=t[n]}this._contextId=e,this._context=this._caches[e]},put:function(e,t){this._context[e]=t},get:function(e){return this._context[e]},clearContext:function(){this._caches[this._contextId]={},this._context={}},"delete":function(e){delete this._context[e]},clearAll:function(){this._caches={}},getContext:function(){return this._context},miss:function(e){return!this._context.hasOwnProperty(e)}},e.prototype.constructor=e,e}),function(e){function P(n){function mt(e){return e&&typeof e=="object"&&!Bt(e)&&Z.call(e,"__wrapped__")?e:new Ot(e)}function St(e,t,n){var r=e.length,i=r-t>=n;if(i){var s={},o=t-1;while(++o<r){var u=U(e[o]);(Z.call(s,u)?s[u]:s[u]=[]).push(e[o])}}return function(n){if(i){var r=U(n);return Z.call(s,r)&&Vn(s[r],n)>-1}return Vn(e,n,t)>-1}}function xt(e){return e.charCodeAt(0)}function Tt(e,t){var n=e.index,r=t.index;e=e.criteria,t=t.criteria;if(e!==t){if(e>t||typeof e=="undefined")return 1;if(e<t||typeof t=="undefined")return-1}return n<r?-1:1}function Nt(e,t,n,r){function a(){var r=arguments,f=s?this:t;i||(e=t[o]),n.length&&(r=r.length?(r=Dt(r),u?r.concat(n):n.concat(r)):n);if(this instanceof a){Mt.prototype=e.prototype,f=new Mt,Mt.prototype=null;var l=e.apply(f,r);return on(l)?l:f}return e.apply(f,r)}var i=sn(e),s=!n,o=t;if(s){var u=r;n=t}else if(!i){if(!r)throw new z;t=e}return a}function Ct(){var e={shadowedProps:w,arrays:"isArray(iterable)",bottom:"",init:"iterable",loop:"",top:"",useHas:!0,useKeys:!!Ft};for(var t,n=0;t=arguments[n];n++)for(var r in t)e[r]=t[r];var i=e.args;e.firstArg=/^[^,]+/.exec(i)[0];var s=j("hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectTypes","return function("+i+") {\n"+yt(e)+"\n}");return s(Z,Ht,Bt,hn,Ft,mt,_)}function kt(e){return"\\"+D[e]}function Lt(e){return qt[e]}function At(e){return typeof e.toString!="function"&&typeof (e+"")=="string"}function Ot(e){this.__wrapped__=e}function Mt(){}function _t(e){var t=!1;if(!e||rt.call(e)!=L||!gt.argsClass&&Ht(e))return t;var n=e.constructor;return(sn(n)?n instanceof n:gt.nodeClass||!At(e))?gt.ownLast?($t(e,function(e,n,r){return t=Z.call(r,n),!1}),t===!0):($t(e,function(e,n){t=n}),t===!1||Z.call(e,t)):t}function Dt(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var i=-1,s=n-t||0,o=r(s<0?0:s);while(++i<s)o[i]=e[t+i];return o}function Pt(e){return Rt[e]}function Ht(e){return rt.call(e)==S}function zt(e,n,r,i,s,o){var u=e;typeof n=="function"&&(i=r,r=n,n=!1);if(typeof r=="function"){r=typeof i=="undefined"?r:mt.createCallback(r,i,1),u=r(u);if(typeof u!="undefined")return u;u=e}var a=on(u);if(a){var f=rt.call(u);if(!M[f]||!gt.nodeClass&&At(u))return u;var l=Bt(u)}if(!a||!n)return a?l?Dt(u):Ut({},u):u;var c=vt[f];switch(f){case T:case N:return new c(+u);case k:case O:return new c(u);case A:return c(u.source,p.exec(u))}s||(s=[]),o||(o=[]);var h=s.length;while(h--)if(s[h]==e)return o[h];return u=l?c(u.length):{},l&&(Z.call(e,"index")&&(u.index=e.index),Z.call(e,"input")&&(u.input=e.input)),s.push(e),o.push(u),(l?Nn:Jt)(e,function(e,i){u[i]=zt(e,n,r,t,s,o)}),u}function Wt(e,t,n){return zt(e,!0,t,n)}function Vt(e,t,n){var r;return t=mt.createCallback(t,n),Jt(e,function(e,n,i){if(t(e,n,i))return r=n,!1}),r}function Kt(e){var t=[];return $t(e,function(e,n){sn(e)&&t.push(n)}),t.sort()}function Qt(e,t){return e?Z.call(e,t):!1}function Gt(e){var t=-1,n=Ft(e),r=n.length,i={};while(++t<r){var s=n[t];i[e[s]]=s}return i}function Yt(e){return e===!0||e===!1||rt.call(e)==T}function Zt(e){return e instanceof B||rt.call(e)==N}function en(e){return e?e.nodeType===1:!1}function tn(e){var t=!0;if(!e)return t;var n=rt.call(e),r=e.length;return n==x||n==O||(gt.argsClass?n==S:Ht(e))||n==L&&typeof r=="number"&&sn(e.splice)?!r:(Jt(e,function(){return t=!1}),t)}function nn(e,t,n,r,i,s){var o=n===u;if(n&&!o){n=typeof r=="undefined"?n:mt.createCallback(n,r,2);var a=n(e,t);if(typeof a!="undefined")return!!a}if(e===t)return e!==0||1/e==1/t;var f=typeof e,l=typeof t;if(e===e&&(!e||f!="function"&&f!="object")&&(!t||l!="function"&&l!="object"))return!1;if(e==null||t==null)return e===t;var c=rt.call(e),h=rt.call(t);c==S&&(c=L),h==S&&(h=L);if(c!=h)return!1;switch(c){case T:case N:return+e==+t;case k:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case A:case O:return e==U(t)}var p=c==x;if(!p){if(Z.call(e,"__wrapped__ ")||Z.call(t,"__wrapped__"))return nn(e.__wrapped__||e,t.__wrapped__||t,n,r,i,s);if(c!=L||!gt.nodeClass&&(At(e)||At(t)))return!1;var d=!gt.argsObject&&Ht(e)?q:e.constructor,v=!gt.argsObject&&Ht(t)?q:t.constructor;if(d!=v&&!(sn(d)&&d instanceof d&&sn(v)&&v instanceof v))return!1}i||(i=[]),s||(s=[]);var m=i.length;while(m--)if(i[m]==e)return s[m]==t;var g=0;a=!0,i.push(e),s.push(t);if(p){m=e.length,g=t.length,a=g==e.length;if(!a&&!o)return a;while(g--){var y=m,b=t[g];if(o){while(y--)if(a=nn(e[y],b,n,r,i,s))break}else if(!(a=nn(e[g],b,n,r,i,s)))break}return a}return $t(t,function(t,o,u){if(Z.call(u,o))return g++,a=Z.call(e,o)&&nn(e[o],t,n,r,i,s)}),a&&!o&&$t(e,function(e,t,n){if(Z.call(n,t))return a=--g>-1}),a}function rn(e){return ot(e)&&!ut(parseFloat(e))}function sn(e){return typeof e=="function"}function on(e){return e?_[typeof e]:!1}function un(e){return fn(e)&&e!=+e}function an(e){return e===null}function fn(e){return typeof e=="number"||rt.call(e)==k}function cn(e){return e instanceof R||rt.call(e)==A}function hn(e){return typeof e=="string"||rt.call(e)==O}function pn(e){return typeof e=="undefined"}function dn(e,t,n){var r=arguments,i=0,s=2;if(!on(e))return e;if(n===u)var o=r[3],a=r[4],f=r[5];else a=[],f=[],typeof n!="number"&&(s=r.length),s>3&&typeof r[s-2]=="function"?o=mt.createCallback(r[--s-1],r[s--],2):s>2&&typeof r[s-1]=="function"&&(o=r[--s]);while(++i<s)(Bt(r[i])?Nn:Jt)(r[i],function(t,n){var r,i,s=t,l=e[n];if(t&&((i=Bt(t))||ln(t))){var c=a.length;while(c--)if(r=a[c]==t){l=f[c];break}r||(l=i?Bt(l)?l:[]:ln(l)?l:{},o&&(s=o(l,t),typeof s!="undefined"&&(l=s)),a.push(t),f.push(l),o||(l=dn(l,t,u,o,a,f)))}else o&&(s=o(l,t),typeof s=="undefined"&&(s=t)),typeof s!="undefined"&&(l=s);e[n]=l});return e}function vn(e,t,n){var r=typeof t=="function",i={};if(r)t=mt.createCallback(t,n);else var s=Q.apply(W,arguments);return $t(e,function(e,n,o){if(r?!t(e,n,o):Vn(s,n,1)<0)i[n]=e}),i}function mn(e){var t=-1,n=Ft(e),i=n.length,s=r(i);while(++t<i){var o=n[t];s[t]=[o,e[o]]}return s}function gn(e,t,n){var r={};if(typeof t!="function"){var i=0,s=Q.apply(W,arguments),o=on(e)?s.length:0;while(++i<o){var u=s[i];u in e&&(r[u]=e[u])}}else t=mt.createCallback(t,n),$t(e,function(e,n,i){t(e,n,i)&&(r[n]=e)});return r}function yn(e){var t=-1,n=Ft(e),i=n.length,s=r(i);while(++t<i)s[t]=e[n[t]];return s}function bn(e){var t=-1,n=Q.apply(W,Dt(arguments,1)),i=n.length,s=r(i);gt.unindexedChars&&hn(e)&&(e=e.split(""));while(++t<i)s[t]=e[n[t]];return s}function wn(e,t,n){var r=-1,i=e?e.length:0,s=!1;return n=(n<0?ft(0,i+n):n)||0,typeof i=="number"?s=(hn(e)?e.indexOf(t,n):Vn(e,t,n))>-1:It(e,function(e){if(++r>=n)return!(s=e===t)}),s}function En(e,t,n){var r={};return t=mt.createCallback(t,n),Nn(e,function(e,n,i){n=U(t(e,n,i)),Z.call(r,n)?r[n]++:r[n]=1}),r}function Sn(e,t,n){var r=!0;t=mt.createCallback(t,n);if(Bt(e)){var i=-1,s=e.length;while(++i<s)if(!(r=!!t(e[i],i,e)))break}else It(e,function(e,n,i){return r=!!t(e,n,i)});return r}function xn(e,t,n){var r=[];t=mt.createCallback(t,n);if(Bt(e)){var i=-1,s=e.length;while(++i<s){var o=e[i];t(o,i,e)&&r.push(o)}}else It(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function Tn(e,t,n){t=mt.createCallback(t,n);if(!Bt(e)){var o;return It(e,function(e,n,r){if(t(e,n,r))return o=e,!1}),o}var r=-1,i=e.length;while(++r<i){var s=e[r];if(t(s,r,e))return s}}function Nn(e,t,n){if(t&&typeof n=="undefined"&&Bt(e)){var r=-1,i=e.length;while(++r<i)if(t(e[r],r,e)===!1)break}else It(e,t,n);return e}function Cn(e,t,n){var r={};return t=mt.createCallback(t,n),Nn(e,function(e,n,i){n=U(t(e,n,i)),(Z.call(r,n)?r[n]:r[n]=[]).push(e)}),r}function kn(e,t){var n=Dt(arguments,2),i=-1,s=typeof t=="function",o=e?e.length:0,u=r(typeof o=="number"?o:0);return Nn(e,function(e){u[++i]=(s?t:e[t]).apply(e,n)}),u}function Ln(e,t,n){var i=-1,s=e?e.length:0,o=r(typeof s=="number"?s:0);t=mt.createCallback(t,n);if(Bt(e))while(++i<s)o[i]=t(e[i],i,e);else It(e,function(e,n,r){o[++i]=t(e,n,r)});return o}function An(e,t,n){var r=-Infinity,i=r;if(!t&&Bt(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];u>i&&(i=u)}}else t=!t&&hn(e)?xt:mt.createCallback(t,n),It(e,function(e,n,s){var o=t(e,n,s);o>r&&(r=o,i=e)});return i}function On(e,t,n){var r=Infinity,i=r;if(!t&&Bt(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];u<i&&(i=u)}}else t=!t&&hn(e)?xt:mt.createCallback(t,n),It(e,function(e,n,s){var o=t(e,n,s);o<r&&(r=o,i=e)});return i}function _n(e,t,n,r){var i=arguments.length<3;t=mt.createCallback(t,r,4);if(Bt(e)){var s=-1,o=e.length;i&&(n=e[++s]);while(++s<o)n=t(n,e[s],s,e)}else It(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)});return n}function Dn(e,t,n,r){var i=e,s=e?e.length:0,o=arguments.length<3;if(typeof s!="number"){var u=Ft(e);s=u.length}else gt.unindexedChars&&hn(e)&&(i=e.split(""));return t=mt.createCallback(t,r,4),Nn(e,function(e,r,a){r=u?u[--s]:--s,n=o?(o=!1,i[r]):t(n,i[r],r,a)}),n}function Pn(e,t,n){return t=mt.createCallback(t,n),xn(e,function(e,n,r){return!t(e,n,r)})}function Hn(e){var t=-1,n=e?e.length:0,i=r(typeof n=="number"?n:0);return Nn(e,function(e){var n=G(ht()*(++t+1));i[t]=i[n],i[n]=e}),i}function Bn(e){var t=e?e.length:0;return typeof t=="number"?t:Ft(e).length}function jn(e,t,n){var r;t=mt.createCallback(t,n);if(Bt(e)){var i=-1,s=e.length;while(++i<s)if(r=t(e[i],i,e))break}else It(e,function(e,n,i){return!(r=t(e,n,i))});return!!r}function Fn(e,t,n){var i=-1,s=e?e.length:0,o=r(typeof s=="number"?s:0);t=mt.createCallback(t,n),Nn(e,function(e,n,r){o[++i]={criteria:t(e,n,r),index:i,value:e}}),s=o.length,o.sort(Tt);while(s--)o[s]=o[s].value;return o}function In(e){return e&&typeof e.length=="number"?gt.unindexedChars&&hn(e)?e.split(""):Dt(e):yn(e)}function Rn(e){var t=-1,n=e?e.length:0,r=[];while(++t<n){var i=e[t];i&&r.push(i)}return r}function Un(e){var t=-1,n=e?e.length:0,r=Q.apply(W,arguments),i=St(r,n,100),s=[];while(++t<n){var o=e[t];i(o)||s.push(o)}return s}function zn(e,t,n){var r=-1,i=e?e.length:0;t=mt.createCallback(t,n);while(++r<i)if(t(e[r],r,e))return r;return-1}function Wn(e,t,n){if(e){var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=-1;t=mt.createCallback(t,n);while(++s<i&&t(e[s],s,e))r++}else{r=t;if(r==null||n)return e[0]}return Dt(e,0,lt(ft(0,r),i))}}function Xn(e,t,n,r){var i=-1,s=e?e.length:0,o=[];typeof t!="boolean"&&t!=null&&(r=n,n=t,t=!1),n!=null&&(n=mt.createCallback(n,r));while(++i<s){var u=e[i];n&&(u=n(u,i,e)),Bt(u)?et.apply(o,t?u:Xn(u)):o.push(u)}return o}function Vn(e,t,n){var r=-1,i=e?e.length:0;if(typeof n=="number")r=(n<0?ft(0,i+n):n||0)-1;else if(n)return r=Zn(e,t),e[r]===t?r:-1;while(++r<i)if(e[r]===t)return r;return-1}function $n(e,t,n){if(!e)return[];var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=i;t=mt.createCallback(t,n);while(s--&&t(e[s],s,e))r++}else r=t==null||n?1:t||r;return Dt(e,0,lt(ft(0,i-r),i))}function Jn(e){var t=arguments,n=t.length,r={0:{}},i=-1,s=e?e.length:0,o=s>=100,u=[],a=u;e:while(++i<s){var f=e[i];if(o)var l=U(f),c=Z.call(r[0],l)?!(a=r[0][l]):a=r[0][l]=[];if(c||Vn(a,f)<0){o&&a.push(f);var h=n;while(--h)if(!(r[h]||(r[h]=St(t[h],0,100)))(f))continue e;u.push(f)}}return u}function Kn(e,t,n){if(e){var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=i;t=mt.createCallback(t,n);while(s--&&t(e[s],s,e))r++}else{r=t;if(r==null||n)return e[i-1]}return Dt(e,ft(0,i-r))}}function Qn(e,t,n){var r=e?e.length:0;typeof n=="number"&&(r=(n<0?ft(0,r+n):lt(n,r-1))+1);while(r--)if(e[r]===t)return r;return-1}function Gn(e,t,n){e=+e||0,n=+n||1,t==null&&(t=e,e=0);var i=-1,s=ft(0,J((t-e)/n)),o=r(s);while(++i<s)o[i]=e,e+=n;return o}function Yn(e,t,n){if(typeof t!="number"&&t!=null){var r=0,i=-1,s=e?e.length:0;t=mt.createCallback(t,n);while(++i<s&&t(e[i],i,e))r++}else r=t==null||n?1:ft(0,t);return Dt(e,r)}function Zn(e,t,n,r){var i=0,s=e?e.length:i;n=n?mt.createCallback(n,r,1):Er,t=n(t);while(i<s){var o=i+s>>>1;n(e[o])<t?i=o+1:s=o}return i}function er(){return tr(Q.apply(W,arguments))}function tr(e,t,n,r){var i=-1,s=e?e.length:0,o=[],u=o;typeof t!="boolean"&&t!=null&&(r=n,n=t,t=!1);var a=!t&&s>=75;if(a)var f={};n!=null&&(u=[],n=mt.createCallback(n,r));while(++i<s){var l=e[i],c=n?n(l,i,e):l;if(a)var h=U(c),p=Z.call(f,h)?!(u=f[h]):u=f[h]=[];if(t?!i||u[u.length-1]!==c:p||Vn(u,c)<0)(n||a)&&u.push(c),o.push(l)}return o}function nr(e){var t=-1,n=e?e.length:0,r=St(arguments,1,30),i=[];while(++t<n){var s=e[t];r(s)||i.push(s)}return i}function rr(e){var t=-1,n=e?An(Mn(arguments,"length")):0,i=r(n);while(++t<n)i[t]=Mn(arguments,t);return i}function ir(e,t){var n=-1,r=e?e.length:0,i={};while(++n<r){var s=e[n];t?i[s]=t[n]:i[s[0]]=s[1]}return i}function sr(e,t){return e<1?t():function(){if(--e<1)return t.apply(this,arguments)}}function or(e,t){return gt.fastBind||it&&arguments.length>2?it.call.apply(it,arguments):Nt(e,t,Dt(arguments,2))}function ur(e){var t=Q.apply(W,arguments),n=t.length>1?0:(t=Kt(e),-1),r=t.length;while(++n<r){var i=t[n];e[i]=or(e[i],e)}return e}function ar(e,t){return Nt(e,t,Dt(arguments,2),u)}function fr(){var e=arguments;return function(){var t=arguments,n=e.length;while(n--)t=[e[n].apply(this,t)];return t[0]}}function lr(e,t,n){if(e==null)return Er;var r=typeof e;if(r!="function"){if(r!="object")return function(t){return t[e]};var i=Ft(e);return function(t){var n=i.length,r=!1;while(n--)if(!(r=nn(t[i[n]],e[i[n]],u)))break;return r}}return typeof t!="undefined"?n===1?function(n){return e.call(t,n)}:n===2?function(n,r){return e.call(t,n,r)}:n===4?function(n,r,i,s){return e.call(t,n,r,i,s)}:function(n,r,i){return e.call(t,n,r,i)}:e}function cr(e,t,n){function u(){o=null,n||(i=e.apply(s,r))}var r,i,s,o;return function(){var a=n&&!o;return r=arguments,s=this,K(o),o=nt(u,t),a&&(i=e.apply(s,r)),i}}function hr(e){var n=Dt(arguments,1);return nt(function(){e.apply(t,n)},1)}function pr(e,n){var r=Dt(arguments,2);return nt(function(){e.apply(t,r)},n)}function dr(e,t){var n={};return function(){var r=U(t?t.apply(this,arguments):arguments[0]);return Z.call(n,r)?n[r]:n[r]=e.apply(this,arguments)}}function vr(e){var t,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function mr(e){return Nt(e,Dt(arguments,1))}function gr(e){return Nt(e,Dt(arguments,1),null,u)}function yr(e,t){function u(){o=new B,s=null,r=e.apply(i,n)}var n,r,i,s,o=0;return function(){var a=new B,f=t-(a-o);return n=arguments,i=this,f<=0?(K(s),s=null,o=a,r=e.apply(i,n)):s||(s=nt(u,f)),r}}function br(e,t){return function(){var n=[e];return et.apply(n,arguments),t.apply(this,n)}}function wr(e){return e==null?"":U(e).replace(g,Lt)}function Er(e){return e}function Sr(e){Nn(Kt(e),function(t){var n=mt[t]=e[t];mt.prototype[t]=function(){var e=this.__wrapped__,t=[e];et.apply(t,arguments);var r=n.apply(mt,t);return e&&typeof e=="object"&&e==r?this:new Ot(r)}})}function xr(){return n._=V,this}function Nr(e,t){return e==null&&t==null&&(t=1),e=+e||0,t==null&&(t=e,e=0),e+G(ht()*((+t||0)-e+1))}function Cr(e,n){var r=e?e[n]:t;return sn(r)?e[n]():r}function kr(e,n,r){var i=mt.templateSettings;e||(e=""),r=Xt({},r,i);var s=Xt({},r.imports,i.imports),o=Ft(s),u=yn(s),c,p=0,v=r.interpolate||m,g="__p += '",b=R((r.escape||m).source+"|"+v.source+"|"+(v===d?h:m).source+"|"+(r.evaluate||m).source+"|$","g");e.replace(b,function(t,n,r,i,s,o){return r||(r=i),g+=e.slice(p,o).replace(y,kt),n&&(g+="' +\n__e("+n+") +\n'"),s&&(c=!0,g+="';\n"+s+";\n__p += '"),r&&(g+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),p=o+t.length,t}),g+="';\n";var w=r.variable,S=w;S||(w="obj",g="with ("+w+") {\n"+g+"\n}\n"),g=(c?g.replace(a,""):g).replace(f,"$1").replace(l,"$1;"),g="function("+w+") {\n"+(S?"":w+" || ("+w+" = {});\n")+"var __t, __p = '', __e = _.escape"+(c?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+g+"return __p\n}";var x="\n/*\n//@ sourceURL="+(r.sourceURL||"/lodash/template/source["+E++ +"]")+"\n*/";try{var T=j(o,"return "+g+x).apply(t,u)}catch(N){throw N.source=g,N}return n?T(n):(T.source=g,T)}function Lr(e,t,n){e=(e=+e)>-1?e:0;var i=-1,s=r(e);t=mt.createCallback(t,n,1);while(++i<e)s[i]=t(i);return s}function Ar(e){return e==null?"":U(e).replace(c,Pt)}function Or(e){var t=++o;return U(e==null?"":e)+t}function Mr(e,t){return t(e),e}function _r(){return U(this.__wrapped__)}function Dr(){return this.__wrapped__}n=n?H.defaults(e.Object(),n,H.pick(e,b)):e;var r=n.Array,s=n.Boolean,B=n.Date,j=n.Function,F=n.Math,I=n.Number,q=n.Object,R=n.RegExp,U=n.String,z=n.TypeError,W=r(),X=q(),V=n._,$=R("^"+U(X.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),J=F.ceil,K=n.clearTimeout,Q=W.concat,G=F.floor,Y=$.test(Y=q.getPrototypeOf)&&Y,Z=X.hasOwnProperty,et=W.push,tt=n.setImmediate,nt=n.setTimeout,rt=X.toString,it=$.test(it=Dt.bind)&&it,st=$.test(st=r.isArray)&&st,ot=n.isFinite,ut=n.isNaN,at=$.test(at=q.keys)&&at,ft=F.max,lt=F.min,ct=n.parseInt,ht=F.random,pt=$.test(n.attachEvent),dt=it&&!/\n|true/.test(it+pt),vt={};vt[x]=r,vt[T]=s,vt[N]=B,vt[L]=q,vt[k]=I,vt[A]=R,vt[O]=U;var gt=mt.support={};(function(){var e=function(){this.x=1},t={0:1,length:1},n=[];e.prototype={valueOf:1,y:1};for(var r in new e)n.push(r);for(r in arguments);gt.argsObject=arguments.constructor==q,gt.argsClass=Ht(arguments),gt.enumPrototypes=e.propertyIsEnumerable("prototype"),gt.fastBind=it&&!dt,gt.ownLast=n[0]!="x",gt.nonEnumArgs=r!=0,gt.nonEnumShadows=!/valueOf/.test(n),gt.spliceObjects=(W.splice.call(t,0,1),!t[0]),gt.unindexedChars="x"[0]+q("x")[0]!="xx";try{gt.nodeClass=rt.call(document)!=L||!!({toString:0}+"")}catch(i){gt.nodeClass=!0}})(1),mt.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:d,variable:"",imports:{_:mt}};var yt=function(e){var t="var index, iterable = "+e.firstArg+", result = "+e.init+";\nif (!iterable) return result;\n"+e.top+";\n";e.arrays?(t+="var length = iterable.length; index = -1;\nif ("+e.arrays+") {  ",gt.unindexedChars&&(t+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),t+="\n  while (++index < length) {\n    "+e.loop+"\n  }\n}\nelse {  "):gt.nonEnumArgs&&(t+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+e.loop+"\n    }\n  } else {  "),gt.enumPrototypes&&(t+="\n  var skipProto = typeof iterable == 'function';\n  ");if(e.useHas&&e.useKeys)t+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? keys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    ",gt.enumPrototypes&&(t+="if (!(skipProto && index == 'prototype')) {\n  "),t+=e.loop,gt.enumPrototypes&&(t+="}\n"),t+="  }  ";else{t+="\n  for (index in iterable) {";if(gt.enumPrototypes||e.useHas)t+="\n    if (",gt.enumPrototypes&&(t+="!(skipProto && index == 'prototype')"),gt.enumPrototypes&&e.useHas&&(t+=" && "),e.useHas&&(t+="hasOwnProperty.call(iterable, index)"),t+=") {    ";t+=e.loop+";    ";if(gt.enumPrototypes||e.useHas)t+="\n    }";t+="\n  }    ";if(gt.nonEnumShadows){t+="\n\n  var ctor = iterable.constructor;\n      ";for(var n=0;n<7;n++)t+="\n  index = '"+e.shadowedProps[n]+"';\n  if (",e.shadowedProps[n]=="constructor"&&(t+="!(ctor && ctor.prototype === iterable) && "),t+="hasOwnProperty.call(iterable, index)) {\n    "+e.loop+"\n  }      "}}if(e.arrays||gt.nonEnumArgs)t+="\n}";return t+=e.bottom+";\nreturn result",t},bt={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},wt={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",arrays:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Et={top:"if (!objectTypes[typeof iterable]) return result;\n"+wt.top,arrays:!1};Ot.prototype=mt.prototype,gt.argsClass||(Ht=function(e){return e?Z.call(e,"callee"):!1});var Bt=st||function(e){return gt.argsObject&&e instanceof r||rt.call(e)==x},jt=Ct({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)",arrays:!1}),Ft=at?function(e){return on(e)?gt.enumPrototypes&&typeof e=="function"||gt.nonEnumArgs&&e.length&&Ht(e)?jt(e):at(e):[]}:jt,It=Ct(wt),qt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Rt=Gt(qt),Ut=Ct(bt,{top:bt.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Xt=Ct(bt),$t=Ct(wt,Et,{useHas:!1}),Jt=Ct(wt,Et);sn(/x/)&&(sn=function(e){return e instanceof j||rt.call(e)==C});var ln=Y?function(e){if(!e||rt.call(e)!=L||!gt.argsClass&&Ht(e))return!1;var t=e.valueOf,n=typeof t=="function"&&(n=Y(t))&&Y(n);return n?e==n||Y(e)==n:_t(e)}:_t,Mn=Ln,qn=xn;dt&&i&&typeof tt=="function"&&(hr=or(tt,n));var Tr=ct("08")==8?ct:function(e,t){return ct(hn(e)?e.replace(v,""):e,t||0)};return mt.after=sr,mt.assign=Ut,mt.at=bn,mt.bind=or,mt.bindAll=ur,mt.bindKey=ar,mt.compact=Rn,mt.compose=fr,mt.countBy=En,mt.createCallback=lr,mt.debounce=cr,mt.defaults=Xt,mt.defer=hr,mt.delay=pr,mt.difference=Un,mt.filter=xn,mt.flatten=Xn,mt.forEach=Nn,mt.forIn=$t,mt.forOwn=Jt,mt.functions=Kt,mt.groupBy=Cn,mt.initial=$n,mt.intersection=Jn,mt.invert=Gt,mt.invoke=kn,mt.keys=Ft,mt.map=Ln,mt.max=An,mt.memoize=dr,mt.merge=dn,mt.min=On,mt.omit=vn,mt.once=vr,mt.pairs=mn,mt.partial=mr,mt.partialRight=gr,mt.pick=gn,mt.pluck=Mn,mt.range=Gn,mt.reject=Pn,mt.rest=Yn,mt.shuffle=Hn,mt.sortBy=Fn,mt.tap=Mr,mt.throttle=yr,mt.times=Lr,mt.toArray=In,mt.union=er,mt.uniq=tr,mt.values=yn,mt.where=qn,mt.without=nr,mt.wrap=br,mt.zip=rr,mt.zipObject=ir,mt.collect=Ln,mt.drop=Yn,mt.each=Nn,mt.extend=Ut,mt.methods=Kt,mt.object=ir,mt.select=xn,mt.tail=Yn,mt.unique=tr,Sr(mt),mt.clone=zt,mt.cloneDeep=Wt,mt.contains=wn,mt.escape=wr,mt.every=Sn,mt.find=Tn,mt.findIndex=zn,mt.findKey=Vt,mt.has=Qt,mt.identity=Er,mt.indexOf=Vn,mt.isArguments=Ht,mt.isArray=Bt,mt.isBoolean=Yt,mt.isDate=Zt,mt.isElement=en,mt.isEmpty=tn,mt.isEqual=nn,mt.isFinite=rn,mt.isFunction=sn,mt.isNaN=un,mt.isNull=an,mt.isNumber=fn,mt.isObject=on,mt.isPlainObject=ln,mt.isRegExp=cn,mt.isString=hn,mt.isUndefined=pn,mt.lastIndexOf=Qn,mt.mixin=Sr,mt.noConflict=xr,mt.parseInt=Tr,mt.random=Nr,mt.reduce=_n,mt.reduceRight=Dn,mt.result=Cr,mt.runInContext=P,mt.size=Bn,mt.some=jn,mt.sortedIndex=Zn,mt.template=kr,mt.unescape=Ar,mt.uniqueId=Or,mt.all=Sn,mt.any=jn,mt.detect=Tn,mt.foldl=_n,mt.foldr=Dn,mt.include=wn,mt.inject=_n,Jt(mt,function(e,t){mt.prototype[t]||(mt.prototype[t]=function(){var t=[this.__wrapped__];return et.apply(t,arguments),e.apply(mt,t)})}),mt.first=Wn,mt.last=Kn,mt.take=Wn,mt.head=Wn,Jt(mt,function(e,t){mt.prototype[t]||(mt.prototype[t]=function(t,n){var r=e(this.__wrapped__,t,n);return t==null||n&&typeof t!="function"?r:new Ot(r)})}),mt.VERSION="1.1.1",mt.prototype.toString=_r,mt.prototype.value=Dr,mt.prototype.valueOf=Dr,It(["join","pop","shift"],function(e){var t=W[e];mt.prototype[e]=function(){return t.apply(this.__wrapped__,arguments)}}),It(["push","reverse","sort","unshift"],function(e){var t=W[e];mt.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),It(["concat","slice","splice"],function(e){var t=W[e];mt.prototype[e]=function(){return new Ot(t.apply(this.__wrapped__,arguments))}}),gt.spliceObjects||It(["pop","shift","splice"],function(e){var t=W[e],n=e=="splice";mt.prototype[e]=function(){var e=this.__wrapped__,r=t.apply(e,arguments);return e.length===0&&delete e[0],n?new Ot(r):r}}),mt}var t,n=typeof exports=="object"&&exports,i=typeof module=="object"&&module&&module.exports==n&&module,s=typeof global=="object"&&global;s.global===s&&(e=s);var o=0,u={},a=/\b__p \+= '';/g,f=/\b(__p \+=) '' \+/g,l=/(__e\(.*?\)|\b__t\)) \+\n'';/g,c=/&(?:amp|lt|gt|quot|#39);/g,h=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,p=/\w*$/,d=/<%=([\s\S]+?)%>/g,v=/^0+(?=.$)/,m=/($^)/,g=/[&<>"']/g,y=/['\n\r\t\u2028\u2029\\]/g,b=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],w=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],E=0,S="[object Arguments]",x="[object Array]",T="[object Boolean]",N="[object Date]",C="[object Function]",k="[object Number]",L="[object Object]",A="[object RegExp]",O="[object String]",M={};M[C]=!1,M[S]=M[x]=M[T]=M[N]=M[k]=M[L]=M[A]=M[O]=!0;var _={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},D={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},H=P();typeof r=="function"&&typeof r.amd=="object"&&r.amd?(e._=H,r("_",[],function(){return H})):n&&!n.nodeType?i?(i.exports=H)._=H:n._=H:e._=H}(this),r("core/base",["require","./mixin/derive","./mixin/notifier","./mixin/dirty","./cache","_"],function(e){var t=e("./mixin/derive"),n=e("./mixin/notifier"),r=e("./mixin/dirty"),i=e("./cache"),s=e("_"),o=function(){this.cache=new i};return s.extend(o,t),s.extend(o.prototype,n),s.extend(o.prototype,r),o}),function(e){var t={};typeof exports=="undefined"?typeof r=="function"&&typeof r.amd=="object"&&r.amd?(t.exports={},r("glmatrix",[],function(){return t.exports})):t.exports=typeof window!="undefined"?window:e:t.exports=exports,function(e){if(!t)var t=1e-6;if(!n)var n=typeof Float32Array!="undefined"?Float32Array:Array;if(!r)var r=Math.random;var i={};i.setMatrixArrayType=function(e){n=e},typeof e!="undefined"&&(e.glMatrix=i);var s={};s.create=function(){var e=new n(2);return e[0]=0,e[1]=0,e},s.clone=function(e){var t=new n(2);return t[0]=e[0],t[1]=e[1],t},s.fromValues=function(e,t){var r=new n(2);return r[0]=e,r[1]=t,r},s.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},s.set=function(e,t,n){return e[0]=t,e[1]=n,e},s.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},s.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},s.sub=s.subtract,s.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},s.mul=s.multiply,s.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},s.div=s.divide,s.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},s.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},s.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},s.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},s.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},s.dist=s.distance,s.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},s.sqrDist=s.squaredDistance,s.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},s.len=s.length,s.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},s.sqrLen=s.squaredLength,s.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},s.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},s.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},s.lerp=function(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e},s.random=function(e,t){t=t||1;var n=r()*2*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},s.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},s.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},s.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},s.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},s.forEach=function(){var e=s.create();return function(t,n,r,i,s,o){var u,a;n||(n=2),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],s(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}(),s.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},typeof e!="undefined"&&(e.vec2=s);var o={};o.create=function(){var e=new n(3);return e[0]=0,e[1]=0,e[2]=0,e},o.clone=function(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.fromValues=function(e,t,r){var i=new n(3);return i[0]=e,i[1]=t,i[2]=r,i},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},o.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},o.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},o.sub=o.subtract,o.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},o.mul=o.multiply,o.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},o.div=o.divide,o.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},o.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},o.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},o.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},o.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},o.dist=o.distance,o.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},o.len=o.length,o.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},o.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},o.cross=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2];return e[0]=i*a-s*u,e[1]=s*o-r*a,e[2]=r*u-i*o,e},o.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e},o.random=function(e,t){t=t||1;var n=r()*2*Math.PI,i=r()*2-1,s=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*s,e[1]=Math.sin(n)*s,e[2]=i*t,e},o.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12],e[1]=n[1]*r+n[5]*i+n[9]*s+n[13],e[2]=n[2]*r+n[6]*i+n[10]*s+n[14],e},o.transformMat3=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=r*n[0]+i*n[3]+s*n[6],e[1]=r*n[1]+i*n[4]+s*n[7],e[2]=r*n[2]+i*n[5]+s*n[8],e},o.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},o.forEach=function(){var e=o.create();return function(t,n,r,i,s,o){var u,a;n||(n=3),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}(),o.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},typeof e!="undefined"&&(e.vec3=o);var u={};u.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},u.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},u.fromValues=function(e,t,r,i){var s=new n(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},u.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},u.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},u.sub=u.subtract,u.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},u.mul=u.multiply,u.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},u.div=u.divide,u.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},u.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},u.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},u.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},u.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+s*s)},u.dist=u.distance,u.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return n*n+r*r+i*i+s*s},u.sqrDist=u.squaredDistance,u.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},u.len=u.length,u.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},u.sqrLen=u.squaredLength,u.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},u.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o),e},u.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},u.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e[3]=u+r*(n[3]-u),e},u.random=function(e,t){return t=t||1,e[0]=r(),e[1]=r(),e[2]=r(),e[3]=r(),u.normalize(e,e),u.scale(e,e,t),e},u.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,e},u.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},u.forEach=function(){var e=u.create();return function(t,n,r,i,s,o){var u,a;n||(n=4),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),u.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.vec4=u);var a={};a.create=function(){var e=new n(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},a.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*s-i*r;return o?(o=1/o,e[0]=s*o,e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null},a.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},a.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},a.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*u+i*f,e[1]=r*a+i*l,e[2]=s*u+o*f,e[3]=s*a+o*l,e},a.mul=a.multiply,a.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=r*-u+i*a,e[2]=s*a+o*u,e[3]=s*-u+o*a,e},a.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1];return e[0]=r*u,e[1]=i*a,e[2]=s*u,e[3]=o*a,e},a.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.mat2=a);var f={};f.create=function(){var e=new n(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},f.clone=function(e){var t=new n(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},f.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},f.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},f.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=n*s-r*i;return a?(a=1/a,e[0]=s*a,e[1]=-r*a,e[2]=-i*a,e[3]=n*a,e[4]=(i*u-s*o)*a,e[5]=(r*o-n*u)*a,e):null},f.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},f.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1],c=n[2],h=n[3],p=n[4],d=n[5];return e[0]=r*f+i*c,e[1]=r*l+i*h,e[2]=s*f+o*c,e[3]=s*l+o*h,e[4]=f*u+c*a+p,e[5]=l*u+h*a+d,e},f.mul=f.multiply,f.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*f,e[1]=-r*f+i*l,e[2]=s*l+o*f,e[3]=-s*f+l*o,e[4]=l*u+f*a,e[5]=l*a-f*u,e},f.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=t[0]*r,e[1]=t[1]*i,e[2]=t[2]*r,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*i,e},f.translate=function(e,t,n){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+n[0],e[5]=t[5]+n[1],e},f.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},typeof e!="undefined"&&(e.mat2d=f);var l={};l.create=function(){var e=new n(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},l.clone=function(e){var t=new n(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},l.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},l.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p;return d?(d=1/d,e[0]=c*d,e[1]=(-l*r+i*f)*d,e[2]=(u*r-i*o)*d,e[3]=h*d,e[4]=(l*n-i*a)*d,e[5]=(-u*n+i*s)*d,e[6]=p*d,e[7]=(-f*n+r*a)*d,e[8]=(o*n-r*s)*d,e):null},l.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8];return e[0]=o*l-u*f,e[1]=i*f-r*l,e[2]=r*u-i*o,e[3]=u*a-s*l,e[4]=n*l-i*a,e[5]=i*s-n*u,e[6]=s*f-o*a,e[7]=r*a-n*f,e[8]=n*o-r*s,e},l.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*(f*s-o*a)+n*(-f*i+o*u)+r*(a*i-s*u)},l.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return e[0]=h*r+p*o+d*f,e[1]=h*i+p*u+d*l,e[2]=h*s+p*a+d*c,e[3]=v*r+m*o+g*f,e[4]=v*i+m*u+g*l,e[5]=v*s+m*a+g*c,e[6]=y*r+b*o+w*f,e[7]=y*i+b*u+w*l,e[8]=y*s+b*a+w*c,e},l.mul=l.multiply,l.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=u,e[5]=a,e[6]=h*r+p*o+f,e[7]=h*i+p*u+l,e[8]=h*s+p*a+c,e},l.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=Math.sin(n),p=Math.cos(n);return e[0]=p*r+h*o,e[1]=p*i+h*u,e[2]=p*s+h*a,e[3]=p*o-h*r,e[4]=p*u-h*i,e[5]=p*a-h*s,e[6]=f,e[7]=l,e[8]=c,e},l.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},l.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},l.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-(h+d),e[3]=l+g,e[6]=c-m,e[1]=l-g,e[4]=1-(f+d),e[7]=p+v,e[2]=c+m,e[5]=p-v,e[8]=1-(f+h),e},l.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(a*C-o*A-f*N)*O,e[2]=(o*L-u*C+f*T)*O,e[3]=(i*L-r*A-s*k)*O,e[4]=(n*A-i*C+s*N)*O,e[5]=(r*C-n*L-s*T)*O,e[6]=(v*x-m*S+g*E)*O,e[7]=(m*w-d*x-g*b)*O,e[8]=(d*S-v*w+g*y)*O,e):null},l.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},typeof e!="undefined"&&(e.mat3=l);var c={};c.create=function(){var e=new n(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.clone=function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=i,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},c.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(i*L-r*A-s*k)*O,e[2]=(v*x-m*S+g*E)*O,e[3]=(h*S-c*x-p*E)*O,e[4]=(a*C-o*A-f*N)*O,e[5]=(n*A-i*C+s*N)*O,e[6]=(m*w-d*x-g*b)*O,e[7]=(l*x-h*w+p*b)*O,e[8]=(o*L-u*C+f*T)*O,e[9]=(r*C-n*L-s*T)*O,e[10]=(d*S-v*w+g*y)*O,e[11]=(c*w-l*S-p*y)*O,e[12]=(u*N-o*k-a*T)*O,e[13]=(n*k-r*N+i*T)*O,e[14]=(v*b-d*E-m*y)*O,e[15]=(l*E-c*b+h*y)*O,e):null},c.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15];return e[0]=u*(h*g-p*m)-c*(a*g-f*m)+v*(a*p-f*h),e[1]=-(r*(h*g-p*m)-c*(i*g-s*m)+v*(i*p-s*h)),e[2]=r*(a*g-f*m)-u*(i*g-s*m)+v*(i*f-s*a),e[3]=-(r*(a*p-f*h)-u*(i*p-s*h)+c*(i*f-s*a)),e[4]=-(o*(h*g-p*m)-l*(a*g-f*m)+d*(a*p-f*h)),e[5]=n*(h*g-p*m)-l*(i*g-s*m)+d*(i*p-s*h),e[6]=-(n*(a*g-f*m)-o*(i*g-s*m)+d*(i*f-s*a)),e[7]=n*(a*p-f*h)-o*(i*p-s*h)+l*(i*f-s*a),e[8]=o*(c*g-p*v)-l*(u*g-f*v)+d*(u*p-f*c),e[9]=-(n*(c*g-p*v)-l*(r*g-s*v)+d*(r*p-s*c)),e[10]=n*(u*g-f*v)-o*(r*g-s*v)+d*(r*f-s*u),e[11]=-(n*(u*p-f*c)-o*(r*p-s*c)+l*(r*f-s*u)),e[12]=-(o*(c*m-h*v)-l*(u*m-a*v)+d*(u*h-a*c)),e[13]=n*(c*m-h*v)-l*(r*m-i*v)+d*(r*h-i*c),e[14]=-(n*(u*m-a*v)-o*(r*m-i*v)+d*(r*a-i*u)),e[15]=n*(u*h-a*c)-o*(r*h-i*c)+l*(r*a-i*u),e},c.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15],g=t*o-n*s,y=t*u-r*s,b=t*a-i*s,w=n*u-r*o,E=n*a-i*o,S=r*a-i*u,x=f*d-l*p,T=f*v-c*p,N=f*m-h*p,C=l*v-c*d,k=l*m-h*d,L=c*m-h*v;return g*L-y*k+b*C+w*N-E*T+S*x},c.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b=n[0],w=n[1],E=n[2],S=n[3];return e[0]=b*r+w*u+E*c+S*v,e[1]=b*i+w*a+E*h+S*m,e[2]=b*s+w*f+E*p+S*g,e[3]=b*o+w*l+E*d+S*y,b=n[4],w=n[5],E=n[6],S=n[7],e[4]=b*r+w*u+E*c+S*v,e[5]=b*i+w*a+E*h+S*m,e[6]=b*s+w*f+E*p+S*g,e[7]=b*o+w*l+E*d+S*y,b=n[8],w=n[9],E=n[10],S=n[11],e[8]=b*r+w*u+E*c+S*v,e[9]=b*i+w*a+E*h+S*m,e[10]=b*s+w*f+E*p+S*g,e[11]=b*o+w*l+E*d+S*y,b=n[12],w=n[13],E=n[14],S=n[15],e[12]=b*r+w*u+E*c+S*v,e[13]=b*i+w*a+E*h+S*m,e[14]=b*s+w*f+E*p+S*g,e[15]=b*o+w*l+E*d+S*y,e},c.mul=c.multiply,c.translate=function(e,t,n){var r=n[0],i=n[1],s=n[2],o,u,a,f,l,c,h,p,d,v,m,g;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*s+t[12],e[13]=t[1]*r+t[5]*i+t[9]*s+t[13],e[14]=t[2]*r+t[6]*i+t[10]*s+t[14],e[15]=t[3]*r+t[7]*i+t[11]*s+t[15]):(o=t[0],u=t[1],a=t[2],f=t[3],l=t[4],c=t[5],h=t[6],p=t[7],d=t[8],v=t[9],m=t[10],g=t[11],e[0]=o,e[1]=u,e[2]=a,e[3]=f,e[4]=l,e[5]=c,e[6]=h,e[7]=p,e[8]=d,e[9]=v,e[10]=m,e[11]=g,e[12]=o*r+l*i+d*s+t[12],e[13]=u*r+c*i+v*s+t[13],e[14]=a*r+h*i+m*s+t[14],e[15]=f*r+p*i+g*s+t[15]),e},c.scale=function(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.rotate=function(e,n,r,i){var s=i[0],o=i[1],u=i[2],a=Math.sqrt(s*s+o*o+u*u),f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;return Math.abs(a)<t?null:(a=1/a,s*=a,o*=a,u*=a,f=Math.sin(r),l=Math.cos(r),c=1-l,h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8],E=n[9],S=n[10],x=n[11],T=s*s*c+l,N=o*s*c+u*f,C=u*s*c-o*f,k=s*o*c-u*f,L=o*o*c+l,A=u*o*c+s*f,O=s*u*c+o*f,M=o*u*c-s*f,_=u*u*c+l,e[0]=h*T+m*N+w*C,e[1]=p*T+g*N+E*C,e[2]=d*T+y*N+S*C,e[3]=v*T+b*N+x*C,e[4]=h*k+m*L+w*A,e[5]=p*k+g*L+E*A,e[6]=d*k+y*L+S*A,e[7]=v*k+b*L+x*A,e[8]=h*O+m*M+w*_,e[9]=p*O+g*M+E*_,e[10]=d*O+y*M+S*_,e[11]=v*O+b*M+x*_,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)},c.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[4],o=t[5],u=t[6],a=t[7],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+f*r,e[5]=o*i+l*r,e[6]=u*i+c*r,e[7]=a*i+h*r,e[8]=f*i-s*r,e[9]=l*i-o*r,e[10]=c*i-u*r,e[11]=h*i-a*r,e},c.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-f*r,e[1]=o*i-l*r,e[2]=u*i-c*r,e[3]=a*i-h*r,e[8]=s*r+f*i,e[9]=o*r+l*i,e[10]=u*r+c*i,e[11]=a*r+h*i,e},c.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+f*r,e[1]=o*i+l*r,e[2]=u*i+c*r,e[3]=a*i+h*r,e[4]=f*i-s*r,e[5]=l*i-o*r,e[6]=c*i-u*r,e[7]=h*i-a*r,e},c.fromRotationTranslation=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,h=r*f,p=i*a,d=i*f,v=s*f,m=o*u,g=o*a,y=o*f;return e[0]=1-(p+v),e[1]=c+y,e[2]=h-g,e[3]=0,e[4]=c-y,e[5]=1-(l+v),e[6]=d+m,e[7]=0,e[8]=h+g,e[9]=d-m,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},c.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-(h+d),e[1]=l+g,e[2]=c-m,e[3]=0,e[4]=l-g,e[5]=1-(f+d),e[6]=p+v,e[7]=0,e[8]=c+m,e[9]=p-v,e[10]=1-(f+h),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.frustum=function(e,t,n,r,i,s,o){var u=1/(n-t),a=1/(i-r),f=1/(s-o);return e[0]=s*2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*a,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(i+r)*a,e[10]=(o+s)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*f,e[15]=0,e},c.perspective=function(e,t,n,r,i){var s=1/Math.tan(t/2),o=1/(r-i);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*o,e[15]=0,e},c.ortho=function(e,t,n,r,i,s,o){var u=1/(t-n),a=1/(r-i),f=1/(s-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(i+r)*a,e[14]=(o+s)*f,e[15]=1,e},c.lookAt=function(e,n,r,i){var s,o,u,a,f,l,h,p,d,v,m=n[0],g=n[1],y=n[2],b=i[0],w=i[1],E=i[2],S=r[0],x=r[1],T=r[2];return Math.abs(m-S)<t&&Math.abs(g-x)<t&&Math.abs(y-T)<t?c.identity(e):(h=m-S,p=g-x,d=y-T,v=1/Math.sqrt(h*h+p*p+d*d),h*=v,p*=v,d*=v,s=w*d-E*p,o=E*h-b*d,u=b*p-w*h,v=Math.sqrt(s*s+o*o+u*u),v?(v=1/v,s*=v,o*=v,u*=v):(s=0,o=0,u=0),a=p*u-d*o,f=d*s-h*u,l=h*o-p*s,v=Math.sqrt(a*a+f*f+l*l),v?(v=1/v,a*=v,f*=v,l*=v):(a=0,f=0,l=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=o,e[5]=f,e[6]=p,e[7]=0,e[8]=u,e[9]=l,e[10]=d,e[11]=0,e[12]=-(s*m+o*g+u*y),e[13]=-(a*m+f*g+l*y),e[14]=-(h*m+p*g+d*y),e[15]=1,e)},c.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},typeof e!="undefined"&&(e.mat4=c);var h={};h.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.rotationTo=function(){var e=o.create(),t=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(r,i,s){var u=o.dot(i,s);return u<-0.999999?(o.cross(e,t,i),o.length(e)<1e-6&&o.cross(e,n,i),o.normalize(e,e),h.setAxisAngle(r,e,Math.PI),r):u>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(o.cross(e,i,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+u,h.normalize(r,r))}}(),h.setAxes=function(){var e=l.create();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=n[0],e[5]=n[1],e[8]=n[2],h.normalize(t,h.fromMat3(t,e))}}(),h.clone=u.clone,h.fromValues=u.fromValues,h.copy=u.copy,h.set=u.set,h.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.setAxisAngle=function(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e},h.add=u.add,h.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*l+o*u+i*f-s*a,e[1]=i*l+o*a+s*u-r*f,e[2]=s*l+o*f+r*a-i*u,e[3]=o*l-r*u-i*a-s*f,e},h.mul=h.multiply,h.scale=u.scale,h.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+o*u,e[1]=i*a+s*u,e[2]=s*a-i*u,e[3]=o*a-r*u,e},h.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a-s*u,e[1]=i*a+o*u,e[2]=s*a+r*u,e[3]=o*a-i*u,e},h.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=i*a-r*u,e[2]=s*a+o*u,e[3]=o*a-s*u,e},h.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},h.dot=u.dot,h.lerp=u.lerp,h.slerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=n[0],f=n[1],l=n[2],c=n[3],h,p,d,v,m;return p=i*a+s*f+o*l+u*c,p<0&&(p=-p,a=-a,f=-f,l=-l,c=-c),1-p>1e-6?(h=Math.acos(p),d=Math.sin(h),v=Math.sin((1-r)*h)/d,m=Math.sin(r*h)/d):(v=1-r,m=r),e[0]=v*i+m*a,e[1]=v*s+m*f,e[2]=v*o+m*l,e[3]=v*u+m*c,e},h.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-i*u,e[3]=s*u,e},h.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},h.length=u.length,h.len=h.length,h.squaredLength=u.squaredLength,h.sqrLen=h.squaredLength,h.normalize=u.normalize,h.fromMat3=function(){var e=typeof Int8Array!="undefined"?new Int8Array([1,2,0]):[1,2,0];return function(t,n){var r=n[0]+n[4]+n[8],i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(n[7]-n[5])*i,t[1]=(n[2]-n[6])*i,t[2]=(n[3]-n[1])*i;else{var s=0;n[4]>n[0]&&(s=1),n[8]>n[s*3+s]&&(s=2);var o=e[s],u=e[o];i=Math.sqrt(n[s*3+s]-n[o*3+o]-n[u*3+u]+1),t[s]=.5*i,i=.5/i,t[3]=(n[u*3+o]-n[o*3+u])*i,t[o]=(n[o*3+s]+n[s*3+o])*i,t[u]=(n[u*3+s]+n[s*3+u])*i}return t}}(),h.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.quat=h)}(t.exports)}(this),r("2d/style",["require","core/base","_"],function(e){function u(e){return(e||"").replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"")}var t=e("core/base"),n=e("_"),r=["fillStyle","strokeStyle","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","globalAlpha","font"],i={fill:"fillStyle",stroke:"strokeStyle",alpha:"globalAlpha",shadow:["shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor"]},s=/([0-9\-]+)\s+([0-9\-]+)\s+([0-9]+)\s+([a-zA-Z0-9\(\)\s,#]+)/,o=t.derive({},{bind:function(e){var t=r,o=i;for(var a in o)if(this.hasOwnProperty(a)){var f=o[a],l=this[a];if(a=="shadow"){var c=s.exec(u(l));if(!c)continue;l=c.slice(1),n.each(l,function(t,n){f[n]&&(e[f[n]]=t)},this)}else e[f]=l}n.each(t,function(t){this.hasOwnProperty(t)&&(e[t]=this[t])},this)}});return o}),r("2d/node",["require","core/base","glmatrix","./style"],function(e){var t=e("core/base"),n=e("glmatrix"),r=n.vec2,i=n.mat2d,s=e("./style"),o=t.derive(function(){return{__mouseover__:!1,id:0,AABB:[r.fromValues(0,0),r.fromValues(0,0)],z:0,style:null,position:r.fromValues(0,0),rotation:0,scale:r.fromValues(1,1),_transform:i.create(),_transformInverse:i.create(),visible:!0,children:{},intersectLineWidth:0,clip:!1,fill:!0,stroke:!0,fixAA:!0}},function(){this.__GUID__=u()},{updateTransform:function(){var e=this._transform;return i.identity(e),this.scale&&i.scale(e,e,this.scale),this.rotation&&i.rotate(e,e,this.rotation),this.position&&i.translate(e,e,this.position),e},updateTransformInverse:function(){i.invert(this._transformInverse,this._transformInverse)},intersectAABB:function(e,t){var n=this.AABB;return n[0][0]<e&&e<n[1][0]&&n[0][1]<t&&t<n[1][1]},add:function(e){e&&(this.children[e.__GUID__]=e,e.parent=this)},remove:function(e){this.children[e.__GUID__]=null,e.parent=null},draw:function(e){},render:function(e){var t=this._getSortedRenderQueue();e.save();if(this.style)if(!this.style instanceof s)for(var n in this.style)this.style[n].bind(e);else this.style.bind(e);var r=this.updateTransform();e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this.draw(e),this.clip&&e.clip();for(var i=0;i<t.length;i++)t[i].render(e);e.restore()},traverse:function(e){var t=e&&e(this);if(!t){var n=this.children;for(var r=0,i=n.length;r<i;r++)n[r].traverse(e)}},intersect:function(e,t,n){},_getSortedRenderQueue:function(){var e=[];for(var t in this.children)e.push(this.children[t]);return e.sort(function(e,t){return e.z===t.z?e.__GUID__>t.__GUID__?1:-1:e.z>t.z?1:-1}),e}}),u=function(){var e=0;return function(){return++e}}();return o}),r("2d/util",["require"],function(e){return{fixPos:function(e){return[e[0]+.5,e[1]+.5]},fixPosArray:function(e){var t=[],n=e.length;for(var r=0;r<n;r++)t.push(this.fixPos(e[r]));return t},computeAABB:function(e){var t=e[0][0],n=e[0][0],r=e[0][1],i=e[0][1];for(var s=1;s<e.length;s++)t=e[s][0]<t?e[s][0]:t,n=e[s][0]>n?e[s][0]:n,r=e[s][1]<r?e[s][1]:r,i=e[s][1]>i?e[s][1]:i;return[[t,r],[n,i]]}}}),r("2d/renderable/arc",["require","../node","../util","glmatrix"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{center:[0,0],radius:0,startAngle:0,endAngle:Math.PI*2,clockwise:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(e){var t=this.fixAA?n.fixPos(this.center):this.center;ctx.beginPath(),ctx.arc(t[0],t[1],this.radius,this.startAngle,this.endAngle,!this.clockwise),this.stroke&&ctx.stroke(),this.fill&&ctx.fill()},intersect:function(e,t){return!1}});return s}),r("2d/renderable/circle",["require","../node","../util","glmatrix"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{center:[0,0],radius:0}},{computeAABB:function(){this.AABB=[[this.center[0]-this.radius,this.center[1]-this.radius],[this.center[0]+this.radius,this.center[1]+this.radius]]},draw:function(e){var t=this.fixAA?n.fixPos(this.center):this.center;e.beginPath(),e.arc(t[0],t[1],this.radius,0,2*Math.PI,!1),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(){return i.len([this.center[0]-x,this.center[1]-y])<this.radius}});return s}),r("2d/renderable/image",["require","../node","../util","glmatrix"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s={},o=t.derive(function(){return{img:"",start:[0,0],size:0,onload:function(){}}},function(){if(typeof this.img=="string"){var e=this;this.load(this.img,function(t){e.img=t,e.onload.call(e)})}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(e){var t=this.fixAA?n.fixPos(this.start):this.start;typeof this.img!="string"&&(this.size?e.drawImage(this.img,t[0],t[1],this.size[0],this.size[1]):e.drawImage(this.img,t[0],t[1]))},intersect:function(e,t){return this.intersectAABB(e,t)},load:function(e,t){if(s[e]){var n=s[e];n.constructor==Array?n.push(t):t(n)}else{s[e]=[t];var n=new o;n.onload=function(){each(s[e],function(e){e(n)}),s[e]=n},n.src=e}}});return o}),r("2d/renderable/line",["require","../node","../util","glmatrix"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{start:[0,0],end:[0,0],width:0}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,this.end]),this.AABB[0][0]==this.AABB[1][0]&&(this.AABB[0][0]-=this.width/2,this.AABB[1][0]+=this.width/2),this.AABB[0][1]==this.AABB[1][1]&&(this.AABB[0][1]-=this.width/2,this.AABB[1][1]+=this.width/2)},draw:function(e){var t=this.fixAA?n.fixPos(this.start):this.start,r=this.fixAA?n.fixPos(this.end):this.end;e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(r[0],r[1]),e.stroke()},intersect:function(e,t){if(!this.intersectAABB(e,t))return!1;var n=[e,t];b=this.start,c=this.end,ba=i.sub([],n,b),bc=i.sub([],c,b);var r=i.dot(bc,ba);i.normalize(bc,bc);var s=i.add(b,i.scale(bc,r)),o=i.length(i.sub(n,n,s));return o<this.width/2}});return s}),r("2d/renderable/path",["require","../node","../util","glmatrix"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{segments:[],globalStyle:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(e){this.globalStyle?this.drawWithSameStyle(e):this.drawWithDifferentStyle(e)},drawWithSameStyle:function(e){var t=this.segments.length,n=this.segments;e.beginPath(),e.moveTo(n[0].point[0],n[0].point[1]);for(var r=1;r<t;r++)if(n[r-1].handleOut||n[r].handleIn){var i=n[r-1].handleOut||n[r-1].point,s=n[r].handleIn||n[r].point;e.bezierCurveTo(i[0],i[1],s[0],s[1],n[r].point[0],n[r].point[1])}else e.lineTo(n[r].point[0],n[r].point[1]);this.fill&&e.fill(),this.stroke&&e.stroke()},drawWithDifferentStyle:function(e){var t=this.segments.length,n=this.segments;for(var r=0;r<t-1;r++){e.save(),n[r].style&&n[r].style.bind(e),e.beginPath(),e.moveTo(n[r].point[0],n[r].point[1]);if(n[r].handleOut||n[r+1].handleIn){var i=n[r].handleOut||n[r].point,s=n[r+1].handleIn||n[r+1].point;e.bezierCurveTo(i[0],i[1],s[0],s[1],n[r+1].point[0],n[r+1].point[1])}else e.lineTo(n[r+1].point[0],n[r+1].point[1]);this.stroke&&e.stroke(),this.fill&&e.fill(),e.restore()}},smooth:function(e){function s(e,t,n){var r=i.scale([],i.add([],t,n),.5);return i.sub([],e,r)}var t=this.segments.length,n=[],r=this.segments;for(var o=0;o<t;o++){var u=r[o].point,a=o==t-1?r[0].point:r[o+1].point;n.push(i.scale([],i.add([],u,a),.5))}for(var o=0;o<t;o++){var u=r[o].point,f=n[o],l=o==0?n[t-1]:n[o-1],e=r[o].smoothLevel||e||1,c=i.scale([],i.add([],f,l),.5),h=i.sub([],f,c),p=i.sub([],l,c),d=s(u,l,f);i.scale(p,p,e),i.scale(h,h,e),r[o].handleIn=i.add([],i.add([],c,p),d),r[o].handleOut=i.add([],i.add([],c,h),d)}r[0].handleOut=r[0].handleIn=null,r[t-1].handleIn=r[t-1].handleOut=null},pushPoints:function(e){for(var t=0;t<e.length;t++)this.segments.push({point:e[t],handleIn:null,handleOut:null})}});return s}),r("2d/renderable/polygon",["require","../node","../util","glmatrix"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{points:[]}},{computeAABB:function(){this.AABB=n.computeAABB(this.points)},draw:function(e){var t=this.fixAA?n.fixPosArray(this.points):this.points;e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var r=1;r<t.length;r++)e.lineTo(t[r][0],t[r][1]);e.closePath(),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){if(!this.intersectAABB(e,t))return!1;var n=this.points.length,r=0,i=this.points,s,o,u,a;for(var f=0;f<n;f++)s=o.normalize([],[i[f][0]-e,i[f][1]-t]),u=(f+1)%n,o=o.normalize([],[i[u][0]-e,i[u][1]-t]),a=Math.acos(o.dot(s,o)),r+=a;return Math.length(r-2*Math.PI)<.001}});return t}),r("2d/renderable/rectangle",["require","../node","../util","glmatrix"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{start:[0,0],size:[0,0]}},{computeAABB:function(){var e=i.add([],this.start,this.size);this.AABB=n.computeAABB([this.start,e])},draw:function(e){var t=this.fixAA?n.fixPos(this.start):this.start;e.beginPath(),e.rect(t[0],t[1],this.size[0],this.size[1]),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){return this.intersectAABB(e,t)}});return s}),r("2d/renderable/roundedrectangle",["require","../node","../util","glmatrix"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{start:[0,0],size:[0,0],radius:0}},{computeAABB:function(){var e=i.add([],this.start,this.size);this.AABB=n.computeAABB([this.start,e])},draw:function(e){if(this.radius.constructor==Number)var t=[this.radius,this.radius,this.radius,this.radius];else if(this.radius.length==2)var t=[this.radius[0],this.radius[1],this.radius[0],this.radius[1]];else var t=this.radius;var r=this.fixAA?n.fixPos(this.start):this.start,s=this.size,o=i.add([],r,[t[0],0]),u=i.add([],r,[s[0],0]),a=i.add([],r,s),f=i.add([],r,[0,s[1]]);e.beginPath(),e.moveTo(o[0],o[1]),t[1]?e.arcTo(u[0],u[1],a[0],a[1],t[1]):e.lineTo(u[0],u[1]),t[2]?e.arcTo(a[0],a[1],f[0],f[1],t[2]):e.lineTo(a[0],a[1]),t[3]?e.arcTo(f[0],f[1],r[0],r[1],t[3]):e.lineTo(f[0],f[1]),t[0]?e.arcTo(r[0],r[1],u[0],u[1],t[0]):e.lineTo(r[0],r[1]),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){return!1}});return s}),r("2d/renderable/sector",["require","../node","../util","glmatrix"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{center:[0,0],innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,clockwise:!0}},{computeAABB:function(){this.AABB=[0,0]},intersect:function(e,t){var n=this.startAngle,r=this.endAngle,s=this.innerRadius,o=this.outerRadius,u=this.center,a=i.sub([],[e,t],u),f=i.length(a),l=Math.PI*2;if(f<s||f>o)return!1;var c=Math.atan2(a[1],a[0]);return c<0&&(c+=l),this.clockwise?c<r&&c>n:(n=l-n,r=l-r,c>r&&c<n)},draw:function(e){var t=this.startAngle,r=this.endAngle,s=this.innerRadius,o=this.outerRadius,u=this.fixAA?n.fixPos(this.center):this.center;this.clockwise||(t=Math.PI*2-t,r=Math.PI*2-r);var a=i.add([],u,[s*Math.cos(t),s*Math.sin(t)]),f=i.add([],u,[o*Math.cos(t),o*Math.sin(t)]),l=i.add([],u,[s*Math.cos(r),s*Math.sin(r)]),c=i.add([],u,[o*Math.cos(r),o*Math.sin(r)]);e.beginPath(),e.moveTo(a[0],a[1]),e.lineTo(f[0],f[1]),e.arc(u[0],u[1],o,t,r,!this.clockwise),e.lineTo(l[0],l[1]),e.arc(u[0],u[1],s,r,t,this.clockwise),e.endPath(),this.stroke&&e.stroke(),this.fill&&e.fill()}});return s}),r("2d/renderable/text",["require","../node","../util","glmatrix"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{text:"",start:[0,0],size:[0,0],font:"",textAlign:"",textBaseline:""}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(e){var t=this.fixAA?n.fixPos(this.start):this.start;this.font&&(e.font=this.font),this.textAlign&&(e.textAlign=this.textAlign),this.textBaseline&&(e.textBaseline=this.textBaseline),this.fill&&(this.size.length&&this.size[0]?e.fillText(this.text,t[0],t[1],this.size[0]):e.fillText(this.text,t[0],t[1])),this.stroke&&(this.size.length&&this.size[0]?e.strokeText(this.text,t[0],t[1],this.size[0]):e.strokeText(this.text,t[0],t[1]))},resize:function(e){if(!this.size[0]||this.needResize)this.size[0]=e.measureText(this.text).width,this.size[1]=e.measureText("m").width},intersect:function(e,t){return this.intersectAABB(e,t)}});return s}),r("2d/renderable/textbox",["require","../node","../util","glmatrix","./text","_"],function(e){var t=e("../node"),n=e("../util"),r=e("glmatrix"),i=r.vec2,s=e("./text"),o=e("_"),u=t.derive(function(){return{text:"",textAlign:"",textBaseline:"top",font:"",start:[0,0],width:0,wordWrap:!1,wordBreak:!1,lineHeight:0,stroke:!1,_texts:[]}},function(){this._oldText=""},{computeAABB:function(){},draw:function(e){if(this.text!=this._oldText){this._oldText=this.text,this.font&&(e.font=this.font);if(this.wordBreak)this._texts=this.computeWordBreak(e);else if(this.wordWrap)this._texts=this.computeWordWrap(e);else{var t=new s({text:this.text,textBaseline:this.textBaseline});this.extendCommonProperties(t),this._texts=[t]}}o.each(this._texts,function(t){t.draw(e)})},computeWordWrap:function(e){if(!this.text)return;var t=this.text.split(" "),n=t.length,r=0,o,u,a=[],f;for(var l=0;l<n;l++)u=l==n-1?t[l]:t[l]+" ",o=e.measureText(u).width,r+o>this.width||!f?(f=new s({text:u,start:i.add([],this.start,[0,this.lineHeight*a.length])}),this.extendCommonProperties(f),a.push(f),r=o):(r+=o,f.text+=u);return a},computeWordBreak:function(e){if(!this.text)return;var t=this.text.length,n,r,o=e.measureText(this.text[0]).width,u=[],a;for(var f=0;f<t;f++){r=this.text[f],n=e.measureText(r).width;if(o+n>this.width||!a){var a=new s({text:r,start:i.add([],this.start,[0,this.lineHeight*u.length])});this.extendCommonProperties(a),u.push(a),o=n}else o+=n,a.text+=r}return u},extendCommonProperties:function(e){var t={};o.extend(e,{textAlign:this.textAlign,textBaseline:this.textBaseline,style:this.style,font:this.font,fill:this.fill,stroke:this.stroke})},intersect:function(e,t){}});return u}),r("2d/renderer",["require","core/base"],function(e){var t=e("core/base"),n=t.derive(function(){return{canvas:null,context:null,width:0,height:0,_latestRenderedScene:null}},function(){this.canvas||(this.canvas=document.createElement("canvas")),this.canvas.addEventListener("click",this._clickHandler.bind(this)),this.canvas.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this.canvas.addEventListener("mouseup",this._mouseUpHandler.bind(this)),this.canvas.addEventListener("mousemove",this._mouseMoveHandler.bind(this)),this.canvas.addEventListener("mouseout",this._mouseOutHandler.bind(this)),this.width?this.canvas.width=this.width:this.width=this.canvas.width,this.height?this.canvas.height=this.height:this.height=this.canvas.height,this.context=this.canvas.getContext("2d")},{resize:function(e,t){this.canvas.width=e,this.canvas.height=t},render:function(e){this.context.clearRect(0,0,this.width,this.height),e.render(this.context),this._latestRenderedScene=e},_clickHandler:function(){var e=this._latestRenderedScene},_mouseDownHandler:function(){},_mouseUpHandler:function(){},_mouseMoveHandler:function(){},_mouseOutHandler:function(){}});return n}),r("2d/scene",["require","./node"],function(e){var t=e("./node"),n=t.derive(function(){return{}},{});return n}),r("core/vector3",["require","glmatrix"],function(e){function s(e){return Math.min(Math.max(e,-1),1)}var t=e("glmatrix"),n=t.vec3,r=function(e,t,r){return e=e||0,t=t||0,r=r||0,Object.create(i,{x:{configurable:!1,set:function(e){this._array[0]=e,this._dirty=!0},get:function(){return this._array[0]}},y:{configurable:!1,set:function(e){this._array[1]=e,this._dirty=!0},get:function(){return this._array[1]}},z:{configurable:!1,set:function(e){this._array[2]=e,this._dirty=!0},get:function(){return this._array[2]}},_array:{writable:!1,configurable:!1,value:n.fromValues(e,t,r)},_dirty:{configurable:!1,value:!0}})},i={constructor:r,add:function(e){return n.add(this._array,this._array,e._array),this._dirty=!0,this},set:function(e,t,n){return this._array[0]=e,this._array[1]=t,this._array[2]=n,this._dirty=!0,this},clone:function(){return new r(this.x,this.y,this.z)},copy:function(e){return n.copy(this._array,e._array),this._dirty=!0,this},cross:function(e,t){return n.cross(e._array,this._array,t._array),this},dist:function(e){return n.dist(this._array,e._array)},distance:function(e){return n.distance(this._array,e._array)},div:function(e){return n.div(this._array,this._array,e._array),this._dirty=!0,this},divide:function(e){return n.divide(this._array,this._array,e._array),this._dirty=!0,this},dot:function(e){return n.dot(this._array,e._array)},len:function(){return n.len(this._array)},length:function(){return n.length(this._array)},lerp:function(e,t,r){return n.lerp(this._array,e._array,t._array,r),this._dirty=!0,this},mul:function(e){return n.mul(this._array,this._array,e._array),this._dirty=!0,this},multiply:function(e){return n.multiply(this._array,this._array,e._array),this._dirty=!0,this},negate:function(){return n.negate(this._array,this._array),this._dirty=!0,this},normalize:function(){return n.normalize(this._array,this._array),this._dirty=!0,this},random:function(e){return n.random(this._array,e),this._dirty=!0,this},scale:function(e){return n.scale(this._array,this._array,e),this._dirty=!0,this},scaleAndAdd:function(e,t){return n.scaleAndAdd(this._array,this._array,e._array,t),this._dirty=!0,this},sqrDist:function(e){return n.sqrDist(this._array,e._array)},squaredDistance:function(e){return n.squaredDistance(this._array,e._array)},sqrLen:function(){return n.sqrLen(this._array)},squaredLength:function(){return n.squaredLength(this._array)},sub:function(e){return n.sub(this._array,this._array,e._array),this._dirty=!0,this},subtract:function(e){return n.subtract(this._array,this._array,e._array),this._dirty=!0,this},transformMat3:function(e){return n.transformMat3(this._array,this._array,e._array),this._dirty=!0,this},transformMat4:function(e){return n.transformMat4(this._array,this._array,e._array),this._dirty=!0,this},transformQuat:function(e){return n.transformQuat(this._array,this._array,e._array),this._dirty=!0,this},setEulerFromQuaternion:function(e){},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return r}),r("core/quaternion",["require","glmatrix"],function(e){var t=e("glmatrix"),n=t.quat,r=function(e,t,r,s){return e=e||0,t=t||0,r=r||0,s=typeof s=="undefined"?1:s,Object.create(i,{x:{configurable:!1,set:function(e){this._array[0]=e,this._dirty=!0},get:function(){return this._array[0]}},y:{configurable:!1,set:function(e){this._array[1]=e,this._dirty=!0},get:function(){return this._array[1]}},z:{configurable:!1,set:function(e){this._array[2]=e,this._dirty=!0},get:function(){return this._array[2]}},w:{configurable:!1,set:function(e){this._array[2]=e,this._dirty=!0},get:function(){return this._array[2]}},_array:{writable:!1,configurable:!1,value:n.fromValues(e,t,r,s)},_dirty:{configurable:!1,value:!1}})},i={constructor:r,add:function(e){return n.add(this._array,this._array,e._array),this._dirty=!0,this},calculateW:function(){return n.calculateW(this._array,this._array),this._dirty=!0,this},set:function(e,t,n,r){return this._array[0]=e,this._array[1]=t,this._array[2]=n,this._array[3]=r,this._dirty=!0,this},clone:function(){return new r(this.x,this.y,this.z,this.w)},conjugate:function(){return n.conjugate(this._array,this._array),this._dirty=!0,this},copy:function(e){return n.copy(this._array,e._array),this._dirty=!0,this},dot:function(e){return n.dot(this._array,e._array)},fromMat3:function(e){return n.fromMat3(this._array,e._array),this._dirty=!0,this},fromMat4:function(){var e=t.mat3,r=e.create();return function(t){return e.fromMat4(r,t._array),e.transpose(r,r),n.fromMat3(this._array,r),this._dirty=!0,this}}(),identity:function(){return n.identity(this._array),this._dirty=!0,this},invert:function(){return n.invert(this._array,this._array),this._dirty=!0,this},len:function(){return n.len(this._array)},length:function(){return n.length(this._array)},lerp:function(e,t,r){return n.lerp(this._array,e._array,t._array,r),this._dirty=!0,this},mul:function(e){return n.mul(this._array,this._array,e._array),this._dirty=!0,this},multiply:function(e){return n.multiply(this._array,this._array,e._array),this._dirty=!0,this},normalize:function(){return n.normalize(this._array,this._array),this._dirty=!0,this},rotateX:function(e){return n.rotateX(this._array,this._array,e),this._dirty=!0,this},rotateY:function(e){return n.rotateY(this._array,this._array,e),this._dirty=!0,this},rotateZ:function(e){return n.rotateZ(this._array,this._array,e),this._dirty=!0,this},setAxisAngle:function(e,t){return n.setAxisAngle(this._array,e._array,t),this._dirty=!0,this},slerp:function(e,t,r){return n.slerp(this._array,e._array,t._array,r),this._dirty=!0,this},sqrLen:function(){return n.sqrLen(this._array)},squaredLength:function(){return n.squaredLength(this._array)},setFromEuler:function(e){},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return r}),r("core/matrix4",["require","glmatrix","./vector3"],function(e){function u(e){return{configurable:!1,set:function(t){this._array[e]=t,this._dirty=!0},get:function(){return this._array[e]}}}var t=e("glmatrix"),n=e("./vector3"),r=t.mat4,i=t.vec3,s=t.mat3,o=t.quat,a=function(){var e=new n,t=new n,i=new n;return Object.create(f,{m00:u(0),m01:u(1),m02:u(2),m03:u(3),m10:u(4),m11:u(5),m12:u(6),m13:u(7),m20:u(8),m21:u(9),m22:u(10),m23:u(11),m30:u(12),m31:u(13),m32:u(14),m33:u(15),forward:{configurable:!1,get:function(){var e=this._array;return i.set(e[8],e[9],e[10]),i},set:function(e){var t=this._array,e=e._array;t[8]=e[8],t[9]=e[9],t[10]=e[10]}},up:{configurable:!1,enumerable:!0,get:function(){var e=this._array;return t.set(e[4],e[5],e[6]),t},set:function(e){var t=this._array,e=e._array;t[4]=e[4],t[5]=e[5],t[6]=e[6]}},right:{configurable:!1,get:function(){var t=this._array;return e.set(t[0],t[1],t[2]),e},set:function(e){var t=this._array,e=e._array;t[0]=e[0],t[1]=e[1],t[2]=e[2]}},_array:{writable:!1,configurable:!1,value:r.create()}})},f={constructor:a,adjoint:function(){return r.adjoint(this._array,this._array),this},clone:function(){return(new a).copy(this)},copy:function(e){return r.copy(this._array,e._array),this},determinant:function(){return r.determinant(this._array)},fromQuat:function(e){return r.fromQuat(this._array,e._array),this},fromRotationTranslation:function(e,t){return r.fromRotationTranslation(this._array,e._array,t._array),this},frustum:function(e,t,n,i,s,o){return r.frustum(this._array,e,t,n,i,s,o),this},identity:function(){return r.identity(this._array),this},invert:function(){return r.invert(this._array,this._array),this},lookAt:function(e,t,n){return r.lookAt(this._array,e._array,t._array,n._array),this},mul:function(e){return r.mul(this._array,this._array,e._array),this},mulLeft:function(e){return r.mul(this._array,e._array,this._array),this},multiply:function(e){return r.multiply(this._array,this._array,e._array),this},multiplyLeft:function(e){return r.multiply(this._array,e._array,this._array),this},ortho:function(e,t,n,i,s,o){return r.ortho(this._array,e,t,n,i,s,o),this},perspective:function(e,t,n,i){return r.perspective(this._array,e,t,n,i),this},rotate:function(e,t){return r.rotate(this._array,this._array,e,t._array),this},rotateX:function(e){return r.rotateX(this._array,this._array,e),this},rotateY:function(e){return r.rotateY(this._array,this._array,e),this},rotateZ:function(e){return r.rotateZ(this._array,this._array,e),this},scale:function(e){return r.scale(this._array,this._array,e._array),this},translate:function(e){return r.translate(this._array,this._array,e._array),this},transpose:function(){return r.transpose(this._array,this._array),this},rotateAround:function(e,t,n){console.warn("TODO")},decomposeMatrix:function(){var e=i.create(),t=i.create(),n=i.create(),r=s.create();return function(u,a,f){var l=this._array;i.set(e,l[0],l[1],l[2]),i.set(t,l[4],l[5],l[6]),i.set(n,l[8],l[9],l[10]),u.x=i.length(e),u.y=i.length(t),u.z=i.length(n),f.set(l[12],l[13],l[14]),s.fromMat4(r,l),s.transpose(r,r),r[0]/=u.x,r[1]/=u.x,r[2]/=u.x,r[3]/=u.y,r[4]/=u.y,r[5]/=u.y,r[6]/=u.z,r[7]/=u.z,r[8]/=u.z,o.fromMat3(a._array,r),a.normalize()}}(),toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return a}),r("core/matrix3",["require","glmatrix"],function(e){function r(e){return{configurable:!1,set:function(t){this._array[e]=t,this._dirty=!0},get:function(){return this._array[e]}}}var t=e("glmatrix"),n=t.mat3,i=function(){return Object.create(s,{m00:r(0),m01:r(1),m02:r(2),m10:r(3),m11:r(4),m12:r(5),m20:r(6),m21:r(7),m22:r(8),_array:{writable:!1,configurable:!1,value:n.create()}})},s={constructor:i,adjoint:function(){return n.adjoint(this._array,this._array),this},clone:function(){return(new i).copy(this)},copy:function(e){return n.copy(this._array,e._array),this},determinant:function(){return n.determinant(this._array)},fromMat2d:function(e){return n.fromMat2d(this._array,e._array)},fromMat4:function(e){return n.fromMat4(this._array,e._array)},fromQuat:function(e){return n.fromQuat(this._array,e._array),this},identity:function(){return n.identity(this._array),this},invert:function(){return n.invert(this._array,this._array),this},mul:function(e){return n.mul(this._array,this._array,e._array),this},mulLeft:function(e){return n.mul(this._array,e._array,this._array),this},multiply:function(e){return n.multiply(this._array,this._array,e._array),this},multiplyLeft:function(e){return n.multiply(this._array,e._array,this._array),this},normalFromMat4:function(e){return n.normalFromMat4(this._array,e._array),e},transpose:function(){return n.transpose(this._array,this._array),this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return i}),r("util/util",["require"],function(e){return{genGUID:function(){var e=0;return function(){return++e}}()}}),r("3d/node",["require","core/base","core/vector3","core/quaternion","core/matrix4","core/matrix3","util/util","_"],function(e){var t=e("core/base"),n=e("core/vector3"),r=e("core/quaternion"),i=e("core/matrix4"),s=e("core/matrix3"),o=e("util/util"),u=e("_"),a=t.derive(function(){var e=o.genGUID();return{__GUID__:e,name:"NODE_"+e,visible:!0,position:new n,rotation:new r,scale:new n(1,1,1),eulerAngle:new n,useEuler:!1,children:[],parent:null,worldMatrix:new i,matrix:new i}},{add:function(e){if(this.children.indexOf(e)>=0)return;this.children.push(e),e.parent=this},remove:function(e){u.without(this.children,e),e.parent=null},traverse:function(e){var t=e&&e(this);if(!t){var n=this.children;for(var r=0,i=n.length;r<i;r++)n[r].traverse(e)}},updateMatrix:function(){if(!this.position._dirty&&!this.scale._dirty){if(this.useEuler&&!this.eulerAngle._dirty)return;if(!this.rotation._dirty)return}var e=this.matrix;e.identity(),this.useEuler&&(this.rotation.identity(),this.rotation.rotateX(this.eulerAngle.x),this.rotation.rotateY(this.eulerAngle.y),this.rotation.rotateZ(this.eulerAngle.z)),e.fromRotationTranslation(this.rotation,this.position),e.scale(this.scale),this.rotation._dirty=!1,this.scale._dirty=!1,this.position._dirty=!1,this.eulerAngle._dirty=!1},decomposeMatrix:function(){this.matrix.decomposeMatrix(this.scale,this.rotation,this.position),this.useEuler||this.eulerAngle.setEulerFromQuaternion(this.rotation),this.rotation._dirty=!1,this.scale._dirty=!1,this.position._dirty=!1,this.eulerAngle._dirty=!1},updateWorldMatrix:function(){this.updateMatrix(),this.parent?this.worldMatrix.copy(this.parent.worldMatrix).multiply(this.matrix):this.worldMatrix.copy(this.matrix)},update:function(e,t){t||this.trigger("beforeupdate",e),this.updateWorldMatrix(),t||this.trigger("afterupdate",e);for(var n=0;n<this.children.length;n++){var r=this.children[n];r.visible&&r.update(e)}},getWorldPosition:function(){var e=this.worldMatrix._array;return new n(e[12],e[13],e[14])},translate:function(e){this.updateMatrix(),this.translate(e),this.decomposeMatrix()},rotate:function(e,t){this.updateMatrix(),this.matrix.rotate(e,t),this.decomposeMatrix()},rotateAround:function(){var e=new n,t=new i;return function(n,r,i){e.copy(this.position).subtract(n),this.matrix.identity(),this.matrix.translate(n),this.matrix.rotate(i,r),this.useEuler&&(this.rotation.identity(),this.rotation.rotateX(this.eulerAngle.x),this.rotation.rotateY(this.eulerAngle.y),this.rotation.rotateZ(this.eulerAngle.z)),t.fromRotationTranslation(this.rotation,e),this.matrix.multiply(t),this.matrix.scale(this.scale),this.decomposeMatrix()}}(),lookAt:function(){var e=new i,t=new n;return function(n,r){e.lookAt(this.position,n,r||this.matrix.up).invert(),e.decomposeMatrix(t,this.rotation,this.position)}}()});return a}),r("3d/camera",["require","./node","core/matrix4"],function(e){var t=e("./node"),n=e("core/matrix4"),r=t.derive(function(){return{projectionMatrix:new n}},function(){this.update()},{update:function(e){t.prototype.update.call(this,e),this.updateProjectionMatrix()}});return r}),r("3d/camera/orthographic",["require","../camera"],function(e){var t=e("../camera"),n=t.derive(function(){return{left:-1,right:1,near:0,far:1,top:1,bottom:-1}},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)}});return n}),r("3d/compositor/graph/graph",["require","core/base","_"],function(e){var t=e("core/base"),n=e("_"),r=t.derive(function(){return{nodes:[]}},{add:function(e){this.nodes.push(e),this.dirty("graph")},remove:function(e){n.without(this.nodes,e),this.dirty("graph")},update:function(){for(var e=0;e<this.nodes.length;e++)this.nodes[e].clear();for(var e=0;e<this.nodes.length;e++){var t=this.nodes[e];if(!t.inputs)continue;for(var n in t.inputs){var r=t.inputs[n],i=this.findPin(r);i?t.link(n,i.node,i.pin):console.warn("Pin of "+r.node+"."+r.pin+" not exist")}}},findPin:function(e){var t;if(typeof e.node=="string")for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n];r.name===e.node&&(t=r)}else t=e.node;if(t&&t.outputs[e.pin])return{node:t,pin:e.pin}},fromJSON:function(e){}});return r}),r("3d/compositor",["require","./compositor/graph/graph"],function(e){var t=e("./compositor/graph/graph"),n=t.derive(function(){return{}},{render:function(e){this.isDirty("graph")&&(this.update(),this.fresh("graph"));var t;for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n];r.outputs||r.render(e),r.updateReference()}}});return n}),r("3d/scene",["require","./node"],function(e){var t=e("./node"),n=t.derive(function(){return{material:null,lightNumber:{},lightUniforms:{},filter:null}},{});return n}),r("3d/geometry",["require","core/base","util/util","glmatrix","_"],function(e){var t=e("core/base"),n=e("util/util"),r=e("glmatrix"),i=r.vec3,s=r.vec2,o=r.mat2,u=r.mat4,a=e("_"),f=Array.prototype.slice,l=t.derive(function(){return{__GUID__:n.genGUID(),attributes:{position:{type:"float",semantic:"POSITION",size:3,value:[]},texcoord0:{type:"float",semantic:"TEXCOORD_0",size:2,value:[]},texcoord1:{type:"float",semantic:"TEXCOORD_1",size:2,value:[]},normal:{type:"float",semantic:"NORMAL",size:3,value:[]},tangent:{type:"float",semantic:"TANGENT",size:4,value:[]},color:{type:"ubyte",semantic:"COLOR",size:3,value:[]},barycentric:{type:"float",size:3,value:[]},boneWeight:{type:"float",size:3,value:[]},boneIndex:{type:"float",size:4,value:[]}},useFaces:!0,faces:[],hint:"STATIC_DRAW",chunkSize:65535,_enabledAttributes:null,_verticesNumber:0,_normalType:"vertex",_arrayChunks:[],_verticesReorganizedMap:[],_reorganizedFaces:[]}},{dirty:function(e){if(!e){this.dirty("indices");for(var t in this.attributes)this.dirty(t);return}for(var n in this.cache._caches)this.cache._caches[n]["dirty_"+e]=!0;this._enabledAttributes=null},getVerticesNumber:function(){return this._verticesNumber=this.attributes.position.value.length,this._verticesNumber},getEnabledAttributes:function(){if(this._enabledAttributes)return this._enabledAttributes;var e={},t=this.getVerticesNumber();for(var n in this.attributes){var r=this.attributes[n];r.value&&r.value.length&&r.value.length===t&&(e[n]=r)}return this._enabledAttributes=e,e},getDirtyAttributes:function(){var e={},t=this.getEnabledAttributes(),n=!0;for(var r in t){var i=t[r];if(this.cache.get("dirty_"+r)||this.cache.miss("dirty_"+r))e[r]=t[r],n=!1}if(!n)return e},getChunkNumber:function(){return this._arrayChunks.length},getBufferChunks:function(e){this.cache.use(e.__GUID__);var t=this.cache.getContext(),n=this.getDirtyAttributes(),r=this.cache.get("dirty_faces")||this.cache.miss("dirty_faces");if(n){this._updateAttributesAndIndicesArrays(n,r),this._updateBuffer(e,n,r);for(var i in n)t["dirty_"+i]=!1}return this.cache.get("chunks")},_updateAttributesAndIndicesArrays:function(e,t){var n=this,r={},i=this.getVerticesNumber(),s=this._verticesReorganizedMap,o={};for(var u in e){switch(B){case"byte":o[u]=Int8Array;break;case"ubyte":o[u]=Uint8Array;break;case"short":o[u]=Int16Array;break;case"ushort":o[u]=Uint16Array;break;default:o[u]=Float32Array}r[u]=0}var a=function(t){if(n._arrayChunks[t])return n._arrayChunks[t];var o={attributeArrays:{},indicesArray:null};for(var u in e)o.attributeArrays[u]=null;for(var u in r)r[u]=0;for(var a=0;a<i;a++)s[a]=-1;return n._arrayChunks.push(o),o},f=Object.keys(e);if(i>this.chunkSize&&this.useFaces){var l=0,c=0,h,p=[0],d=[];for(v=0;v<i;v++)d[v]=-1,s[v]=-1;if(t&&this._reorganizedFaces.length!==this.faces.length)for(v=0;v<this.faces.length;v++)this._reorganizedFaces[v]=[0,0,0];h=a(c);for(var v=0;v<this.faces.length;v++){var m=this.faces[v],g=this._reorganizedFaces[v],y=m[0],b=m[1],w=m[2];l+3>this.chunkSize&&(c++,p[c]=v,l=0,h=a(c));var E=s[y]===-1,S=s[b]===-1,x=s[w]===-1;for(var T=0;T<f.length;T++){var u=f[T],N=h.attributeArrays[u],C=e[u].value,k=e[u].size;N||(N=h.attributeArrays[u]=[]);if(k===1)E&&(N[r[u]++]=C[y]),S&&(N[r[u]++]=C[b]),x&&(N[r[u]++]=C[w]);else{if(E)for(var L=0;L<k;L++)N[r[u]++]=C[y][L];if(S)for(var L=0;L<k;L++)N[r[u]++]=C[b][L];if(x)for(var L=0;L<k;L++)N[r[u]++]=C[w][L]}}E?(s[y]=l,g[0]=l,l++):g[0]=s[y],S?(s[b]=l,g[1]=l,l++):g[1]=s[b],x?(s[w]=l,g[2]=l,l++):g[2]=s[w]}for(var A=0;A<this._arrayChunks.length;A++){var O=this._arrayChunks[A];for(var u in O.attributeArrays){var M=O.attributeArrays[u];M instanceof Array&&(O.attributeArrays[u]=new o[u](M))}}if(t){var _,D,P,O;for(var A=0;A<this._arrayChunks.length;A++){_=p[A],D=p[A+1]||this.faces.length,P=0,O=this._arrayChunks[A];var H=O.indicesArray;H||(H=O.indicesArray=new Uint16Array((D-_)*3));for(var v=_;v<D;v++)H[P++]=this._reorganizedFaces[v][0],H[P++]=this._reorganizedFaces[v][1],H[P++]=this._reorganizedFaces[v][2]}}}else{var O=a(0);if(this.useFaces){var H=O.indicesArray;H||(H=O.indicesArray=new Uint16Array(this.faces.length*3));var P=0;for(var v=0;v<this.faces.length;v++)H[P++]=this.faces[v][0],H[P++]=this.faces[v][1],H[P++]=this.faces[v][2]}for(var u in e){var C=e[u].value,B=e[u].type,k=e[u].size,N=O.attributeArrays[u];N||(N=O.attributeArrays[u]=new o[u](i*k));if(k===1)for(var v=0;v<C.length;v++)N[v]=C[v];else{var P=0;for(var v=0;v<C.length;v++)for(var L=0;L<k;L++)N[P++]=C[v][L]}}}},_updateBuffer:function(e,t,n){var r=this.cache.get("chunks");if(!r){r=[];for(var i=0;i<this._arrayChunks.length;i++)r[i]={attributeBuffers:{},indicesBuffer:null};this.cache.put("chunks",r)}for(var i=0;i<r.length;i++){var s=r[i];s||(s=r[i]={attributeBuffers:{},indicesBuffer:null});var o=s.attributeBuffers,u=s.indicesBuffer,a=this._arrayChunks[i],f=a.attributeArrays,l=a.indicesArray;for(var c in t){var h=t[c],p=h.value,d=h.type,v=h.semantic,m=h.size,g=o[c],y;g?y=g.buffer:y=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,y),e.bufferData(e.ARRAY_BUFFER,f[c],e[this.hint]),o[c]={type:d,buffer:y,size:m,semantic:v}}n&&this.useFaces&&(u||(u=s.indicesBuffer={buffer:e.createBuffer(),count:l.length}),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,u.buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,l,e[this.hint]))}},generateVertexNormals:function(){var e=this.faces,t=e.length,n=this.attributes.position.value,r=this.attributes.normal.value,s=i.create();v12=i.create(),v23=i.create();var o=n.length-r.length;for(var u=0;u<r.length;u++)i.set(r[u],0,0,0);for(var u=r.length;u<n.length;u++)r[u]=[0,0,0];for(var a=0;a<this.faces.length;a++){var f=e[a],l=f[0],c=f[1],h=f[2],p=n[l],d=n[c],v=n[h];i.sub(v12,p,d),i.sub(v23,d,v),i.cross(s,v12,v23),i.add(r[l],r[l],s),i.add(r[c],r[c],s),i.add(r[h],r[h],s)}for(var u=0;u<r.length;u++)i.normalize(r[u],r[u]);this._normalType="vertex"},generateFaceNormals:function(){this.isUniqueVertex()||this.generateUniqueVertex();var e=this.faces,t=e.length,n=this.attributes.position.value,r=this.attributes.normal.value,s=i.create();v12=i.create(),v23=i.create();var o=r.length===n.length;for(var u=0;u<t;u++){var a=e[u],l=a[0],c=a[1],h=a[2],p=n[l],d=n[c],v=n[h];i.sub(v12,p,d),i.sub(v23,d,v),i.cross(s,v12,v23),o?(i.copy(r[l],s),i.copy(r[c],s),i.copy(r[h],s)):r[l]=r[c]=r[h]=f.call(s)}this._normalType="face"},generateTangents:function(){var e=this.attributes.texcoord0.value,t=this.attributes.position.value,n=this.attributes.tangent.value,r=this.attributes.normal.value,s=[],o=[],u=this.getVerticesNumber();for(var a=0;a<u;a++)s[a]=[0,0,0],o[a]=[0,0,0];var f=[0,0,0],l=[0,0,0];for(var a=0;a<this.faces.length;a++){var c=this.faces[a],h=c[0],p=c[1],d=c[2],v=e[h],m=e[p],g=e[d],y=t[h],b=t[p],w=t[d],E=b[0]-y[0],S=w[0]-y[0],x=b[1]-y[1],T=w[1]-y[1],N=b[2]-y[2],C=w[2]-y[2],k=m[0]-v[0],L=g[0]-v[0],A=m[1]-v[1],O=g[1]-v[1],M=1/(k*O-A*L);f[0]=(O*E-A*S)*M,f[1]=(O*x-A*T)*M,f[2]=(O*N-A*C)*M,l[0]=(k*S-L*E)*M,l[1]=(k*T-L*x)*M,l[2]=(k*C-L*N)*M,i.add(s[h],s[h],f),i.add(s[p],s[p],f),i.add(s[d],s[d],f),i.add(o[h],o[h],l),i.add(o[p],o[p],l),i.add(o[d],o[d],l)}var _=[0,0,0,0],D=[0,0,0];for(var a=0;a<u;a++){var P=r[a],H=s[a];i.scale(_,P,i.dot(P,H)),i.sub(_,H,_),i.normalize(_,_),i.cross(D,P,H),_[3]=i.dot(D,o[a])<0?-1:1,n[a]=_.slice()}},isUniqueVertex:function(){return this.faces.length&&this.useFaces?this.getVerticesNumber()===this.faces.length*3:!0},generateUniqueVertex:function(){function s(e){for(var t in r){var n=r[t].value,i=n[0].length||1;i===1?n.push(n[e]):n.push(f.call(n[e]))}}var e=[];for(var t=0;t<this.getVerticesNumber();t++)e[t]=0;var n=this.getVerticesNumber(),r=this.getEnabledAttributes(),i=this.faces;for(var t=0;t<i.length;t++){var o=i[t],u=o[0],a=o[1],l=o[2];e[u]>0&&(s(u),o[0]=n,n++),e[a]>0&&(s(a),o[1]=n,n++),e[l]>0&&(s(l),o[2]=n,n++),e[u]++,e[a]++,e[l]++}this.dirty()},generateBarycentric:function(){var e=[1,0,0],t=[0,0,1],n=[0,1,0];return function(){this.isUniqueVertex()||this.generateUniqueVertex();var r=this.attributes.barycentric.value;if(r.length==this.faces.length*3)return;var i,s,o,u;for(var a=0;a<this.faces.length;a++)u=this.faces[a],i=u[0],s=u[1],o=u[2],r[i]=e,r[s]=t,r[o]=n}}(),applyMatrix:function(e){var t=this.attributes.position.value,n=this.attributes.normal.value;e=e._array;for(var r=0;r<t.length;r++)i.transformMat4(t[r],t[r],e);var s=u.create();u.invert(s,e),u.transpose(s,s);for(var r=0;r<n.length;r++)i.transformMat4(n[r],n[r],s)},dispose:function(e){}});return l}),r("3d/geometry/plane",["require","../geometry"],function(e){var t=e("../geometry"),n=t.derive(function(){return{widthSegments:1,heightSegments:1}},function(){var e=this.heightSegments,t=this.widthSegments,n=this.attributes.position.value,r=this.attributes.texcoord0.value,i=this.attributes.normal.value,s=this.faces;for(var o=0;o<=e;o++){var u=o/e;for(var a=0;a<=t;a++){var f=a/t;n.push([2*f-1,2*u-1,0]),r&&r.push([f,u]),i&&i.push([0,0,1]);if(a<t&&o<e){var l=a+o*(t+1);s.push([l,l+1,l+t+1]),s.push([l+t+1,l+1,l+t+2])}}}});return n}),r("3d/shader",["require","core/base","glmatrix","util/util","_"],function(e){function h(e){var t=e.split("\n");for(var n=0,r=t.length;n<r;n++)t[n]=n+1+": "+t[n];return t.join("\n")}var t=e("core/base"),n=e("glmatrix"),r=n.mat2;mat3=n.mat3,mat4=n.mat4,util=e("util/util"),_=e("_");var i=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+(\w+)?(\[.*?\])?\s*(:\s*([\S\s]+?))?;/g,s=/attribute\s+(float|int|vec2|vec3|vec4)\s+(\w*)\s*(:\s*(\w+))?;/g,o={bool:"1i","int":"1i",sampler2D:"t",samplerCube:"t","float":"1f",vec2:"2f",vec3:"3f",vec4:"4f",ivec2:"2i",ivec3:"3i",ivec4:"4i",mat2:"m2",mat3:"m3",mat4:"m4"},u={bool:function(){return!0},"int":function(){return 0},"float":function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return new Float32Array(2)},vec3:function(){return new Float32Array(3)},vec4:function(){return new Float32Array(4)},ivec2:function(){return new Int32Array(2)},ivec3:function(){return new Int32Array(3)},ivec4:function(){return new Int32Array(4)},mat2:function(){return r.create()},mat3:function(){return mat3.create()},mat4:function(){return mat4.create()},array:function(){return[]}},a=["POSITION","NORMAL","BINORMAL","TANGENT","TEXCOORD","TEXCOORD_0","TEXCOORD_1","COLOR","WORLD","VIEW","PROJECTION","WORLDVIEW","VIEWPROJECTION","WORLDVIEWPROJECTION","WORLDINVERSE","VIEWINVERSE","PROJECTIONINVERSE","WORLDVIEWINVERSE","VIEWPROJECTIONINVERSE","WORLDVIEWPROJECTIONINVERSE","WORLDTRANSPOSE","VIEWTRANSPOSE","PROJECTIONTRANSPOSE","WORLDVIEWTRANSPOSE","VIEWPROJECTIONTRANSPOSE","WORLDVIEWPROJECTIONTRANSPOSE","WORLDINVERSETRANSPOSE","VIEWINVERSETRANSPOSE","PROJECTIONINVERSETRANSPOSE","WORLDVIEWINVERSETRANSPOSE","VIEWPROJECTIONINVERSETRANSPOSE","WORLDVIEWPROJECTIONINVERSETRANSPOSE"],f={},l={},c=t.derive(function(){return{__GUID__:util.genGUID(),vertex:"",fragment:"",precision:"mediump",semantics:{},uniformTemplates:{},attributeTemplates:{},vertexDefines:{},fragmentDefines:{},lightNumber:{},_textureStatus:{},_vertexProcessed:"",_fragmentProcessed:"",_program:null}},function(){this.update()},{setVertex:function(e){this.vertex=e,this.update()},setFragment:function(e){this.fragment=e,_caches,this.update()},bind:function(e){this.cache.use(e.__GUID__,{locations:{},attriblocations:{}});if(this.cache.get("dirty")||this.cache.miss("program"))this._buildProgram(e,this._vertexProcessed,this._fragmentProcessed),this.cache.put("dirty",!1);e.useProgram(this.cache.get("program"))},dirty:function(){for(var e in this.cache._caches){var t=this.cache._caches[e];t.dirty=!0,t.locations={},t.attriblocations={}}},update:function(e){if(this.vertex!==this._vertexPrev||this.fragment!==this._fragmentPrev||e)this._parseImport(),this.semantics={},this._textureStatus={},this._parseUniforms(),this._parseAttributes(),this._vertexPrev=this.vertex,this._fragmentPrev=this.fragment;this._addDefine(),this.dirty()},enableTexture:function(e,t){var n=this._textureStatus[e];if(n){var r=n.enabled;if(r)return;n.enabled=!0;var t=typeof t=="undefined"||!0;t&&this.update()}},enableTexturesAll:function(e){for(var t in this._textureStatus)this._textureStatus[t].enabled=!0;var e=typeof e=="undefined"||!0;e&&this.update()},disableTexture:function(e,t){var n=this._textureStatus[e];if(n){var r=!n.enabled;if(r)return;n.enabled=!1;var t=typeof t=="undefined"||!0;t&&this.update()}},disableTexturesAll:function(e,t){for(var e in this._textureStatus)this._textureStatus[e].enabled=!1;var t=typeof t=="undefined"||!0;t&&this.update()},setUniform:function(e,t,n,r){var i=this.cache.get("program"),s=this.cache.get("locations"),o=s[n];if(o===null)return;if(!o){o=e.getUniformLocation(i,n);if(o===null){s[n]=null;return}s[n]=o}switch(t){case"1i":e.uniform1i(o,r);break;case"1f":e.uniform1f(o,r);break;case"1fv":e.uniform1fv(o,r);break;case"1iv":e.uniform1iv(o,r);break;case"2iv":e.uniform2iv(o,r);break;case"2fv":e.uniform2fv(o,r);break;case"3iv":e.uniform3iv(o,r);break;case"3fv":e.uniform3fv(o,r);break;case"4iv":e.uniform4iv(o,r);break;case"4fv":e.uniform4fv(o,r);break;case"2i":e.uniform2i(o,r[0],r[1]);break;case"2f":e.uniform2f(o,r[0],r[1]);break;case"3i":e.uniform3i(o,r[0],r[1],r[2]);break;case"3f":e.uniform3f(o,r[0],r[1],r[2]);break;case"4i":e.uniform4i(o,r[0],r[1],r[2],r[3]);break;case"4f":e.uniform4f(o,r[0],r[1],r[2],r[3]);break;case"m2":e.uniformMatrix2fv(o,!1,r);break;case"m3":e.uniformMatrix3fv(o,!1,r);break;case"m4":e.uniformMatrix4fv(o,!1,r);break;case"m2v":var u=4;case"m3v":var u=9;case"m4v":var u=16;if(r instanceof Array){var a=new Float32Array(r.length*u),f=0;for(var l=0;l<r.length;l++){var c=r[l];for(var h=0;h<c.length;h++)a[f++]=c[h]}e.uniformMatrix4fv(o,!1,a)}else r instanceof Float32Array&&e.uniformMatrix4fv(o,!1,r)}},enableAttributes:function(e,t){var n=this.cache.get("program"),r=this.cache.get("attriblocations");typeof t=="string"&&(t=Array.prototype.slice.call(arguments,1));var i=l[e.__GUID__];i||(i=l[e.__GUID__]=[]);for(var s in this.attributeTemplates){var o=r[s];if(typeof o=="undefined"){o=e.getAttribLocation(n,s);if(o===-1)continue;r[s]=o}t.indexOf(s)>=0?i[o]||(e.enableVertexAttribArray(o),i[o]=!0):i[o]&&(e.disableVertexAttribArray(o),i[o]=!1)}},setMeshAttribute:function(e,t,n,r){var i;switch(n){case"byte":i=e.BYTE;break;case"ubyte":i=e.UNSIGNED_BYTE;break;case"short":i=e.SHORT;break;case"ushort":i=e.UNSIGNED_SHORT;break;default:i=e.FLOAT}var s=this.cache.get("program"),o=this.cache.get("attriblocations"),u=o[t];if(typeof u=="undefined"){u=e.getAttribLocation(s,t);if(u===-1)return;o[t]=u}e.vertexAttribPointer(u,r,i,!1,0,0)},_parseImport:function(){this._vertexProcessedWithoutDefine=c.parseImport(this.vertex),this._fragmentProcessedWithoutDefine=c.parseImport(this.fragment)},_addDefine:function(){var e=[];_.each(this.lightNumber,function(t,n){t&&e.push("#define "+n.toUpperCase()+"_NUMBER "+t)}),_.each(this._textureStatus,function(t,n){t.enabled&&t.shaderType==="vertex"&&e.push("#define "+n.toUpperCase()+"_ENABLED")}),_.each(this.vertexDefines,function(t,n){t===null?e.push("#define "+n):e.push("#define "+n+" "+t.toString())}),this._vertexProcessed=e.join("\n")+"\n"+this._vertexProcessedWithoutDefine,e=[],_.each(this.lightNumber,function(t,n){t&&e.push("#define "+n+"_NUMBER "+t)}),_.each(this._textureStatus,function(t,n){t.enabled&&t.shaderType==="fragment"&&e.push("#define "+n.toUpperCase()+"_ENABLED")}),_.each(this.fragmentDefines,function(t,n){t===null?e.push("#define "+n):e.push("#define "+n+" "+t.toString())});var t=e.join("\n")+"\n"+this._fragmentProcessedWithoutDefine;this._fragmentProcessed=["precision",this.precision,"float"].join(" ")+";\n"+t},_parseUniforms:function(){function r(r,i,s,f,l,c){if(i&&s){var h=o[i],p=!0;if(h){if(i==="sampler2D"||i==="samplerCube")t._textureStatus[s]={enabled:!1,shaderType:n};f&&(h+="v");if(c)if(a.indexOf(c)<0)if(c==="unconfigurable")p=!1;else{var d=t._parseDefaultValue(i,c);d?c="":console.warn('Unkown semantic "'+c+'"')}else t.semantics[c]={symbol:s,type:h},p=!1;p&&(e[s]={type:h,value:f?u.array:d||u[i],semantic:c||null})}return["uniform",i,s,f].join(" ")+";\n"}}var e={},t=this,n="vertex";this._vertexProcessedWithoutDefine=this._vertexProcessedWithoutDefine.replace(i,r),n="fragment",this._fragmentProcessedWithoutDefine=this._fragmentProcessedWithoutDefine.replace(i,r),this.uniformTemplates=e},_parseDefaultValue:function(e,t){var n=/\[\s*(.*)\s*\]/;if(e==="vec2"||e==="vec3"||e==="vec4"){var r=n.exec(t)[1];if(r){var i=r.split(/\s*,\s*/);return function(){return new Float32Array(i)}}return}if(e==="bool")return function(){return t.toLowerCase()==="true"?!0:!1};if(e==="float")return function(){return parseFloat(t)}},createUniforms:function(){var e={};return _.each(this.uniformTemplates,function(t,n){e[n]={type:t.type,value:t.value()}}),e},_parseAttributes:function(){function n(n,r,i,s,o){if(r&&i){var u=1;switch(r){case"vec4":u=4;break;case"vec3":u=3;break;case"vec2":u=2;break;case"float":u=1}e[i]={type:"float",size:u,semantic:o||null},o&&(a.indexOf(o)<0?console.warn('Unkown semantic "'+o+'"'):t.semantics[o]={symbol:i,type:r})}return["attribute",r,i].join(" ")+";\n"}var e={},t=this;this._vertexProcessedWithoutDefine=this._vertexProcessedWithoutDefine.replace(s,n),this.attributeTemplates=e},_buildProgram:function(e,t,n){this.cache.get("program")&&e.deleteProgram(this.cache.get("program"));var r=e.createProgram();try{var i=this._compileShader(e,"vertex",t),s=this._compileShader(e,"fragment",n);e.attachShader(r,i),e.attachShader(r,s),e.linkProgram(r);if(!e.getProgramParameter(r,e.LINK_STATUS))throw new Error("Could not initialize shader\nVALIDATE_STATUS: "+e.getProgramParameter(r,e.VALIDATE_STATUS)+", gl error ["+e.getError()+"]")}catch(o){if(f[this.__GUID__])return;throw f[this.__GUID__]=this,o}e.deleteShader(i),e.deleteShader(s),this.cache.put("program",r)},_compileShader:function(e,t,n){var r=e.createShader(t==="fragment"?e.FRAGMENT_SHADER:e.VERTEX_SHADER);e.shaderSource(r,n),e.compileShader(r);if(!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error([e.getShaderInfoLog(r),h(n)].join("\n"));return r},dispose:function(){}}),p=/(@import)\s*([0-9a-zA-Z_\-\.]*)/g;c.parseImport=function(e){return e=e.replace(p,function(e,t,n){if(v[n])return c.parseImport(v[n])}),e};var d=/(@export)\s*([0-9a-zA-Z_\-\.]*)\s*\n([\s\S]*?)@end/g;c.import=function(e){e.replace(d,function(e,t,n,r){return v[n]=r,r})};var v={};return c.source=function(e){var t=v[e];if(!t){console.error('Shader "'+e+'" not existed in library');return}return t},c}),r("3d/texture",["require","core/base","_"],function(e){var t=e("core/base"),n=e("_"),r=t.derive(function(){return{width:512,height:512,type:"UNSIGNED_BYTE",format:"RGBA",wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE",minFilter:"LINEAR_MIPMAP_LINEAR",magFilter:"LINEAR",generateMipmaps:!0,anisotropic:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!1,NPOT:!1}},{getWebGLTexture:function(e){return this.cache.use(e.__GUID__),this.cache.miss("webgl_texture")&&(this.cache.put("webgl_texture",e.createTexture()),this.cache.put("dirty",!0)),this.cache.get("dirty")&&(this.update(e),this.cache.put("dirty",!1)),this.cache.get("webgl_texture")},bind:function(){},unbind:function(){},dirty:function(){for(var e in this.cache._caches)this.cache._caches[e].dirty=!0},update:function(e){},beforeUpdate:function(e){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment),this.fallBack()},fallBack:function(){var e=this.isPowerOfTwo();this.format==="DEPTH_COMPONENT"&&(this.generateMipmaps=!1),!e||!this.generateMipmaps?(this.NPOT=!0,this._minFilterOriginal=this.minFilter,this._magFilterOriginal=this.magFilter,this._wrapSOriginal=this.wrapS,this._wrapTOriginal=this.wrapT,this.minFilter.indexOf("NEAREST")==0?this.minFilter="NEAREST":this.minFilter="LINEAR",this.magFilter.indexOf("NEAREST")==0?this.magFilter="NEAREST":this.magFilter="LINEAR",this.wrapS="CLAMP_TO_EDGE",this.wrapT="CLAMP_TO_EDGE"):(this._minFilterOriginal&&(this.minFilter=this._minFilterOriginal),this._magFilterOriginal&&(this.magFilter=this._magFilterOriginal),this._wrapSOriginal&&(this.wrapS=this._wrapSOriginal),this._wrapTOriginal&&(this.wrapT=this._wrapTOriginal))},nextHighestPowerOfTwo:function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},dispose:function(e){this.cache.use(e.__GUID__),e.deleteTexture(this.cache.get("webgl_texture"))},isRenderable:function(){},isPowerOfTwo:function(){}});return r}),r("3d/webglinfo",[],function(){var e=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","EXT_texture_filter_anisotropic","EXT_draw_buffers"],t=!1,n={},r={initialize:function(r){if(t)return;for(var i=0;i<e.length;i++){var s=e[i],o=r.getExtension(s);o||(o=r.getExtension("MOZ_"+s)),o||(o=r.getExtension("WEBKIT_"+s)),n[s]=o}t=!0},getExtension:function(e){return n[e]}};return r}),r("3d/texture/texture2d",["require","../texture","../webglinfo"],function(e){var t=e("../texture"),n=e("../webglinfo"),r=t.derive({image:null,pixels:null},{update:function(e){e.bindTexture(e.TEXTURE_2D,this.cache.get("webgl_texture")),this.beforeUpdate(e);var t=e[this.format.toUpperCase()],r=e[this.type.toUpperCase()];e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e[this.wrapS.toUpperCase()]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[this.wrapT.toUpperCase()]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[this.magFilter.toUpperCase()]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[this.minFilter.toUpperCase()]);var i=n.getExtension("EXT_texture_filter_anisotropic");i&&this.anisotropic>1&&e.texParameterf(e.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),this.image?this.image.complete&&e.texImage2D(e.TEXTURE_2D,0,t,t,r,this.image):e.texImage2D(e.TEXTURE_2D,0,t,this.width,this.height,0,t,r,this.pixels),!this.NPOT&&this.generateMipmaps&&e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)},isPowerOfTwo:function(){if(this.image)var e=this.image.width,t=this.image.height;else var e=this.width,t=this.height;return(e&e-1)===0&&(t&t-1)===0},isRenderable:function(){return this.image?this.image.complete:this.width&&this.height},bind:function(e){e.bindTexture(e.TEXTURE_2D,this.getWebGLTexture(e))},unbind:function(e){e.bindTexture(e.TEXTURE_2D,null)}});return r}),r("3d/texture/texturecube",["require","../texture","../webglinfo","_"],function(e){var t=e("../texture"),n=e("../webglinfo"),r=e("_"),i={px:"TEXTURE_CUBE_MAP_POSITIVE_X",py:"TEXTURE_CUBE_MAP_POSITIVE_Y",pz:"TEXTURE_CUBE_MAP_POSITIVE_Z",nx:"TEXTURE_CUBE_MAP_NEGATIVE_X",ny:"TEXTURE_CUBE_MAP_NEGATIVE_Y",nz:"TEXTURE_CUBE_MAP_NEGATIVE_Z"},s=t.derive({image:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},pixels:{px:null,nx:null,py:null,ny:null,pz:null,nz:null}},{update:function(e){e.bindTexture(e.TEXTURE_CUBE_MAP,this.cache.get("webgl_texture")),this.beforeUpdate(e);var t=e[this.format.toUpperCase()],s=e[this.type.toUpperCase()];e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e[this.wrapS.toUpperCase()]),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e[this.wrapT.toUpperCase()]),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e[this.magFilter.toUpperCase()]),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e[this.minFilter.toUpperCase()]);var o=n.getExtension("EXT_texture_filter_anisotropic");o&&this.anisotropic>1&&e.texParameterf(e.TEXTURE_CUBE_MAP,o.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),r.each(this.image,function(n,r){n?e.texImage2D(e[i[r]],0,t,t,s,n):e.texImage2D(e[i[r]],0,t,this.width,this.height,0,t,s,this.pixels[r])},this),!this.NPOT&&this.generateMipmaps&&e.generateMipmap(e.TEXTURE_CUBE_MAP),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},bind:function(e){e.bindTexture(e.TEXTURE_CUBE_MAP,this.getWebGLTexture(e))},unbind:function(e){e.bindTexture(e.TEXTURE_CUBE_MAP,null)},isPowerOfTwo:function(){function e(e){return e&e-1===0}return this.image.px?e(this.image.px.width)&&e(this.image.px.height):e(this.width)&&e(this.height)},isRenderable:function(){return this.image.px?this.image.px.complete&&this.image.nx.complete&&this.image.py.complete&&this.image.ny.complete&&this.image.pz.complete&&this.image.nz.complete:this.width&&this.height}});return s}),r("3d/material",["require","core/base","./shader","util/util","./texture","./texture/texture2d","./texture/texturecube","_"],function(e){var t=e("core/base"),n=e("./shader"),r=e("util/util"),i=e("./texture"),s=e("./texture/texture2d"),o=e("./texture/texturecube"),u=e("_"),a=t.derive(function(){var e=r.genGUID();return{__GUID__:e,name:"MATERIAL_"+e,uniforms:{},shader:null,depthTest:!0,depthWrite:!0,transparent:!1,blend:null,autoBindingLights:!0}},function(){this.shader&&this.attachShader(this.shader)},{bind:function(e){var t=0;u.each(this.uniforms,function(n,r){if(n.value===null)return;if(n.value instanceof Array&&!n.value.length)return;if(n.value.instanceof&&n.value.instanceof(i)){var s=n.value;if(!s.isRenderable())return;e.activeTexture(e.TEXTURE0+t),s.bind(e),this.shader.setUniform(e,"1i",r,t),t++}else if(n.value instanceof Array){var o=n.value[0];if(o&&o.instanceof&&o.instanceof(i)){var u=[];for(var a=0;a<n.value.length;a++){var s=n.value[a];if(!s.isRenderable())continue;e.activeTexture(e.TEXTURE0+t),s.bind(e),u.push(t++)}this.shader.setUniform(e,"1iv",r,u)}else this.shader.setUniform(e,n.type,r,n.value)}else this.shader.setUniform(e,n.type,r,n.value)},this)},setUniform:function(e,t){var n=this.uniforms[e];n&&(n.value=t)},setUniforms:function(e){for(var t in e){var n=e[t];this.setUniform(t,n)}},getUniform:function(e){var t=this.uniforms[e];if(t)return t.value},attachShader:function(e){this.uniforms=e.createUniforms(),this.shader=e},detachShader:function(){this.shader=null,this.uniforms={}}});return a}),r("3d/mesh",["require","./node","_"],function(e){var t=e("./node"),n=e("_"),r=0,i=t.derive(function(){return{material:null,geometry:null,mode:"TRIANGLES",receiveShadow:!0,castShadow:!0,skeleton:null}},{render:function(e,t){var n=e.gl;this.trigger("beforerender",n);var i=t||this.material,s=i.shader,o=this.geometry,u=n[this.mode.toUpperCase()];if(this.skeleton){var a=this.skeleton.getBoneMatricesArray();s.setUniform(n,"m4v","boneMatrices",a)}var f=o.getBufferChunks(n);for(var l=0;l<f.length;l++){currentDrawID=n.__GUID__+"_"+o.__GUID__+"_"+l;var c=f[l],h=c.attributeBuffers,p=c.indicesBuffer;if(currentDrawID!==r){r=currentDrawID,availableAttributes={};for(var d in h){var v=h[d],m=v.semantic;if(m)var g=s.semantics[m],y=g&&g.symbol;else var y=d;y&&s.attributeTemplates[y]&&(availableAttributes[y]=v)}s.enableAttributes(n,Object.keys(availableAttributes));for(var y in availableAttributes){var v=availableAttributes[y],b=v.buffer;n.bindBuffer(n.ARRAY_BUFFER,b),s.setMeshAttribute(n,y,v.type,v.size)}}o.useFaces?(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,p.buffer),n.drawElements(u,p.count,n.UNSIGNED_SHORT,0)):n.drawArrays(u,0,o.vertexCount)}var w={faceNumber:o.faces.length,vertexNumber:o.getVerticesNumber(),drawcallNumber:f.length};return this.trigger("afterrender",n,w),w},bindGeometry:function(e){var t=this.material.shader,n=this.geometry}});return i.materialChanged=function(){r=0},i}),r("3d/compositor/shaders/vertex.essl",[],function(){return"uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\n\nvarying vec2 v_Texcoord;\n\nvoid main(){\n\n    v_Texcoord = texcoord;\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n}"}),r("3d/compositor/shaders/coloradjust.essl",[],function(){return'@export buildin.compositor.coloradjust\n\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float brightness;\nuniform float contrast;\nuniform float exposure;\nuniform float gamma;\nuniform float saturation;\n\n// Values from "Graphics Shaders: Theory and Practice" by Bailey and Cunningham\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n    vec4 tex = texture2D( texture, v_Texcoord);\n\n    // brightness\n    vec3 color = clamp( tex.rgb + vec3(brightness), 0.0, 1.0);\n    // contrast\n    color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\n    // exposure\n    color = clamp( color * pow(2.0, exposure), 0.0, 1.0);\n    // gamma\n    color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);\n    // saturation\n    float luminance = dot( color, w );\n    color = mix(vec3(luminance), color, saturation);\n    \n    gl_FragColor = vec4(color, tex.a);\n}\n\n@end'}),r("3d/compositor/shaders/blur.essl",[],function(){return"/**\n *  http://www.gamerendering.com/2008/10/11/gaussian-blur-filter-shader/\n */\n\n@export buildin.compositor.gaussian_blur_v\n\nuniform sampler2D texture; // the texture with the scene you want to blur\nvarying vec2 v_Texcoord;\n \nuniform float blurSize : 3.0; \nuniform float imageWidth : 512.0;\n\nvoid main(void)\n{\n   vec4 sum = vec4(0.0);\n \n   // blur in y (vertical)\n   // take nine samples, with the distance blurSize between them\n   sum += texture2D(texture, vec2(v_Texcoord.x - 4.0*blurSize/imageWidth, v_Texcoord.y)) * 0.05;\n   sum += texture2D(texture, vec2(v_Texcoord.x - 3.0*blurSize/imageWidth, v_Texcoord.y)) * 0.09;\n   sum += texture2D(texture, vec2(v_Texcoord.x - 2.0*blurSize/imageWidth, v_Texcoord.y)) * 0.12;\n   sum += texture2D(texture, vec2(v_Texcoord.x - blurSize/imageWidth, v_Texcoord.y)) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y)) * 0.16;\n   sum += texture2D(texture, vec2(v_Texcoord.x + blurSize/imageWidth, v_Texcoord.y)) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x + 2.0*blurSize/imageWidth, v_Texcoord.y)) * 0.12;\n   sum += texture2D(texture, vec2(v_Texcoord.x + 3.0*blurSize/imageWidth, v_Texcoord.y)) * 0.09;\n   sum += texture2D(texture, vec2(v_Texcoord.x + 4.0*blurSize/imageWidth, v_Texcoord.y)) * 0.05;\n \n   gl_FragColor = sum;\n}\n\n@end\n\n@export buildin.compositor.gaussian_blur_h\n\nuniform sampler2D texture; // this should hold the texture rendered by the horizontal blur pass\nvarying vec2 v_Texcoord;\n \nuniform float blurSize : 3.0;\nuniform float imageHeight : 512.0;\n \nvoid main(void)\n{\n   vec4 sum = vec4(0.0);\n \n   // blur in y (vertical)\n   // take nine samples, with the distance blurSize between them\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y - 4.0*blurSize/imageHeight)) * 0.05;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y - 3.0*blurSize/imageHeight)) * 0.09;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y - 2.0*blurSize/imageHeight)) * 0.12;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y - blurSize/imageHeight)) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y)) * 0.16;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y + blurSize/imageHeight)) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y + 2.0*blurSize/imageHeight)) * 0.12;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y + 3.0*blurSize/imageHeight)) * 0.09;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y + 4.0*blurSize/imageHeight)) * 0.05;\n \n   gl_FragColor = sum;\n}\n\n@end\n\n@export buildin.compositor.box_blur\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 3.0;\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n\n   vec4 tex = texture2D(texture, v_Texcoord);\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   tex += texture2D(texture, v_Texcoord + vec2(offset.x, 0.0) );\n   tex += texture2D(texture, v_Texcoord + vec2(offset.x, offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(-offset.x, offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(0.0, offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(-offset.x, 0.0) );\n   tex += texture2D(texture, v_Texcoord + vec2(-offset.x, -offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(offset.x, -offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(0.0, -offset.y) );\n\n   tex /= 9.0;\n   return tex;\n}\n\n@end\n\n// http://www.slideshare.net/DICEStudio/five-rendering-ideas-from-battlefield-3-need-for-speed-the-run\n@export buildin.compositor.hexagonal_blur_mrt_1\n\n// MRT in chrome\n// https://www.khronos.org/registry/webgl/sdk/tests/conformance/extensions/ext-draw-buffers.html\n#extension GL_EXT_draw_buffers : require\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 2.0;\n\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color = vec4(0.0);\n   // Top\n   for(int i = 0; i < 10; i++){\n      color += 1.0/10.0 * texture2D(texture, v_Texcoord + vec2(0.0, offset.y * float(i)) );\n   }\n   gl_FragData[0] = color;\n   vec4 color2 = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 10; i++){\n      color2 += 1.0/10.0 * texture2D(texture, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   gl_FragData[1] = (color + color2) / 2.0;\n}\n\n@end\n\n@export buildin.compositor.hexagonal_blur_mrt_2\n\nuniform sampler2D texture0;\nuniform sampler2D texture1;\n\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 2.0;\n\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color1 = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 10; i++){\n      color1 += 1.0/10.0 * texture2D(texture0, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   vec4 color2 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < 10; i++){\n      color2 += 1.0/10.0 * texture2D(texture1, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   gl_FragColor = (color1 + color2) / 2.0;\n}\n\n@end\n\n\n@export buildin.compositor.hexagonal_blur_1\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color = vec4(0.0);\n   // Top\n   for(int i = 0; i < 10; i++){\n      color += 1.0/10.0 * texture2D(texture, v_Texcoord + vec2(0.0, offset.y * float(i)) );\n   }\n   gl_FragColor = color;\n}\n\n@end\n\n@export buildin.compositor.hexagonal_blur_2\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 10; i++){\n      color += 1.0/10.0 * texture2D(texture, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   gl_FragColor = color;\n}\n@end\n\n@export buildin.compositor.hexagonal_blur_3\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\n\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform float imageWidth : 1.0;\nuniform float imageHeight : 1.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color1 = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 10; i++){\n      color1 += 1.0/10.0 * texture2D(texture1, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   vec4 color2 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < 10; i++){\n      color2 += 1.0/10.0 * texture2D(texture1, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   vec4 color3 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < 10; i++){\n      color3 += 1.0/10.0 * texture2D(texture2, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   gl_FragColor = (color1 + color2 + color3) / 3.0;\n}\n\n@end"}),r("3d/compositor/shaders/grayscale.essl",[],function(){return"\n@export buildin.compositor.grayscale\n\nvarying vec2 v_Texcoord;\n\nuniform sampler2D texture;\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n    vec4 tex = texture2D( texture, v_Texcoord );\n    float luminance = dot(tex.rgb, w);\n\n    gl_FragColor = vec4(vec3(luminance), tex.a);\n}\n\n@end"}),r("3d/compositor/shaders/lut.essl",[],function(){return"\n// https://github.com/BradLarson/GPUImage?source=c\n@export buildin.compositor.lut\n\nvarying vec2 v_Texcoord;\n\nuniform sampler2D texture;\nuniform sampler2D lookup;\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n\n    float blueColor = tex.b * 63.0;\n    \n    vec2 quad1;\n    quad1.y = floor(floor(blueColor) / 8.0);\n    quad1.x = floor(blueColor) - (quad1.y * 8.0);\n    \n    vec2 quad2;\n    quad2.y = floor(ceil(blueColor) / 8.0);\n    quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n    \n    vec2 texPos1;\n    texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n    texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n    \n    vec2 texPos2;\n    texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n    texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n    \n    vec4 newColor1 = texture2D(lookup, texPos1);\n    vec4 newColor2 = texture2D(lookup, texPos2);\n    \n    vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n    gl_FragColor = vec4(newColor.rgb, tex.w);\n}\n\n@end"}),r("3d/compositor/shaders/output.essl",[],function(){return"\n@export buildin.compositor.output\n\nvarying vec2 v_Texcoord;\n\nuniform sampler2D texture;\n\nvoid main()\n{\n    vec4 tex = texture2D( texture, v_Texcoord );\n\n    gl_FragColor = tex;\n}\n\n@end"}),r("3d/compositor/pass",["require","core/base","../scene","../camera/orthographic","../geometry/plane","../shader","../material","../mesh","../scene","./shaders/vertex.essl","../texture","../webglinfo","./shaders/coloradjust.essl","./shaders/blur.essl","./shaders/grayscale.essl","./shaders/lut.essl","./shaders/output.essl"],function(e){var t=e("core/base"),n=e("../scene"),r=e("../camera/orthographic"),i=e("../geometry/plane"),s=e("../shader"),o=e("../material"),u=e("../mesh"),n=e("../scene"),a=e("./shaders/vertex.essl"),f=e("../texture"),l=e("../webglinfo"),c=new i,h=new u({geometry:c}),p=new n,d=new r;p.add(h);var v=t.derive(function(){return{fragment:"",outputs:null,_material:null}},function(){var e=new s({vertex:a,fragment:this.fragment}),t=new o({shader:e});e.enableTexturesAll(),this._material=t},{setUniform:function(e,t){var n=this._material.uniforms[e];n&&(n.value=t)},bind:function(e,t){if(this.outputs){for(var n in this.outputs){var r=this.outputs[n];t.attach(e.gl,r,n)}t.bind(e)}},unbind:function(e,t){t.unbind(e)},render:function(e,t){var n=e.gl;h.material=this._material,t&&this.bind(e,t);var r=l.getExtension("EXT_draw_buffers");if(r){var i=[];for(var s in this.outputs)s=parseInt(s),s>=n.COLOR_ATTACHMENT0&&s<=n.COLOR_ATTACHMENT0+8&&i.push(s);r.drawBuffersEXT(i)}e.render(p,d,!0),t&&this.unbind(e,t)}});return s.import(e("./shaders/coloradjust.essl")),s.import(e("./shaders/blur.essl")),s.import(e("./shaders/grayscale.essl")),s.import(e("./shaders/lut.essl")),s.import(e("./shaders/output.essl")),v}),r("3d/framebuffer",["require","core/base","./texture/texture2d","./texture/texturecube","./webglinfo"],function(e){var t=e("core/base"),n=e("./texture/texture2d"),r=e("./texture/texturecube"),i=e("./webglinfo"),s=t.derive(function(){return{depthBuffer:!0,_attachedTextures:{}}},{bind:function(e){var t=e.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer(t)),this.cache.put("viewport",e.viewportInfo),e.setViewport(0,0,this.cache.get("width"),this.cache.get("height")),this.cache.miss("renderbuffer")&&this.depthBuffer&&!this.cache.get("depth_texture")&&this.cache.put("renderbuffer",t.createRenderbuffer());if(!this.cache.get("depth_texture")&&this.depthBuffer){var n=this.cache.get("width"),r=this.cache.get("height"),i=this.cache.get("renderbuffer");if(n!==this.cache.get("renderbuffer_width")||r!==this.cache.get("renderbuffer_height"))t.bindRenderbuffer(t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n,r),this.cache.put("renderbuffer_width",n),this.cache.put("renderbuffer_height",r),t.bindRenderbuffer(t.RENDERBUFFER,null);this.cache.get("renderbuffer_attached")||(t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,i),this.cache.put("renderbuffer_attached",!0))}},unbind:function(e){var t=e.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),this.cache.use(t.__GUID__);var n=this.cache.get("viewport");n&&e.setViewport(n.x,n.y,n.width,n.height);for(var i in this._attachedTextures){var s=this._attachedTextures[i];if(!s.NPOT&&s.generateMipmaps){var o=s.instanceof(r)?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D;t.bindTexture(o,s.getWebGLTexture(t)),t.generateMipmap(o),t.bindTexture(o,null)}}},getFrameBuffer:function(e){return this.cache.use(e.__GUID__),this.cache.miss("framebuffer")&&this.cache.put("framebuffer",e.createFramebuffer()),this.cache.get("framebuffer")},attach:function(e,t,n,r){if(!t.width){console.error("The texture attached to color buffer is not a valid.");return}this._renderBuffer&&this.depthBuffer&&(this._width!==t.width||this.height!==t.height)&&console.warn("Attached texture has different width or height, it will cause the render buffer recreate a storage "),e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer(e)),this.cache.put("width",t.width),this.cache.put("height",t.height),r=r||e.TEXTURE_2D,n=n||e.COLOR_ATTACHMENT0;if(n==="DEPTH_ATTACHMENT"){var s=i.getExtension("WEBGL_depth_texture");if(!s){console.error(" Depth texture is not supported by the browser ");return}if(t.format!=="DEPTH_COMPONENT"){console.error("The texture attached to depth buffer is not a valid.");return}this.cache.put("renderbuffer_attached",!1),this.cache.put("depth_texture",!0)}this._attachedTextures[n]=t,e.framebufferTexture2D(e.FRAMEBUFFER,n,r,t.getWebGLTexture(e),0),e.bindFramebuffer(e.FRAMEBUFFER,null)},detach:function(){},dispose:function(e){this.cache.use(e.__GUID__),this.cache.get("renderbuffer")&&e.deleteRenderbuffer(this.cache.get("renderbuffer")),this.cache.get("framebuffer")&&e.deleteFramebuffer(this.cache.get("framebuffer")),this.cache.clearContext()}});return s}),r("3d/compositor/graph/texturepool",["require","../../texture/texture2d","_"],function(e){function o(e){var t={width:512,height:512,type:"UNSIGNED_BYTE",format:"RGBA",wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE",minFilter:"LINEAR_MIPMAP_LINEAR",magFilter:"LINEAR",generateMipmaps:!0,anisotropy:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!1};n.defaults(e,t),u(e);var r="";for(var i in t){if(e[i])var s=e[i].toString();else var s=t[i].toString();r+=s}return r}function u(e){var t=a(e.width,e.height);e.format==="DEPTH_COMPONENT"&&(e.generateMipmaps=!1);if(!t||!e.generateMipmaps)e.minFilter.indexOf("NEAREST")==0?e.minFilter="NEAREST":e.minFilter="LINEAR",e.magFilter.indexOf("NEAREST")==0?e.magFilter="NEAREST":e.magFilter="LINEAR",e.wrapS="CLAMP_TO_EDGE",e.wrapT="CLAMP_TO_EDGE"}function a(e,t){return(e&e-1)===0&&(t&t-1)===0}var t=e("../../texture/texture2d"),n=e("_"),r={},i={get:function(e){var n=o(e);r.hasOwnProperty(n)||(r[n]=[]);var i=r[n];if(!i.length){var s=new t(e);return s}return i.pop()},put:function(e){var t=o(e);r.hasOwnProperty(t)||(r[t]=[]);var n=r[t];n.push(e)},clear:function(e){for(s in r)for(var t=0;t<r[s].length;t++)r[s][t].dispose(e);r={}}};return i}),r("3d/compositor/graph/node",["require","core/base","../pass","../../framebuffer","../../shader","./texturepool"],function(e){var t=e("core/base"),n=e("../pass"),r=e("../../framebuffer"),i=e("../../shader"),s=e("./texturepool"),o=t.derive(function(){return{name:"",inputs:{},outputs:null,shader:"",inputLinks:{},outputLinks:{},_textures:{},pass:null,_outputReferences:{}}},function(){if(this.shader){var e=new n({fragment:this.shader});this.pass=e}this.outputs&&(this.frameBuffer=new r({depthBuffer:!1}))},{render:function(e){var t=e.gl;for(var n in this.inputLinks){var r=this.inputLinks[n],i=r.node.getOutput(e,r.pin);this.pass.setUniform(n,i)}if(!this.outputs)this.pass.outputs=null,this.pass.render(e);else{this.pass.outputs={};for(var o in this.outputs){var u=this.outputs[o],a=s.get(u.parameters||{});this._textures[o]=a;var f=u.attachment||t.COLOR_ATTACHMENT0;typeof f=="string"&&(f=t[f]),this.pass.outputs[f]=a}this.pass.render(e,this.frameBuffer)}for(var n in this.inputLinks){var r=this.inputLinks[n];r.node.removeReference(r.pin)}},setParameter:function(e,t){this.pass.setUniform(e,t)},setParameters:function(e){for(var t in e)this.setParameter(t,e[t])},getOutput:function(e,t){var n=this.outputs[t];if(!n)return;return this._textures[t]?this._textures[t]:(this.render(e),this._textures[t])},removeReference:function(e){this._outputReferences[e]--,this._outputReferences[e]===0&&(s.put(this._textures[e]),this._textures[e]=null)},link:function(e,t,n){this.inputLinks[e]={node:t,pin:n},t.outputLinks[n]||(t.outputLinks[n]=[]),t.outputLinks[n].push({node:this,pin:e})},clear:function(){this.inputLinks={},this.outputLinks={}},updateReference:function(){for(var e in this.outputLinks)this._outputReferences[e]=this.outputLinks[e].length}});return o}),r("3d/compositor/graph/group",["require","./node","./graph"],function(e){var t=e("./node"),n=e("./graph"),r=t.derive(function(){return{nodes:[],_textures:{}}},{add:function(e){return n.prototype.add.call(this,e)},remove:function(e){return n.prototype.remove.call(this,e)},update:function(){return n.prototype.update.call(this)},findPin:function(e){return n.prototype.findPin.call(this,e)},render:function(e){this.isDirty("graph")&&(this.update(),this.fresh("graph"));var t={};for(var n in this.inputLinks){var r=this.inputLinks[n],i=r.node.getOutput(e,r.pin);t[n]=i}for(var s=0;s<this.nodes.length;s++){var o=this.nodes[s];o.updateReference(),o.groupInputs&&this._updateGroupInputs(o,t)}for(var s=0;s<this.nodes.length;s++){var o=this.nodes[s];o.groupOutputs&&this._updateGroupOutputs(o,e),o.outputs||o.render(e)}for(var u in this.groupOutputs)this._textures[u]||console.error('Group output pin "'+u+'" is not attached');for(var n in this.inputLinks){var r=this.inputLinks[n];r.node.removeReference(r.pin)}},_updateGroupInputs:function(e,t){for(var n in t){var r=t[n];if(e.groupInputs[n]){var i=e.groupInputs[n];e.pass.setUniform(i,r)}}},_updateGroupOutputs:function(e,t){for(var n in e.groupOutputs){var r=e.groupOutputs[n],i=e.getOutput(t,n);this._textures[r]=i}}});return r}),r("3d/compositor/graph/scenenode",["require","./node","../pass","../../framebuffer","./texturepool","../../webglinfo"],function(e){var t=e("./node"),n=e("../pass"),r=e("../../framebuffer"),i=e("./texturepool"),s=e("../../webglinfo"),o=t.derive(function(){return{scene:null,camera:null,material:null}},function(){this.frameBuffer&&(this.frameBuffer.depthBuffer=!0)},{render:function(e){var t=e.gl;if(!this.outputs)e.render(this.scene,this.camera);else{var n=this.frameBuffer;for(var r in this.outputs){var o=this.outputs[r],u=i.get(o.parameters||{});this._textures[r]=u;var a=o.attachment||t.COLOR_ATTACHMENT0;typeof a=="string"&&(a=t[a]),n.attach(e.gl,u,a)}n.bind(e);var f=s.getExtension("EXT_draw_buffers");if(f){var l=[];for(var a in this.outputs)a=parseInt(a),a>=t.COLOR_ATTACHMENT0&&a<=t.COLOR_ATTACHMENT0+8&&l.push(a);f.drawBuffersEXT(l)}this.material&&(this.scene.material=this.material),e.render(this.scene,this.camera),this.scene.material=null,n.unbind(e)}}});return o}),r("3d/compositor/graph/texturenode",["require","./node","../../framebuffer","./texturepool","../../shader"],function(e){var t=e("./node"),n=e("../../framebuffer"),r=e("./texturepool"),i=e("../../shader"),s=t.derive(function(){return{shader:i.source("buildin.compositor.output"),texture:null}},{render:function(e){var t=e.gl;this.pass.setUniform("texture",this.texture);if(!this.outputs)this.pass.outputs=null,this.pass.render(e);else{this.pass.outputs={};for(var n in this.outputs){var i=this.outputs[n],s=r.get(i.parameters||{});this._textures[n]=s;var o=i.attachment||t.COLOR_ATTACHMENT0;typeof o=="string"&&(o=t[o]),this.pass.outputs[o]=s}this.pass.render(e,this.frameBuffer)}}});return s}),r("3d/light",["require","./node"],function(e){var t=e("./node"),n=t.derive(function(){return{color:[1,1,1],intensity:1,castShadow:!0,shadowResolution:512}},{});return n}),r("3d/renderer",["require","core/base","_","glmatrix","util/util","./light","./mesh","./webglinfo"],function(e){var t=e("core/base"),n=e("_"),r=e("glmatrix"),i=r.mat4,s=e("util/util"),o=e("./light"),u=e("./mesh"),a=e("./webglinfo"),f=t.derive(function(){return{__GUID__:s.genGUID(),canvas:null,devicePixelRatio:window.devicePixelRatio||1,color:[1,1,1,0],clear:16640,alhpa:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,gl:null,viewportInfo:{}}},function(){this.canvas||(this.canvas=document.createElement("canvas"));try{this.gl=this.canvas.getContext("experimental-webgl",{alhpa:this.alhpa,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer}),this.gl.__GUID__=this.__GUID__,this.resize(this.canvas.width,this.canvas.height),a.initialize(this.gl)}catch(e){throw"Error creating WebGL Context"}},{resize:function(e,t){var n=this.canvas;this.devicePixelRatio!==1&&(n.style.width=e+"px",n.style.height=t+"px"),n.width=e*this.devicePixelRatio,n.height=t*this.devicePixelRatio,this.setViewport(0,0,n.width,n.height)},setViewport:function(e,t,n,r){this.gl.viewport(e,t,n,r),this.viewportInfo={x:e,y:t,width:n,height:r}},render:function(e,t,r){var i=this.gl;r||this.trigger("beforerender",e,t);var s=this.color;i.clearColor(s[0],s[1],s[2],s[3]),i.clear(this.clear);var u=[],a=[],f=[];t.update(),e.update(),this._scene=e;var l=e.material;e.traverse(function(e){if(!e.visible)return!0;e.instanceof(o)&&f.push(e);if(!e.render)return;if(l)l.transparent?a.push(e):u.push(e);else{if(!e.material||!e.material.shader)return;if(!e.geometry)return;e.material.transparent?a.push(e):u.push(e)}}),e.filter&&(u=n.filter(u,e.filter),a=n.filter(a,e.filter));var c={};for(var h=0;h<f.length;h++){var p=f[h];c[p.type]||(c[p.type]=0),c[p.type]++}e.lightNumber=c,this.updateLightUnforms(f),u.sort(this._materialSortFunc),a.sort(this._materialSortFunc),r||this.trigger("beforerender:opaque",u),i.enable(i.DEPTH_TEST),i.disable(i.BLEND),this.renderQueue(u,t,l,r),r||(this.trigger("afterrender:opaque",u),this.trigger("beforerender:transparent",a)),i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.renderQueue(a,t,l,r),r||(this.trigger("afterrender:transparent",a),this.trigger("afterrender",e,t))},updateLightUnforms:function(e){var t=this._scene.lightUniforms;for(var n in t)t[n].value.length=0;for(var r=0;r<e.length;r++){var i=e[r];for(n in i.uniformTemplates){var s=i.uniformTemplates[n];t[n]||(t[n]={type:"",value:[]});var o=s.value(i),u=t[n];u.type=s.type+"v";switch(s.type){case"1i":case"1f":u.value.push(o);break;case"2f":case"3f":case"4f":for(var a=0;a<o.length;a++)u.value.push(o[a]);break;default:console.error("Unkown light uniform type "+s.type)}}}},renderQueue:function(e,t,r,s){i.invert(l.VIEW,t.worldMatrix._array),i.copy(l.PROJECTION,t.projectionMatrix._array),i.multiply(l.VIEWPROJECTION,t.projectionMatrix._array,l.VIEW),i.copy(l.VIEWINVERSE,t.worldMatrix._array),i.invert(l.PROJECTIONINVERSE,l.PROJECTION),i.invert(l.VIEWPROJECTIONINVERSE,l.VIEWPROJECTION);var o,a,f=this.gl,c=this._scene;for(var h=0;h<e.length;h++){var p=e[h],d=r||p.material,v=d.shader,m=p.geometry,g=d.transparent&&d.blend;if(a!==v.__GUID__){var y=!1;n.isEqual(v.lightNumber,c.lightNumber)||(y=!0);if(y){for(var b in c.lightNumber){var w=c.lightNumber[b];v.lightNumber[b]=w}v.update()}v.bind(f);for(var E in c.lightUniforms){var S=c.lightUniforms[E];v.setUniform(f,S.type,E,S.value)}a=v.__GUID__}o!==d.__GUID__&&(d.bind(f),o=d.__GUID__,u.materialChanged()),g&&g(f);var x=p.worldMatrix._array;(v.semantics.hasOwnProperty("WORLD")||v.semantics.hasOwnProperty("WORLDTRANSPOSE"))&&i.copy(l.WORLD,x),(v.semantics.hasOwnProperty("WORLDVIEW")||v.semantics.hasOwnProperty("WORLDVIEWINVERSE")||v.semantics.hasOwnProperty("WORLDVIEWINVERSETRANSPOSE"))&&i.multiply(l.WORLDVIEW,l.VIEW,x),(v.semantics.hasOwnProperty("WORLDVIEWPROJECTION")||v.semantics.hasOwnProperty("WORLDVIEWPROJECTIONINVERSE")||v.semantics.hasOwnProperty("WORLDVIEWPROJECTIONINVERSETRANSPOSE"))&&i.multiply(l.WORLDVIEWPROJECTION,l.VIEWPROJECTION,x),(v.semantics.hasOwnProperty("WORLDINVERSE")||v.semantics.hasOwnProperty("WORLDINVERSETRANSPOSE"))&&i.invert(l.WORLDINVERSE,x),(v.semantics.hasOwnProperty("WORLDVIEWINVERSE")||v.semantics.hasOwnProperty("WORLDVIEWINVERSETRANSPOSE"))&&i.invert(l.WORLDVIEWINVERSE,l.WORLDVIEW),(v.semantics.hasOwnProperty("WORLDVIEWPROJECTIONINVERSE")||v.semantics.hasOwnProperty("WORLDVIEWPROJECTIONINVERSETRANSPOSE"))&&i.invert(l.WORLDVIEWPROJECTIONINVERSE,l.WORLDVIEWPROJECTION);for(var T in l){if(v.semantics.hasOwnProperty(T)){var N=l[T],C=v.semantics[T];v.setUniform(f,C.type,C.symbol,N)}var k=T+"TRANSPOSE";if(v.semantics.hasOwnProperty(T+"TRANSPOSE")){var L=l[T+"TRANSPOSE"],N=l[T],A=v.semantics[T+"TRANSPOSE"];i.transpose(L,N),v.setUniform(f,A.type,A.symbol,L)}}s||this.trigger("beforerender:mesh",p);var O=p.render(this,r);s||this.trigger("afterrender:mesh",p,O),g&&(f.blendEquation(f.FUNC_ADD),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA))}},_materialSortFunc:function(e,t){return e.material.shader==t.material.shader?e.material.__GUID__-t.material.__GUID__:e.material.shader.__GUID__-t.material.__GUID__}}),l={WORLD:i.create(),VIEW:i.create(),PROJECTION:i.create(),WORLDVIEW:i.create(),VIEWPROJECTION:i.create(),WORLDVIEWPROJECTION:i.create(),WORLDINVERSE:i.create(),VIEWINVERSE:i.create(),PROJECTIONINVERSE:i.create(),WORLDVIEWINVERSE:i.create(),VIEWPROJECTIONINVERSE:i.create(),WORLDVIEWPROJECTIONINVERSE:i.create(),WORLDTRANSPOSE:i.create(),VIEWTRANSPOSE:i.create(),PROJECTIONTRANSPOSE:i.create(),WORLDVIEWTRANSPOSE:i.create(),VIEWPROJECTIONTRANSPOSE:i.create(),WORLDVIEWPROJECTIONTRANSPOSE:i.create(),WORLDINVERSETRANSPOSE:i.create(),VIEWINVERSETRANSPOSE:i.create(),PROJECTIONINVERSETRANSPOSE:i.create(),WORLDVIEWINVERSETRANSPOSE:i.create(),VIEWPROJECTIONINVERSETRANSPOSE:i.create(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:i.create()};return f}),r("core/event",["require","./base"],function(e){var t=e("./base"),n=t.derive({cancelBubble:!1},{stopPropagation:function(){this.cancelBubble=!0}});n.throw=function(e,t,n){var r=new MouseEvent(n);r.sourceTarget=t;while(t&&!r.cancelBubble)r.target=t,t.trigger(e,r),t=t.parent}}),r("core/request",["require"],function(e){function t(e){var t=new XMLHttpRequest;t.open("get",e.url),t.responseType=e.responseType||"text",e.onprogress&&(t.onprogress=function(t){if(t.lengthComputable){var n=t.loaded/t.total;e.onprogress(n,t.loaded,t.total)}else e.onprogress(null)}),t.onload=function(n){e.onload&&e.onload(t.response)},e.onerror&&(t.onerror=e.onerror),t.send(null)}function n(e){}return{get:t,put:n}}),r("core/vector2",function(){}),r("core/vector4",["require","glmatrix"],function(e){var t=e("glmatrix"),n=t.vec4,r=function(e,t,r,s){return e=e||0,t=t||0,r=r||0,s=s||0,Object.create(i,{x:{configurable:!1,set:function(e){this._array[0]=e,this._dirty=!0},get:function(){return this._array[0]}},y:{configurable:!1,set:function(e){this._array[1]=e,this._dirty=!0},get:function(){return this._array[1]}},z:{configurable:!1,set:function(e){this._array[2]=e,this._dirty=!0},get:function(){return this._array[2]}},w:{configurable:!1,set:function(e){this._array[2]=e,this._dirty=!0},get:function(){return this._array[2]}},_array:{writable:!1,configurable:!1,value:n.fromValues(e,t,r,s)},_dirty:{configurable:!1,value:!1}})},i={constructor:r,add:function(e){return n.add(this._array,this._array,e._array),this._dirty=!0,this},set:function(e,t,n,r){return this._array[0]=e,this._array[1]=t,this._array[2]=n,this._array[3]=r,this._dirty=!0,this},clone:function(){return new r(this.x,this.y,this.z,this.w)},copy:function(e){return n.copy(this._array,e._array),this._dirty=!0,this},cross:function(e,t){return n.cross(e._array,this._array,t._array),this},dist:function(e){return n.dist(this._array,e._array)},distance:function(e){return n.distance(this._array,e._array)},div:function(e){return n.div(this._array,this._array,e._array),this._dirty=!0,this},divide:function(e){return n.divide(this._array,this._array,e._array),this._dirty=!0,this},dot:function(e){return n.dot(this._array,e._array)},len:function(){return n.len(this._array)},length:function(){return n.length(this._array)},lerp:function(e,t,r){return n.lerp(this._array,e._array,t._array,r),this._dirty=!0,this},mul:function(e){return n.mul(this._array,this._array,e._array),this._dirty=!0,this},multiply:function(e){return n.multiply(this._array,this._array,e._array),this._dirty=!0,this},negate:function(){return n.negate(this._array,this._array),this._dirty=!0,this},normalize:function(){return n.normalize(this._array,this._array),this._dirty=!0,this},random:function(e){return n.random(this._array,e),this._dirty=!0,this},scale:function(e){return n.scale(this._array,this._array,e),this._dirty=!0,this},scaleAndAdd:function(e,t){return n.scaleAndAdd(this._array,this._array,e._array,t),this._dirty=!0,this},sqrDist:function(e){return n.sqrDist(this._array,e._array)},squaredDistance:function(e){return n.squaredDistance(this._array,e._array)},sqrLen:function(){return n.sqrLen(this._array)},squaredLength:function(){return n.squaredLength(this._array)},sub:function(e){return n.sub(this._array,this._array,e._array),this._dirty=!0,this},subtract:function(e){return n.subtract(this._array,this._array,e._array),this._dirty=!0,this},transformMat4:function(e){return n.transformMat4(this._array,this._array,e._array),this._dirty=!0,this},transformQuat:function(e){return n.transformQuat(this._array,this._array,e._array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return r}),r("util/color",["require"],function(e){}),r("util/xmlparser",["require"],function(e){}),r("qtekimage",["require","./2d/camera","./2d/node","./2d/renderable/arc","./2d/renderable/circle","./2d/renderable/image","./2d/renderable/line","./2d/renderable/path","./2d/renderable/polygon","./2d/renderable/rectangle","./2d/renderable/roundedrectangle","./2d/renderable/sector","./2d/renderable/text","./2d/renderable/textbox","./2d/renderer","./2d/scene","./2d/style","./2d/util","./3d/camera","./3d/camera/orthographic","./3d/compositor","./3d/compositor/graph/graph","./3d/compositor/graph/group","./3d/compositor/graph/node","./3d/compositor/graph/scenenode","./3d/compositor/graph/texturenode","./3d/compositor/graph/texturepool","./3d/compositor/pass","./3d/framebuffer","./3d/geometry","./3d/geometry/plane","./3d/light","./3d/material","./3d/mesh","./3d/node","./3d/renderer","./3d/scene","./3d/shader","./3d/texture","./3d/texture/texture2d","./3d/webglinfo","./core/base","./core/cache","./core/event","./core/matrix3","./core/matrix4","./core/mixin/derive","./core/mixin/dirty","./core/mixin/notifier","./core/quaternion","./core/request","./core/vector2","./core/vector3","./core/vector4","./util/color","./util/util","./util/xmlparser","glmatrix"],function(e){var t={"2d":{Camera:e("./2d/camera"),Node:e("./2d/node"),renderable:{Arc:e("./2d/renderable/arc"),Circle:e("./2d/renderable/circle"),Image:e("./2d/renderable/image"),Line:e("./2d/renderable/line"),Path:e("./2d/renderable/path"),Polygon:e("./2d/renderable/polygon"),Rectangle:e("./2d/renderable/rectangle"),RoundedRectangle:e("./2d/renderable/roundedrectangle"),Sector:e("./2d/renderable/sector"),Text:e("./2d/renderable/text"),TextBox:e("./2d/renderable/textbox")},Renderer:e("./2d/renderer"),Scene:e("./2d/scene"),Style:e("./2d/style"),util:e("./2d/util")},"3d":{Camera:e("./3d/camera"),camera:{Orthographic:e("./3d/camera/orthographic")},Compositor:e("./3d/compositor"),compositor:{graph:{Graph:e("./3d/compositor/graph/graph"),Group:e("./3d/compositor/graph/group"),Node:e("./3d/compositor/graph/node"),SceneNode:e("./3d/compositor/graph/scenenode"),TextureNode:e("./3d/compositor/graph/texturenode"),TexturePool:e("./3d/compositor/graph/texturepool")},Pass:e("./3d/compositor/pass")},FrameBuffer:e("./3d/framebuffer"),Geometry:e("./3d/geometry"),geometry:{Plane:e("./3d/geometry/plane")},Light:e("./3d/light"),Material:e("./3d/material"),Mesh:e("./3d/mesh"),Node:e("./3d/node"),Renderer:e("./3d/renderer"),Scene:e("./3d/scene"),Shader:e("./3d/shader"),Texture:e("./3d/texture"),texture:{Texture2D:e("./3d/texture/texture2d")},WebGLInfo:e("./3d/webglinfo")},core:{Base:e("./core/base"),Cache:e("./core/cache"),Event:e("./core/event"),Matrix3:e("./core/matrix3"),Matrix4:e("./core/matrix4"),mixin:{derive:e("./core/mixin/derive"),Dirty:e("./core/mixin/dirty"),notifier:e("./core/mixin/notifier")},Quaternion:e("./core/quaternion"),requester:e("./core/request"),Vector2:e("./core/vector2"),Vector3:e("./core/vector3"),Vector4:e("./core/vector4")},util:{Color:e("./util/color"),Util:e("./util/util"),Xmlparser:e("./util/xmlparser")}},n=e("glmatrix");return t.math=n,t});var i=n("qtekimage");for(var s in i)e[s]=i[s]}),r("src/fx",["require","qtek"],function(e){var t=e("qtek"),n=t["3d"],r=function(){this.node=null,this.input=null,this.parameters={},this.imageSize={width:512,height:512},Object.defineProperty(this,"input",{set:function(e){this.node&&(this.node.inputs.texture.node=e)},get:function(){return this.node.inputs.texture.node}})};r.prototype.reset=function(){},r.prototype.dispose=function(){},r.prototype.setImageSize=function(e,t){if(!this.node)return;if(this.node.instanceof(n.compositor.graph.Group))for(var r=0;r<this.node.nodes.length;r++){var i=this.node.nodes[r];i.setParameters({imageWidth:e,imageHeight:t});if(i.outputs)for(var s in i.outputs){var o=i.outputs[s];o.parameters?o.parameters.width||(o.parameters.width=e,o.parameters.height=t):o.parameters={width:e,height:t}}}else{this.node.setParameters({imageWidth:e,imageHeight:t});var i=this.node;if(i.outputs)for(var s in i.outputs){var o=i.outputs[s];o.parameters?o.parameters.width||(o.parameters.width=e,o.parameters.height=t):o.parameters={width:e,height:t}}}};var i={};return r.export=function(e,t){i[e]=t},r.create=function(e){if(!i[e]){console.error("FX "+e+" not exist");return}var t=new i[e];return t},r}),r("src/buildin/gaussian",["require","qtek","../fx"],function(e){var t=e("qtek"),n=t["3d"],r=e("../fx"),i=function(){r.call(this),this.node=new n.compositor.graph.Group({inputs:{texture:{node:null,pin:"color"}},outputs:{color:{}}});var e=new n.compositor.graph.Node({name:"gaussian_h",shader:n.Shader.source("buildin.compositor.gaussian_blur_h"),groupInputs:{texture:"texture"},outputs:{color:{parameters:this.imageSize}}}),t=new n.compositor.graph.Node({name:"gaussian_v",shader:n.Shader.source("buildin.compositor.gaussian_blur_v"),inputs:{texture:{node:e,pin:"color"}},outputs:{color:{parameters:this.imageSize}},groupOutputs:{color:"color"}});this.node.add(e),this.node.add(t);var i=2;this.parameters={blurSize:{max:10,min:0,step:.1,ui:"range",get value(){return i},set value(n){i=n,t.setParameter("blurSize",n),e.setParameter("blurSize",n)}}},this.reset()};return i.prototype=new r,i.prototype.reset=function(){this.parameters.blurSize.value=2},i.prototype.constructor=i,r.export("buildin.gaussian",i),i}),r("shaders/hexagonal_blur.essl",[],function(){return"@export emage.hexagonal_blur_1\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color = vec4(0.0);\n   // Top\n   for(int i = 0; i < 30; i++){\n      color += 1.0/30.0 * texture2D(texture, v_Texcoord + vec2(0.0, offset.y * float(i)) );\n   }\n   gl_FragColor = color;\n}\n\n@end\n\n@export emage.hexagonal_blur_2\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 30; i++){\n      color += 1.0/30.0 * texture2D(texture, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   gl_FragColor = color;\n}\n@end\n\n@export emage.hexagonal_blur_3\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\n\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform float imageWidth : 1.0;\nuniform float imageHeight : 1.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color1 = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 30; i++){\n      color1 += 1.0/30.0 * texture2D(texture1, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   vec4 color2 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < 30; i++){\n      color2 += 1.0/30.0 * texture2D(texture1, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   vec4 color3 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < 30; i++){\n      color3 += 1.0/30.0 * texture2D(texture2, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   gl_FragColor = (color1 + color2 + color3) / 3.0;\n}\n\n@end"}),r("shaders/gamma.essl",[],function(){return"varying vec2 v_Texcoord;\n\nuniform sampler2D texture;\nuniform float gamma : 1.0;\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n\n    gl_FragColor = vec4(pow(tex.rgb, vec3(gamma)), tex.a);\n}"}),r("src/buildin/lensblur",["require","qtek","../fx","shaders/hexagonal_blur.essl","shaders/gamma.essl","shaders/gamma.essl"],function(e){var t=e("qtek"),n=t["3d"],r=e("../fx");n.Shader.import(e("shaders/hexagonal_blur.essl"));var i=function(){r.call(this),this.node=new n.compositor.graph.Group({inputs:{texture:{node:null,pin:"color"}},outputs:{color:{}}});var t={width:1024,height:1024,type:"FLOAT"},i=new n.compositor.graph.Node({shader:e("shaders/gamma.essl"),groupInputs:{texture:"texture"},outputs:{color:{parameters:t}}}),s=new n.compositor.graph.Node({shader:n.Shader.source("emage.hexagonal_blur_1"),inputs:{texture:{node:i,pin:"color"}},outputs:{color:{parameters:t}}}),o=new n.compositor.graph.Node({shader:n.Shader.source("emage.hexagonal_blur_2"),inputs:{texture:{node:i,pin:"color"}},outputs:{color:{parameters:t}}}),u=new n.compositor.graph.Node({shader:n.Shader.source("emage.hexagonal_blur_3"),inputs:{texture1:{node:s,pin:"color"},texture2:{node:o,pin:"color"}},outputs:{color:{parameters:t}}}),a=new n.compositor.graph.Node({shader:e("shaders/gamma.essl"),inputs:{texture:{node:u,pin:"color"}},outputs:{color:{parameters:{width:1024,height:1024}}},groupOutputs:{color:"color"}});this.node.add(i),this.node.add(s),this.node.add(o),this.node.add(u),this.node.add(a);var f=1,l=6;this.parameters={blurSize:{max:10,min:0,step:.1,ui:"range",get value(){return f},set value(e){f=e,s.setParameter("blurSize",e),o.setParameter("blurSize",e),u.setParameter("blurSize",e)}},brightness:{max:10,min:0,step:.1,ui:"range",get value(){return l},set value(e){l=e,i.setParameter("gamma",e),a.setParameter("gamma",1/e)}}},this.reset()};return i.prototype=new r,i.prototype.reset=function(){this.parameters.blurSize.value=.4,this.parameters.brightness.value=6},i.prototype.constructor=i,r.export("buildin.lensblur",i),i}),r("src/buildin/coloradjust",["require","qtek","../fx"],function(e){var t=e("qtek"),n=t["3d"],r=e("../fx"),i=function(){r.call(this);var e=new n.compositor.graph.Node({shader:n.Shader.source("buildin.compositor.coloradjust"),inputs:{texture:{node:null,pin:"color"}},outputs:{color:{}}});this.node=e;var t=0,i=1,s=0,o=1,u=1;this.parameters={brightness:{max:1,min:-1,step:.1,ui:"range",get value(){return t},set value(n){t=n,e.setParameter("brightness",n)}},contrast:{max:4,min:0,step:.1,ui:"range",get value(){return i},set value(t){i=t,e.setParameter("contrast",t)}},exposure:{max:10,min:-10,step:.1,ui:"range",get value(){return s},set value(t){s=t,e.setParameter("exposure",t)}},gamma:{max:3,min:0,step:.1,ui:"range",get value(){return o},set value(t){o=t,e.setParameter("gamma",t)}},saturation:{max:10,min:0,step:.1,ui:"range",get value(){return u},set value(t){u=t,e.setParameter("saturation",t)}}},this.reset()};return i.prototype=new r,i.prototype.reset=function(){this.parameters.brightness.value=0,this.parameters.exposure.value=0,this.parameters.contrast.value=1,this.parameters.saturation.value=1,this.parameters.gamma.value=1},i.prototype.constructor=i,r.export("buildin.coloradjust",i),i}),r("shaders/colormatrix.essl",[],function(){return"varying vec2 v_Texcoord;\n\nuniform sampler2D texture;\n\nuniform mat4 colorMatrix;\nuniform float intensity : 1.0;\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n    vec4 outputColor = tex * colorMatrix;\n\n    gl_FragColor = intensity * outputColor + ( (1.0-intensity) * tex );\n}"}),r("src/buildin/colormatrix",["require","qtek","../fx","shaders/colormatrix.essl"],function(e){var t=e("qtek"),n=t["3d"],r=e("../fx"),i=function(){r.call(this);var t=new n.compositor.graph.Node({shader:e("shaders/colormatrix.essl"),inputs:{texture:{node:null,pin:"color"}},outputs:{color:{}}});this.node=t;var i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),s=1;this.parameters={colorMatrix:{get value(){return i},set value(e){i=e,t.setParameter("colorMatrix",e)}},intensity:{min:0,max:1,ui:"slider",step:.01,get intensity(){return s},set intensity(e){s=e,t.setParameter("intensity",e)}}}};return i.prototype=new r,i.prototype.constructor=i,r.export("buildin.colormatrix",i),i}),r("src/buildin/sepia",["require","qtek","./colormatrix","../fx"],function(e){var t=e("qtek"),n=t["3d"],r=e("./colormatrix"),i=e("../fx"),s=function(){r.call(this),this.parameters.colorMatrix.value=new Float32Array([.3588,.7044,.1368,0,.299,.587,.114,0,.2392,.4696,.0912,0,0,0,0,1])};return s.prototype=new r,s.prototype.constructor=s,i.export("buildin.sepia",s),s}),r("shaders/lut.essl",[],function(){return"varying vec2 v_Texcoord;\n\nuniform sampler2D texture;\nuniform sampler2D lookup;\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n\n    float blueColor = tex.b * 63.0;\n    \n    vec2 quad1;\n    quad1.y = floor(floor(blueColor) / 8.0);\n    quad1.x = floor(blueColor) - (quad1.y * 8.0);\n    \n    vec2 quad2;\n    quad2.y = floor(ceil(blueColor) / 8.0);\n    quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n    \n    vec2 texPos1;\n    texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n    texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n    \n    vec2 texPos2;\n    texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n    texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n    \n    vec4 newColor1 = texture2D(lookup, texPos1);\n    vec4 newColor2 = texture2D(lookup, texPos2);\n    \n    vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n    gl_FragColor = vec4(newColor.rgb, tex.w);\n}"}),r("src/buildin/lut",["require","qtek","../fx","shaders/lut.essl"],function(e){var t=e("qtek"),n=t["3d"],r=e("../fx"),i=function(){r.call(this);var t=new n.compositor.graph.Node({shader:e("shaders/lut.essl"),inputs:{texture:{node:null,pin:"color"}},outputs:{color:{}}});this.node=t;var i=new n.texture.Texture2D({minFilter:"NEAREST",magFilter:"NEAREST",generateMipmaps:!1,flipY:!1});t.setParameter("lookup",i),this.parameters={lookup:{get value(){return i.image},set value(e){i.image=e,i.dirty()}}}};return i.prototype=new r,i.prototype.constructor=i,r.export("buildin.lut",i),i}),r("shaders/sobel.essl",[],function(){return"// Sobel edge detection\n// http://en.wikipedia.org/wiki/Sobel_operator\n//\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float imageWidth : 512;\nuniform float imageHeight : 512;\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nfloat luminance(vec4 color){\n    return dot(color.rgb, w);\n}\n\nvoid main(){\n\n	vec2 offset = vec2(1.0/imageWidth, 1.0/imageHeight);\n\n	// top left\n	float topLeft = luminance( texture2D(texture, v_Texcoord+vec2(-offset.x, -offset.y)) );\n	// top\n	float top = luminance( texture2D(texture, v_Texcoord+vec2(0, -offset.y)) );\n	// top right\n	float topRight = luminance( texture2D(texture, v_Texcoord+vec2(offset.x, -offset.y)) );\n	// left\n	float left = luminance( texture2D(texture, v_Texcoord+vec2(-offset.x, 0)) );\n	// center\n	float center = luminance( texture2D( texture, v_Texcoord) );\n	// right\n	float right = luminance( texture2D(texture, v_Texcoord+vec2(offset.x, 0)) );\n	// bottom left\n	float bottomLeft = luminance( texture2D(texture, v_Texcoord+vec2(-offset.x, offset.y)) );\n	// bottom\n	float bottom = luminance( texture2D(texture, v_Texcoord+vec2(0, offset.y)) );\n	// bottom right\n	float bottomRight = luminance( texture2D(texture, v_Texcoord+offset) );\n\n	float h = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;\n	float v = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;\n\n	float mag = length(vec2(h,v));\n	gl_FragColor = vec4(vec3(mag), 1.0);\n}"}),r("src/buildin/sobel",["require","qtek","../fx","shaders/sobel.essl"],function(e){var t=e("qtek"),n=t["3d"],r=e("../fx"),i=function(){r.call(this);var t=new n.compositor.graph.Node({shader:e("shaders/sobel.essl"),inputs:{texture:{node:null,pin:"color"}},outputs:{color:{}}});this.node=t};return i.prototype=new r,i.prototype.constructor=i,r.export("buildin.sobel",i),i}),r("shaders/sketch.essl",[],function(){return"varying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float imageWidth : 512;\nuniform float imageHeight : 512;\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nfloat luminance(vec4 color){\n    return dot(color.rgb, w);\n}\n\nvoid main(){\n\n	vec2 offset = vec2(1.0/imageWidth, 1.0/imageHeight);\n\n	// top left\n	float topLeft = luminance( texture2D(texture, v_Texcoord+vec2(-offset.x, -offset.y)) );\n	// top\n	float top = luminance( texture2D(texture, v_Texcoord+vec2(0, -offset.y)) );\n	// top right\n	float topRight = luminance( texture2D(texture, v_Texcoord+vec2(offset.x, -offset.y)) );\n	// left\n	float left = luminance( texture2D(texture, v_Texcoord+vec2(-offset.x, 0)) );\n	// center\n	float center = luminance( texture2D( texture, v_Texcoord) );\n	// right\n	float right = luminance( texture2D(texture, v_Texcoord+vec2(offset.x, 0)) );\n	// bottom left\n	float bottomLeft = luminance( texture2D(texture, v_Texcoord+vec2(-offset.x, offset.y)) );\n	// bottom\n	float bottom = luminance( texture2D(texture, v_Texcoord+vec2(0, offset.y)) );\n	// bottom right\n	float bottomRight = luminance( texture2D(texture, v_Texcoord+offset) );\n\n	float h = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;\n	float v = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;\n\n	float mag = 1.0 - length(vec2(h, v));\n\n	gl_FragColor = vec4(vec3(mag), 1.0);\n}"}),r("src/buildin/sketch",["require","qtek","../fx","shaders/sketch.essl"],function(e){var t=e("qtek"),n=t["3d"],r=e("../fx"),i=function(){r.call(this);var t=new n.compositor.graph.Node({shader:e("shaders/sketch.essl"),inputs:{texture:{node:null,pin:"color"}},outputs:{color:{}}});this.node=t};return i.prototype=new r,i.prototype.constructor=i,r.export("buildin.sketch",i),i}),r("shaders/toon.essl",[],function(){return"varying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float imageWidth;\nuniform float imageHeight;\n\nuniform float threshold : 0.2;\nuniform float quantizationLevels : 10;\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nfloat luminance(vec4 color){\n    return dot(color.rgb, w);\n}\n\nvoid main(){\n\n    vec2 offset = vec2(1.0/imageWidth, 1.0/imageHeight);\n    vec4 tex = texture2D(texture, v_Texcoord);\n    // top left\n    float topLeft = luminance( texture2D(texture, v_Texcoord+vec2(-offset.x, -offset.y)) );\n    // top\n    float top = luminance( texture2D(texture, v_Texcoord+vec2(0, -offset.y)) );\n    // top right\n    float topRight = luminance( texture2D(texture, v_Texcoord+vec2(offset.x, -offset.y)) );\n    // left\n    float left = luminance( texture2D(texture, v_Texcoord+vec2(-offset.x, 0)) );\n    // center\n    float center = luminance( texture2D( texture, v_Texcoord) );\n    // right\n    float right = luminance( texture2D(texture, v_Texcoord+vec2(offset.x, 0)) );\n    // bottom left\n    float bottomLeft = luminance( texture2D(texture, v_Texcoord+vec2(-offset.x, offset.y)) );\n    // bottom\n    float bottom = luminance( texture2D(texture, v_Texcoord+vec2(0, offset.y)) );\n    // bottom right\n    float bottomRight = luminance( texture2D(texture, v_Texcoord+offset) );\n\n    float h = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;\n    float v = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;\n\n    float mag = length(vec2(h, v));\n    \n    vec3 posterizedImageColor = floor((tex.rgb * quantizationLevels) + 0.5) / quantizationLevels;\n    float thresholdTest = 1.0 - step(threshold, mag);\n    \n    gl_FragColor = vec4(posterizedImageColor * thresholdTest, tex.a);\n}"}),r("src/buildin/toon",["require","qtek","../fx","shaders/toon.essl"],function(e){var t=e("qtek"),n=t["3d"],r=e("../fx"),i=function(){r.call(this);var t=new n.compositor.graph.Node({shader:e("shaders/toon.essl"),inputs:{texture:{node:null,pin:"color"}},outputs:{color:{}}});this.node=t;var i=.2,s=10;this.parameters={threshold:{ui:"range",min:0,max:2,get value(){return i},set value(e){i=e,t.setParameter("threshold",e)}},quantizationLevels:{ui:"spinner",min:2,precision:0,get value(){return s},set value(e){s=e,t.setParameter("quantizationLevels",e)}}}};return i.prototype=new r,i.prototype.constructor=i,i.prototype.reset=function(){this.parameters.threshold.value=.2,this.parameters.quantizationLevels.value=10},r.export("buildin.toon",i),i}),r("src/buildin/grayscale",["require","qtek","../fx"],function(e){var t=e("qtek"),n=t["3d"],r=e("../fx"),i=function(){r.call(this);var e=new n.compositor.graph.Node({shader:n.Shader.source("buildin.compositor.grayscale"),inputs:{texture:{node:null,pin:"color"}},outputs:{color:{}}});this.node=e};return i.prototype=new r,i.prototype.constructor=i,r.export("buildin.grayscale",i),i}),r("src/layer",["require","qtek","./fx","./buildin/gaussian","./buildin/lensblur","./buildin/coloradjust","./buildin/colormatrix","./buildin/sepia","./buildin/lut","./buildin/sobel","./buildin/sketch","./buildin/toon","./buildin/grayscale"],function(e){var t=e("qtek"),n=e("./fx"),r=function(e){this.fx=null,this.enabled=!0,this.prevSibling=null,this.nextSibling=null,this._fxCaches={},e&&this.use(e)};return r.prototype.use=function(e){var t=this._fxCaches[e];t?t.reset():t=n.create(e);if(t)return t.input=this.prevSibling,this._fxCaches[e]=t,this.fx=t,t},r.prototype.set=function(e,t){if(!e)return;if(typeof e=="object"){var n=e;for(var e in n)this.set(e,n[e]);return}this.fx&&this.fx.parameters[e]&&(this.fx.parameters[e].value=t)},e("./buildin/gaussian"),e("./buildin/lensblur"),e("./buildin/coloradjust"),e("./buildin/colormatrix"),e("./buildin/sepia"),e("./buildin/lut"),e("./buildin/sobel"),e("./buildin/sketch"),e("./buildin/toon"),e("./buildin/grayscale"),r}),r("src/processor",["require","qtek","./layer","./fx"],function(e){var t=e("qtek"),n=t["3d"],r=e("./layer"),i=e("./fx"),s=function(e){this.canvas=e||document.createElement("canvas"),this.renderer=new n.Renderer({canvas:this.canvas,devicePixelRatio:1}),this.scale=1,this.compositor=new n.Compositor,this.layers=[],this._inputNode=new n.compositor.graph.TextureNode({texture:new n.texture.Texture2D({image:null}),outputs:{color:{parameters:{width:1024,height:1024}}}}),this._outputNode=new n.compositor.graph.Node({shader:n.Shader.source("buildin.compositor.output"),inputs:{texture:{node:null,pin:"color"}}}),this._imageChanged=!0,Object.defineProperty(this,"image",{set:function(e){this._inputNode.texture.image=e,this._inputNode.texture.dirty(),this._imageChanged=!0},get:function(e){return this._inputNode.texture.image}})};return s.prototype.add=function(e){this.layers.push(e)},s.prototype.remove=function(e){var t=this.layers.indexOf(e);this.layers.splice(t,1)},s.prototype.update=function(){var e=[];for(var t=0;t<this.layers.length;t++){var n=this.layers[t];n.enabled&&n.fx&&e.push(this.layers[t])}for(var t=0;t<e.length;t++){var n=e[t],r=e[t-1]||null,i=e[t+1]||null;n.prevSibling=r,n.nextSibling=i,r&&(n.fx.input=r.fx.node)}e.length?(this._outputNode.inputs.texture.node=e[e.length-1].fx.node,e[0].fx.input=this._inputNode):this._outputNode.inputs.texture.node=this._inputNode;var s=this.image.width*this.scale,o=this.image.height*this.scale;this._imageChanged&&this.renderer.resize(s,o),this.compositor.nodes=[];for(var t=0;t<e.length;t++)this.compositor.add(e[t].fx.node),this._imageChanged&&e[t].fx.setImageSize(s,o);this._inputNode.outputs.color.parameters={width:s,height:o},this.compositor.add(this._inputNode),this.compositor.add(this._outputNode),this.compositor.render(this.renderer)},s}),r("shaders/histogram.essl",[],function(){return"//Red channel\n@export emage.histogram_r.vertex\n\nattribute vec4 position;\n\nvarying lowp vec3 colorFactor;\n\nvoid main()\n{\n    colorFactor = vec3(1.0, 0.0, 0.0);\n    gl_Position = vec4(-1.0 + position.x * 0.0078125, 0.0, 0.0, 1.0);\n    gl_PointSize = 1.0;\n}\n\n@end\n\n//Grenn channel\n@export emage.histogram_g.vertex\n\nattribute vec4 position : POSITION;\n\nvarying lowp vec3 colorFactor;\n\nvoid main()\n{\n    colorFactor = vec3(0.0, 1.0, 0.0);\n    gl_Position = vec4(-1.0 + position.y * 0.0078125, 0.0, 0.0, 1.0);\n    gl_PointSize = 1.0;\n}\n\n@end\n\n//Blue channel\n@export emage.histogram_b.vertex\n\nattribute vec4 position : POSITION;\n\nvarying lowp vec3 colorFactor;\n\nvoid main()\n{\n    colorFactor = vec3(0.0, 0.0, 1.0);\n    gl_Position = vec4(-1.0 + position.z * 0.0078125, 0.0, 0.0, 1.0);\n    gl_PointSize = 1.0;\n}\n\n@end\n\n//Luminance channel\n@export emage.histogram_l.vertex\n\nattribute vec4 position : POSITION;\n\nvarying lowp vec3 colorFactor;\nconst highp vec3 W = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n    colorFactor = vec3(1.0, 1.0, 1.0);\n    gl_Position = vec4(-1.0 + dot(position.xyz, W) * 0.0078125, 0.0, 0.0, 1.0);\n    gl_PointSize = 1.0;\n}\n\n@end\n\n@export emage.histogram.fragment\n\nconst lowp float scalingFactor = 1.0 / 256.0;\n\nvarying lowp vec3 colorFactor;\n\nvoid main()\n{\n    gl_FragColor = vec4(colorFactor * scalingFactor, 1.0);\n}\n\n@end\n\n"}),r("src/histogram",["require","qtek","shaders/histogram.essl"],function(e){var t=e("qtek"),n=t["3d"],r=n.Shader,i={height:1,width:256,minFilter:"NEAREST",magFilter:"NEAREST",generateMipmaps:!1},s=document.createElement("canvas"),o=s.getContext("2d");r.import(e("shaders/histogram.essl"));var u=function(e){this.downSample=1/8,this.image=e,this.canvas=document.createElement("canvas"),this.renderer=new n.Renderer({canvas:this.canvas,preserveDrawingBuffer:!0}),this.channels={red:new Uint8Array(256),green:new Uint8Array(256),blue:new Uint8Array(256),luminance:new Uint8Array(256)},this._pixels={red:new Uint8Array(1024),green:new Uint8Array(1024),blue:new Uint8Array(1024),luminance:new Uint8Array(1024)};var t=this.renderer.gl;t.enableVertexAttribArray(0),this._framBuffer=new n.FrameBuffer({depthBuffer:!1}),this._textureRed=new n.texture.Texture2D(i),this._textureBlue=new n.texture.Texture2D(i),this._textureGreen=new n.texture.Texture2D(i),this._textureLuminance=new n.texture.Texture2D(i),this._shaderRed=new n.Shader({vertex:r.source("emage.histogram_r.vertex"),fragment:r.source("emage.histogram.fragment")}),this._shaderGreen=new n.Shader({vertex:r.source("emage.histogram_g.vertex"),fragment:r.source("emage.histogram.fragment")}),this._shaderBlue=new n.Shader({vertex:r.source("emage.histogram_b.vertex"),fragment:r.source("emage.histogram.fragment")}),this._shaderLuminance=new n.Shader({vertex:r.source("emage.histogram_l.vertex"),fragment:r.source("emage.histogram.fragment")}),this._buffer=t.createBuffer(),this._imageChanged=!0};return u.prototype.update=function(){var e=this.renderer.gl,t=this.image;s.width=t.width*this.downSample,s.height=t.height*this.downSample,o.drawImage(t,0,0,s.width,s.height);var n=o.getImageData(0,0,s.width,s.height);e.bindBuffer(e.ARRAY_BUFFER,this._buffer),e.bufferData(e.ARRAY_BUFFER,n.data,e.STATIC_DRAW),e.vertexAttribPointer(0,4,e.UNSIGNED_BYTE,!1,0,0),e.clearColor(0,0,0,1),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE),e.enable(e.BLEND),e.disable(e.DEPTH_TEST);var r=n.width,i=n.height,u=r*i;e.clear(e.COLOR_BUFFER_BIT),this._shaderRed.bind(e),this._framBuffer.attach(e,this._textureRed),this._framBuffer.bind(this.renderer),e.drawArrays(e.POINT,0,u),e.readPixels(0,0,256,1,e.RGBA,e.UNSIGNED_BYTE,this._pixels.red),e.clear(e.COLOR_BUFFER_BIT),this._shaderGreen.bind(e),this._framBuffer.attach(e,this._textureGreen),this._framBuffer.bind(this.renderer),e.drawArrays(e.POINT,0,u),e.readPixels(0,0,256,1,e.RGBA,e.UNSIGNED_BYTE,this._pixels.green),e.clear(e.COLOR_BUFFER_BIT),this._shaderBlue.bind(e),this._framBuffer.attach(e,this._textureBlue),this._framBuffer.bind(this.renderer),e.drawArrays(e.POINT,0,u),e.readPixels(0,0,256,1,e.RGBA,e.UNSIGNED_BYTE,this._pixels.blue),e.clear(e.COLOR_BUFFER_BIT),this._shaderLuminance.bind(e),this._framBuffer.attach(e,this._textureLuminance),this._framBuffer.bind(this.renderer),e.drawArrays(e.POINT,0,u),e.readPixels(0,0,256,1,e.RGBA,e.UNSIGNED_BYTE,this._pixels.luminance);for(var a=0;a<256;a++)this.channels.red[a]=this._pixels.red[a*4],this.channels.green[a]=this._pixels.green[a*4+1],this.channels.blue[a]=this._pixels.blue[a*4+2],this.channels.luminance[a]=this._pixels.luminance[a*4];e.disable(e.BLEND),e.enable(e.DEPTH_TEST),document.body.appendChild(this.canvas)},u.prototype.draw=function(){},u.prototype.get=function(){},u}),r("src/emage",["require","./fx","./layer","./processor","./histogram","qtek"],function(e){var t={FX:e("./fx"),Layer:e("./layer"),Processor:e("./processor"),Histogram:e("./histogram"),qtek:e("qtek")};return t});var i=n("src/emage");for(var s in i)e[s]=i[s]}),define("modules/viewport/index",["require","../module","text!./viewport.xml","./viewport","qpf","knockout","$","emage","_"],function(e){function c(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files[0];t&&t.type.match(/image/)&&h(t)}function h(e){l.onload=function(e){var t=new Image;l.onload=null,t.onload=function(){t.onload=null,f.setImage(t),f.mainComponent.$el.find(".draghint").remove()},t.src=e.target.result},l.readAsDataURL(e)}var t=e("../module"),n=e("text!./viewport.xml"),r=e("./viewport"),i=e("qpf"),s=e("knockout"),o=e("$"),u=e("emage"),a=e("_"),f=new t({name:"viewport",xml:n,applyFilter:s.observable(!0),resize:function(){var e=this.processor.image,t=e.height/e.width;if(f.mainComponent&&f.mainComponent.parent){var n=f.mainComponent,r=n.parent.width(),i=n.parent.height();t<1?(n.$el.css({"margin-top":(i-r*t)/2+"px","margin-left":"0px"}),n.height(r*t),n.width(r)):(n.$el.css({"margin-left":(r-i/t)/2,"margin-top":"0px"}),n.width(i/t),n.height(i))}},setImage:function(e){this.processor.image=e,this.update(),this.resize()},update:a.throttle(function(){f.processor.image&&(f.processor.update(),this.trigger("update"))},50),processor:new u.Processor,loadImageFromFile:h,colorAdjustLayer:null,filterLayer:null});f.on("start",function(){f.mainComponent.$el.find("canvas").replaceWith(this.processor.canvas);var e=new u.Layer;f.processor.add(e);var t=new u.Layer("buildin.coloradjust");f.processor.add(t),this.colorAdjustLayer=t,this.filterLayer=e;var n=new Image;n.onload=function(){f.setImage(n)},n.src="../file_upload/1.jpg"}),document.body.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1),document.body.addEventListener("drop",c,!1);var l=new FileReader;return f}),define("modules/filters/filter",["require","qpf","knockout","text!./filter.html","../viewport/index"],function(e){var t=e("qpf"),n=t.use("components/widget/widget"),r=e("knockout"),i=e("text!./filter.html"),s=e("../viewport/index"),o=n.derive(function(){var e={title:r.observable(""),preview:r.observable(""),description:r.observable(""),name:r.observable(""),parameters:r.observable({}),use:function(){s.filterLayer.use(this.name());var e=this.parameters(),t=!1;if(e){s.filterLayer.set(e);var n=0;for(var r in e)if(e[r]instanceof Image){var i=e[r];i.complete||(t=!0,n++,i.onload=function(){n--,n==0&&s.update()})}}t||s.update()}};return e._previewSrc=r.computed(function(){if(e.preview())return e.preview()}),e},{type:"FILTER",css:"filter",template:i});return o}),define("modules/filters/source",[],function(){function e(e){var t=new Image;return t.src=e,t}var t={filters:[{title:"Gaussian",name:"buildin.gaussian",preview:"preview/gaussian.jpg",description:""},{title:"lensblur",name:"buildin.lensblur",preview:"preview/gaussian.jpg",description:""},{title:"Sepia",name:"buildin.sepia",preview:"preview/sepia.jpg",description:""},{title:"Miss Etikate",name:"buildin.lut",parameters:{lookup:e("lut/missetikate.png")},preview:"preview/missetikate.jpg",description:""},{title:"Amatorka",name:"buildin.lut",parameters:{lookup:e("lut/amatorka.png")},preview:"preview/amatorka.jpg",description:""},{title:"Bleach Bypass",name:"buildin.lut",parameters:{lookup:e("lut/bleachbypass.png")},preview:"preview/bleachbypass.jpg",description:""},{title:"Candle Light",name:"buildin.lut",parameters:{lookup:e("lut/candlelight.png")},preview:"preview/candlelight.jpg",description:""},{title:"Crisp Warm",name:"buildin.lut",parameters:{lookup:e("lut/crispwarm.png")},preview:"preview/crispwarm.jpg",description:""},{title:"Crisp Winter",name:"buildin.lut",parameters:{lookup:e("lut/crispwinter.png")},preview:"preview/crispwinter.jpg",description:""},{title:"Drop Blues",name:"buildin.lut",parameters:{lookup:e("lut/dropblues.png")},preview:"preview/dropblues.jpg",description:""},{title:"Edgy Amber",name:"buildin.lut",parameters:{lookup:e("lut/edgyamber.png")},preview:"preview/edgyamber.jpg",description:""},{title:"Fall Colors",name:"buildin.lut",parameters:{lookup:e("lut/fallcolors.png")},preview:"preview/fallcolors.jpg",description:""},{title:"Film Stock 50",name:"buildin.lut",parameters:{lookup:e("lut/filmstock_50.png")},preview:"preview/filmstock_50.jpg",description:""},{title:"Foggy Night",name:"buildin.lut",parameters:{lookup:e("lut/foggynight.png")},preview:"preview/foggynight.jpg",description:""},{title:"Futuristic Bleak",name:"buildin.lut",parameters:{lookup:e("lut/futuristicbleak.png")},preview:"preview/futuristicbleak.jpg",description:""},{title:"Horror Blue",name:"buildin.lut",parameters:{lookup:e("lut/horrorblue.png")},preview:"preview/horrorblue.jpg",description:""},{title:"Late Sunset",name:"buildin.lut",parameters:{lookup:e("lut/latesunset.png")},preview:"preview/latesunset.jpg",description:""},{title:"Moonlight",name:"buildin.lut",parameters:{lookup:e("lut/moonlight.png")},preview:"preview/moonlight.jpg",description:""},{title:"Night From Day",name:"buildin.lut",parameters:{lookup:e("lut/nightfromday.png")},preview:"preview/nightfromday.jpg",description:""},{title:"Soft Warming",name:"buildin.lut",parameters:{lookup:e("lut/softwarming.png")},preview:"preview/softwarming.jpg",description:""},{title:"Teal Orange Plus...",name:"buildin.lut",parameters:{lookup:e("lut/tealorangepluscontrast.png")},preview:"preview/tealorangepluscontrast.jpg",description:""},{title:"Tension Green",name:"buildin.lut",parameters:{lookup:e("lut/tensiongreen.png")},preview:"preview/tensiongreen.jpg",description:""},{title:"Grayscale",name:"buildin.grayscale",preview:"preview/grayscale.jpg"},{title:"Sketch",name:"buildin.sketch",preview:"preview/sketch.jpg"},{title:"Toon",name:"buildin.toon",preview:"preview/toon.jpg"}]};return t}),define("modules/filters/index",["require","../module","text!./filters.xml","qpf","./filter","./source","../viewport/index","_","knockout"],function(e){var t=e("../module"),n=e("text!./filters.xml"),r=e("qpf"),i=e("./filter"),s=e("./source"),o=e("../viewport/index"),u=e("_"),a=e("knockout"),f=new t({name:"filters",xml:n,filters:a.observableArray(s.filters),FilterView:i,seachKeyword:a.observable(""),colorAdjust:{brightness:a.observable(0),contrast:a.observable(1),exposure:a.observable(0),gamma:a.observable(1),saturation:a.observable(1)}}),l;return f.on("start",function(){l=f.mainComponent.$el.find("#Histogram").qpf("get")[0],l.image=o.processor.canvas,l.update(),l.refresh()}),a.computed(function(){o.colorAdjustLayer.set({brightness:f.colorAdjust.brightness(),contrast:f.colorAdjust.contrast(),exposure:f.colorAdjust.exposure(),gamma:f.colorAdjust.gamma(),saturation:f.colorAdjust.saturation()}),o.update()}),o.on("update",function(){l.update(),l.refresh()}),f.seachKeyword.subscribe(function(e){e?f.filters(u.filter(f.filters(),function(t){return t.name.indexOf(e.toLowerCase())>=0||t.title.indexOf(e)>=0})):f.filters(s.filters)}),f}),define("text!modules/navigator/navigator.xml",[],function(){return'<panel height="100%" id="Navigator">\n    <navlink title="Cloud" icon="cloud" class="active" href="cloud"></navlink>\n    <!-- <navlink title="Camera" icon="camera" href="camera"></navlink> -->\n    <navlink title="Local" icon="local" href="local"></navlink>\n</panel>'}),define("modules/navigator/navlink",["qpf","knockout"],function(){var e=require("qpf"),t=e.use("components/meta/meta"),n=require("knockout"),r=t.derive(function(){return{icon:n.observable(),title:n.observable(""),href:n.observable("")}},{type:"NAVLINK",css:"navlink",initialize:function(){var e=this;this.$el.click(function(t){window.location.hash="#/"+e.href()})},template:'<div class="icon" data-bind="css:icon"></div>                    <div class="title" data-bind="html:title"></div>'});return t.provideBinding("navlink",r),r}),define("modules/router",["require"],function(e){var t=Router();return t.configure({recurse:"forward"}),t}),define("modules/navigator/index",["require","qpf","knockout","../module","text!./navigator.xml","./navlink","../viewport/index","../router"],function(e){function l(){function t(){console.log(arguments)}o.on("beforerender",function(){tex.needsUpdate=!0});var e={video:!0};navigator.getUserMedia?navigator.getUserMedia(e,function(e){f.src=e,f.play()},t):navigator.webkitGetUserMedia&&navigator.webkitGetUserMedia(e,function(e){f.src=window.webkitURL.createObjectURL(e),f.play()},t)}var t=e("qpf"),n=e("knockout"),r=e("../module"),i=e("text!./navigator.xml"),s=e("./navlink"),o=e("../viewport/index"),u=e("../router"),a=new r({name:"navigator",xml:i});a.$el.delegate(".qpf-ui-navlink","click",function(){var e=$(this),t=e.qpf("get")[0];if(t)switch(t.icon()){case"camera":break;case"cloud":}a.$el.find(".qpf-ui-navlink").removeClass("active"),e.addClass("active")});var f;return a}),define("text!modules/app.xml",[],function(){return'<application>\n    <vbox height="100%">\n        <hbox>\n            <region prefer="70" name="navigator" controller="@binding[navigator]"></region>\n            <vbox flex="1">\n                <region flex="1" name="viewport" controller="@binding[viewport]" style="margin:20px;"></region>\n                <!-- <region prefer="100" controller="@binding[imageList]"></region> -->\n            </vbox>\n            <!-- <vbox prefer="200"> -->\n                <!-- <region name="parameters" controller="@binding[parameters]"></region> -->\n            <!-- </vbox> -->\n            <region prefer="250" name="filters" controller="@binding[filters]"></region>\n        </hbox>\n    </vbox>\n</application>'}),define("controllerConfig",{navigator:{"modules/navigator/index":{url:"*"}},viewport:{"modules/viewport/index":{url:"*"}},filters:{"modules/filters/index":{url:"*"}},parameters:{},histogram:{"modules/histogram/index":{url:"*"}},imageList:{"modules/imagelist/index":{url:"*"}}}),define("modules/common/histogram",["require","qpf","emage","knockout"],function(e){var t=e("qpf"),n=e("emage"),r=e("knockout"),i=n.qtek["2d"],s=t.use("components/meta/meta"),o=s.derive(function(){return{image:null,_stage:new i.Renderer,_scene:new i.Scene,_paths:{red:new i.renderable.Path({stroke:!0,style:new i.Style({fill:"red",stroke:"#950000",globalAlpha:.4,shadow:"0 -2 1 #555"})}),green:new i.renderable.Path({stroke:!0,style:new i.Style({fill:"green",stroke:"#009500",globalAlpha:.4,shadow:"0 -2 1 #555"})}),blue:new i.renderable.Path({stroke:!0,style:new i.Style({fill:"blue",stroke:"#000095",globalAlpha:.4,shadow:"0 -2 1 #555"})})},size:128,sample:r.observable(2),_histogram:new n.Histogram}},{type:"HISTOGRAM",css:"histogram",initialize:function(){this._scene.add(this._paths.red),this._scene.add(this._paths.green),this._scene.add(this._paths.blue),this._histogram.downSample=1/8},template:"",update:function(){if(!this.image)return;this._histogram.image=this.image,this._histogram.update()},refresh:function(){if(!this.image)return;histogramArray=this.getNormalizedHistogram(),this.updatePath("red",histogramArray.red),this.updatePath("green",histogramArray.green),this.updatePath("blue",histogramArray.blue),this._stage.render(this._scene)},initPath:function(e){var t=this._paths[e],n=this.height(),r=this.sample(),i=this.$el.width()/256*r;t.segments=[{point:[0,n]}];var s=0;for(var o=0;o<256;o+=r)t.segments.push({point:[s,0]}),s+=i;t.pushPoints([[this.$el.width(),n],[0,n]])},updatePath:function(e,t){var n=this._paths[e],r=this.height(),i=this.sample();for(var s=i;s<257;s+=i)n.segments[s/i].point[1]=(1-t[s-1])*r},getNormalizedHistogram:function(){function e(e){var t=0,n=[];for(var r=0;r<e.length;r++)e[r]>t&&(t=e[r]);for(var r=0;r<e.length;r++)n.push(t==0||isNaN(t)?0:e[r]/t);return n}var t=this._histogram.channels;return{red:e(t.red),green:e(t.green),blue:e(t.blue)}},afterRender:function(){this.$el[0].appendChild(this._stage.canvas)},afterResize:function(){this._stage&&this._stage.resize(this.$el.width(),this.$el.height()),this.initPath("red"),this.initPath("green"),this.initPath("blue"),this.refresh()}});return s.provideBinding("histogram",o),o}),define("modules/common/listitem",["require","qpf","knockout"],function(e){var t=e("qpf"),n=t.use("components/meta/meta"),r=e("knockout"),i=n.derive(function(){return{title:r.observable(""),icon:r.observable(""),href:r.observable("")}},{type:"LISTITEM",css:"list-item",initialize:function(){this.$el.mousedown(function(e){e.preventDefault()});var e=this;this.$el.click(function(){var t=e.href();t&&t.indexOf("#")==0&&(window.location.hash=t)})},template:'<div class="icon" data-bind="css:icon"></div>                    <div class="title" data-bind="html:title"></div>'});return i}),define("modules/common/list",["require","qpf","./listitem","knockout"],function(e){var t=e("qpf"),n=e("./listitem"),r=t.use("components/container/container"),i=e("knockout"),s=r.derive(function(){return{dataSource:i.observableArray([]),itemView:i.observable(n),selected:i.observable()}},{type:"LIST",css:"list",template:'<div data-bind="foreach:children" >                        <div class="qpf-container-item">                            <div data-bind="qpf_view:$data"></div>                        </div>                    </div>',initialize:function(){var e=_.clone(this.dataSource()),t=this;this.dataSource.subscribe(function(t){this._update(e,t),e=_.clone(t),_.each(e,function(e,t){i.utils.unwrapObservable(e.selected)&&this.selected(t)},this)},this),this.selected.subscribe(function(e){this._unSelectAll();var t=this.children()[e];t&&t.$el.addClass("selected")},this),this.$el.delegate(".qpf-container-item","click",function(){var e=i.contextFor(this);t.selected(e.$index())}),this._update([],e)},_update:function(e,t){var n=this.children(),r=this.itemView(),s=[],o=i.utils.compareArrays(e,t),u=[];_.each(o,function(t){if(t.status==="retained"){var i=e.indexOf(t.value);s[i]=n[i]}else if(t.status==="added"){var o=new r({attributes:t.value});s[t.index]=o,n.splice(t.index,0,o),u.push(o)}},this),this.children(s),_.each(u,function(e){e.render()})},_unSelectAll:function(){_.each(this.children(),function(e,t){e.$el.removeClass("selected")},this)}});return r.provideBinding("list",s),s}),define("modules/common/modal",["require","qpf","knockout"],function(e){var t=e("qpf"),n=t.use("core/clazz"),r=t.use("components/container/window"),i=t.use("components/container/container"),s=t.use("components/container/inline"),o=t.use("components/meta/button"),u=e("knockout"),a=new r({attributes:{"class":"qpf-modal"}}),f=new i,l=new s,c=new o({attributes:{text:" "}}),h=new o({attributes:{text:" "}});a.add(f),a.add(l),l.add(c),l.add(h),a.render(),document.body.appendChild(a.$el[0]);var p=$('<div class="qpf-mask"></div>');document.body.appendChild(p[0]),a.$el.hide(),p.hide();var d=n.derive(function(){return{title:"",body:null,onApply:function(e){e()},onCancel:function(e){e()}}},{show:function(){var e=this;a.title(this.title),f.removeAll(),this.body&&f.add(this.body),c.off("click"),h.off("click"),c.on("click",function(){e.onApply(e.hide)}),h.on("click",function(){e.onCancel(e.hide)}),a.$el.show(),p.show(),a.left(($(window).width()-a.$el.width())/2),a.top(($(window).height()-a.$el.height())/2-100)},hide:function(){a.$el.hide(),p.hide()}});return d.popup=function(e,t,n,r){var i=new d({title:e,body:t,onApply:n||function(e){e()},onCancel:r||function(e){e()}});i.body.render(),i.show()},d.confirm=function(e,t,n,r){var i=new d({title:e,body:new Label({attributes:{text:t},temporary:!0}),onApply:n||function(e){e()},onCancel:r||function(e){e()}});i.body.render(),i.show()},d}),define("modules/common/region",["require","qpf","knockout","../router"],function(e){var t=e("qpf"),n=t.use("components/meta/meta"),r=t.use("components/base"),i=e("knockout"),s=e("../router"),o=r.derive(function(){return{controller:{},_moduleCache:{},_currentModule:null}},{type:"REGION",css:"region",initialize:function(){var e=this;_.each(this.controller,function(t,n){var r=t.url,i=t.context;r==="*"?e.enterModule(n,{},function(){}):(s.on("after",r,e.leaveModule.bind(e,n)),s.on(r,e.enterModule.bind(e,n,i)))})},_updateStatus:function(){var e=this,t=Array.prototype.pop.call(arguments),n=0;_.each(e._moduleCache,function(e){n++,e.__enable__?e.enable(t):e.disable(t)}),n||t()},leaveModule:function(e){var t=this._moduleCache[e],n=Array.prototype.pop.call(arguments);t&&t.disable(n)},enterModule:function(t,n){var r={},i=this,s=Array.prototype.pop.call(arguments),o=Array.prototype.slice.call(arguments,2);n&&_.each(o,function(e,t){var i=n[t];i&&(r[i]=e)});var u=this._moduleCache[t];u?(u.enable(s),u.setContext(r),this._currentModule=u,this.afterResize()):e([t],function(e){if(e&&e.start){var n=e.start();n&&i.$el.append(n),e.mainComponent.parent=i,e.enable(s),e.setContext(r),i._moduleCache[t]=e,i._currentModule=e,i.afterResize()}}),s()},afterResize:function(){this._currentModule&&this._currentModule.mainComponent&&(this._currentModule.mainComponent.width(this.$el.width()),this._currentModule.mainComponent.height(this.$el.height())),r.prototype.afterResize.call(this)}});return n.provideBinding("region",o),o}),define("modules/common/iconbutton",["require","qpf","knockout"],function(e){var t=e("qpf"),n=t.use("components/meta/button"),r=t.use("components/meta/meta"),i=e("knockout"),s=n.derive(function(){return{$el:$("<div></div>"),icon:i.observable("")}},{type:"ICONBUTTON",css:_.union("icon-button",n.prototype.css),template:'<div class="qpf-icon" data-bind="css:icon"></div>'});return r.provideBinding("iconbutton",s),s}),define("modules/common/nativehtml",["require","qpf","knockout","_"],function(e){var t=e("qpf"),n=t.use("components/meta/meta"),r=e("knockout"),i=t.use("core/xmlparser"),s=e("_"),o=n.derive(function(){return{$el:$('<div data-bind="html:html"></div>'),html:r.observable("ko")}},{type:"NATIVEHTML",css:"native-html"});return n.provideBinding("nativehtml",o),i.provideParser("nativehtml",function(e){var t=i.util.getChildren(e),n="";s.each(t,function(e){e.nodeType===4&&(n+=e.textContent)});if(n)return{html:n}}),o}),define("app",["require","qpf","_","text!modules/app.xml","modules/router","./controllerConfig","modules/common/histogram","modules/common/list","modules/common/modal","modules/common/region","modules/common/iconbutton","modules/common/nativehtml","knockout"],function(e){function u(){var n=e("knockout"),o=t.use("core/xmlparser"),u=o.parse(r);document.body.appendChild(u),n.applyBindings(s,u),i.init("/")}var t=e("qpf"),n=e("_"),r=e("text!modules/app.xml"),i=e("modules/router"),s=e("./controllerConfig"),o=t.use("core/mixin/event");e("modules/common/histogram"),e("modules/common/list"),e("modules/common/modal"),e("modules/common/region"),e("modules/common/iconbutton"),e("modules/common/nativehtml");var a={start:u};return n.extend(a,o),a});